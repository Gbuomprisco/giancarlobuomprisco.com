<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&amp;family=Merriweather:wght@300;400;700&amp;display=swap"/><link rel="canonical" href="https://giancarlobuomprisco.com/node/using-brotli-with-node.js"/><meta name="theme-color" content="#212121"/><meta name="author" content="Giancarlo Buomprisco"/><meta name="description" content="Giancarlo Buomprisco"/><meta property="og:description" content="Giancarlo Buomprisco"/><meta property="og:site_name" content="giancarlobuomprisco.com"/><meta property="twitter:description" content="Giancarlo Buomprisco"/><meta property="twitter:creator" content="@gc_psk"/><meta property="twitter:card" content="summary_large_image"/><title>Using Brotli with Node.js</title><meta property="og:type" content="article"/><meta property="og:title" content="Using Brotli with Node.js"/><meta property="og:site_name" content="giancarlobuomprisco.com"/><meta property="article:published_time" content="2021-11-01T21:53:02.000Z"/><meta property="twitter:title" content="Using Brotli with Node.js"/><meta property="og:image" content="https://giancarlobuomprisco.comundefined"/><meta property="twitter:image" content="https://giancarlobuomprisco.comundefined"/><script type="application/ld+json">{&quot;@context&quot;:&quot;https://schema.org/&quot;,&quot;@type&quot;:&quot;BlogPosting&quot;,&quot;mainEntityOfPage&quot;:{&quot;@type&quot;:&quot;WebPage&quot;,&quot;@id&quot;:&quot;https://google.com/article&quot;},&quot;headline&quot;:&quot;Using Brotli with Node.js&quot;,&quot;images&quot;:[&quot;https://giancarlobuomprisco.comundefined&quot;],&quot;author&quot;:{&quot;@type&quot;:&quot;Person&quot;,&quot;name&quot;:&quot;Giancarlo Buomprisco&quot;,&quot;url&quot;:&quot;https://twitter.com/@gc_psk&quot;},&quot;datePublished&quot;:&quot;2021-11-01T21:53:02.000Z&quot;}</script><meta name="next-head-count" content="29"/><link rel="preload" href="/_next/static/css/e7fd61d612f31361.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e7fd61d612f31361.css" data-n-g=""/><link rel="preload" href="/_next/static/css/088fb652bf056dbc.css" as="style"/><link rel="stylesheet" href="/_next/static/css/088fb652bf056dbc.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-27593bf8d60abcde.js" defer=""></script><script src="/_next/static/chunks/framework-93dc06fa7fcdddfb.js" defer=""></script><script src="/_next/static/chunks/main-e47b4831833660b7.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8ff1c8d9702d8e84.js" defer=""></script><script src="/_next/static/chunks/501-5650b991910e93a7.js" defer=""></script><script src="/_next/static/chunks/506-85a149013761a2bf.js" defer=""></script><script src="/_next/static/chunks/176-ab20cff309332661.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bcollection%5D/%5Bslug%5D-834162d84c40aded.js" defer=""></script><script src="/_next/static/yktlj8nxVndktUSLc0MdG/_buildManifest.js" defer=""></script><script src="/_next/static/yktlj8nxVndktUSLc0MdG/_ssgManifest.js" defer=""></script><script src="/_next/static/yktlj8nxVndktUSLc0MdG/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div><main><div style="--accent:#84BA64;--accent-light:#84ba6491;--accent-contrast:#212121"><div style="--from:#84ba6491;--to:#84BA64" class="collection-branding-bar_gradient__1Ie5x"></div><div class="container mx-auto px-5"><div class="flex-row flex justify-between items-center py-2 mt-6 mb-8"><a class="hover:underline" href="/"><b>GIANCARLO</b><span>BUOMPRISCO</span></a><div class="justify-end lg:hidden flex"><button aria-label="Open Menu" class="navbar-burger" type="button"><span class="block relative w-7 rounded-sm bg-black h-1"></span><span class="block relative w-7 rounded-sm bg-black h-1 mt-1"></span><span class="block relative w-7 rounded-sm bg-black h-1 mt-1"></span></button></div><ul class="lg:space-x-10 text-gray-800 px-4 hidden flex-col space-y-4 lg:space-y-0 lg:flex lg:flex-row nav"><li class="flex flex-row justify-between mb-6 lg:hidden"><div><a class="hover:underline" href="/"><b>GIANCARLO</b><span>BUOMPRISCO</span></a></div><div class="flex justify-end"><span class="bg-gray-100 font-bold text-sm rounded-full shadow-xl flex items-center justify-center w-16 h-16">Close</span></div></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/blog">Blog</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/articles">Articles</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/consulting">Consulting</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/about">About</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/contact">Contact me</a></li></ul></div><article class="mb-16"><h1 class="text-5xl md:text-7xl lg:text-8xl font-bold tracking-tighter md:leading-none mb-8 text-center">Using Brotli with Node.js</h1><div class="mb-6 flex space-x-3 items-center justify-center"><div style="--backgroundColor:#84BA64;--color:#212121" class="text-center flex flex-row space-x-1 items-center cursor-pointer justify-center px-2 py-1 rounded hover:shadow-md transition-shadow font-bold tag_Tag__tPe2P"><a class="flex flex-row space-x-1 items-center justify-center" href="/node"><img class="object-contain" loading="lazy" style="width:22px;height:22px" src="/assets/images/collections/node.webp" alt="Node"/><span class="hover:underline">Node</span></a></div></div><div class="max-w-2xl mx-auto mb-6"><div class="flex flex-row space-x-2 items-center justify-center"><div class="flex flex-row space-x-3 items-center"><a target="_blank" rel="noreferrer noopened" href="https://twitter.com/@gc_psk"><img width="50px" height="50px" src="/assets/giancarlo-2.png" alt="Giancarlo"/></a><a class="text-sm text-gray-600" target="_blank" rel="noreferrer noopened" href="https://twitter.com/@gc_psk">@gc_psk</a></div><span class="text-gray-600">·</span><div class="text-sm text-center text-gray-600"><time dateTime="2021-11-01T21:53:02.000Z">Nov 1, 2021</time></div><span class="text-gray-600">·</span><span class="text-gray-600 text-sm">2 min read</span></div></div><div class="mb-8 md:mb-16 sm:mx-0"><div class="mx-auto w-12/12 lg:w-10/12 xl:w-8/12 justify-center"><div class="shadow-xl rounded-md"><svg width="100%" height="415" viewBox="0 0 800 415" fill="white" xmlns="http://www.w3.org/2000/svg" class=""><style>
    @media (max-width: 768px) {
      svg {
        height: 300px;
      }
    
      text {
        font-size: 50px;
      }
    }
    
    @media (max-width: 500px) {
      svg {
        height: 200px;
      }
    
      text {
        font-size: 42px;
      }
    }
    
    @media (max-width: 300px) {
      svg {
        height: 150px;
      }
    
      text {
        font-size: 32px;
      }
    }`
    </style><rect width="100%" height="415" fill="white"></rect><text y="15%" font-family="Inter, Helvetica, sans-serif" font-weight="800" font-size="4rem" fill="#222"><tspan x="5%" dy="1.2em">Using Brotli with</tspan><tspan x="5%" dy="1.2em">Node.js</tspan></text><image x="50%" y="15%" width="60%" height="60%" href="/assets/images/collections/node.webp" preserveAspectRatio="xMidYMid" opacity="0.15"></image><rect width="100%" height="15" fill="#84BA64"></rect></svg></div></div></div><div class="max-w-2xl mx-auto leading-loose markdown-styles_markdown__1x9gM"><p>Brotli is a compression algorithm developed by Google, able to compress data even smaller than gzip can.</p><p>Compressing can be useful in many situations; the most notable being serving your website assets in a much smaller format.</p><p>But there are times when we may want to use <em>brotli</em> programmatically, for example using NodeJS.</p><p>As a personal anectode, I recently needed to store large(ish) strings into <strong>Redis</strong>, which is an in-memory database. Of course, space size is limited, and every byte counts.</p><p>I was willing to pay a small CPU-related price for saving space and network transfer payloads (which Firebase, of course, bills me for).</p><p>I therefore started researching for the most effective way of compressing the data before writing to Redis, so that:</p><ul><li>the string would occupy less space</li><li>the network cost and speed would be lower</li></ul><p>Brotli, which is built-in into Node, seemed like a good choice. Let&#x27;s see how to use it.</p><h3>Compressing</h3><p>NodeJS comes with utilities for compressing/decompressing Brotli since versions v11.7.0, v10.16.0.</p><p>Like many other APIs, Node comes with async and sync versions. For simplicity, we&#x27;ll show the sync versions.</p><p>When compressing, we need to turn the input data structure into a string. </p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> brotliCompressSync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;zlib&#x27;</span><span class="token punctuation">;</span>

<span class="token comment">// let&#x27;s assume this is an object or </span>
<span class="token comment">// string you want to store</span>
<span class="token comment">// such as a JSON object</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> compressed <span class="token operator">=</span> <span class="token function">brotliCompressSync</span><span class="token punctuation">(</span>
  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&#x27;base64&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// do something with &quot;compressed&quot;</span>
</code></pre></div><p>The above can become a small utility function:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compressWithBrotli</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">brotliCompressSync</span><span class="token punctuation">(</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&#x27;base64&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3>Decompressing</h3><p>For decompressing a Brotli base64 string and turning it back into its JSON representation we will need a few more steps:</p><ul><li>first, we turn the compressed string into a <code>Buffer</code></li><li>we then decompress using the built-in utility <code>brotliDecompressSync</code></li><li>we check if the value is truthy, and if so, parse the string using <code>JSON.parse</code></li></ul><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> brotliDecompressSync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;zlib&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">decompressWithBrotli</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">&#x27;base64&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> value <span class="token operator">=</span> 
    <span class="token function">brotliDecompressSync</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&#x27;utf-8&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> value <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We can now use the utility functions <code>compressWithBrotli</code> and <code>decompressWithBrotli</code> to compress our text on-the-fly.</p><p>If you want to use the async versions of the API, use the variants <code>brotliCompress</code> and <code>brotliDecompress</code>.</p></div></article><div class="w-full md:w-8/12 mx-auto"><script async="" data-uid="3e3126f064" src="https://thoughtful-inventor-7842.ck.page/3e3126f064/index.js"></script></div></div></div></main></div><footer><div class="container mx-auto px-5"><hr class="border-accent-2 mt-16 mb-14"/><div class="flex-row flex justify-between items-center py-2 mt-6 mb-8"><a class="hover:underline" href="/"><b>GIANCARLO</b><span>BUOMPRISCO</span></a><div class="justify-end lg:hidden flex"><button aria-label="Open Menu" class="navbar-burger" type="button"><span class="block relative w-7 rounded-sm bg-black h-1"></span><span class="block relative w-7 rounded-sm bg-black h-1 mt-1"></span><span class="block relative w-7 rounded-sm bg-black h-1 mt-1"></span></button></div><ul class="lg:space-x-10 text-gray-800 px-4 hidden flex-col space-y-4 lg:space-y-0 lg:flex lg:flex-row nav"><li class="flex flex-row justify-between mb-6 lg:hidden"><div><a class="hover:underline" href="/"><b>GIANCARLO</b><span>BUOMPRISCO</span></a></div><div class="flex justify-end"><span class="bg-gray-100 font-bold text-sm rounded-full shadow-xl flex items-center justify-center w-16 h-16">Close</span></div></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/blog">Blog</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/articles">Articles</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/consulting">Consulting</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/about">About</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/contact">Contact me</a></li></ul></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"live":true,"readingTime":"2 min read","title":"Using Brotli with Node.js","date":"2021-11-01T21:53:02.000Z","slug":"using-brotli-with-node.js","collection":{"name":"Node","primaryColor":"#84BA64","primaryColorLight":"#84ba6491","contrastColor":"#212121","logo":"/assets/images/collections/node.webp","slug":"node"},"content":"Brotli is a compression algorithm developed by Google, able to compress data even smaller than gzip can.\n\nCompressing can be useful in many situations; the most notable being serving your website assets in a much smaller format.\n\nBut there are times when we may want to use _brotli_ programmatically, for example using NodeJS.\n\nAs a personal anectode, I recently needed to store large(ish) strings into **Redis**, which is an in-memory database. Of course, space size is limited, and every byte counts.\n\nI was willing to pay a small CPU-related price for saving space and network transfer payloads (which Firebase, of course, bills me for).\n\nI therefore started researching for the most effective way of compressing the data before writing to Redis, so that:\n\n* the string would occupy less space\n* the network cost and speed would be lower\n\nBrotli, which is built-in into Node, seemed like a good choice. Let's see how to use it.\n\n### Compressing\n\nNodeJS comes with utilities for compressing/decompressing Brotli since versions v11.7.0, v10.16.0.\n\nLike many other APIs, Node comes with async and sync versions. For simplicity, we'll show the sync versions.\n\nWhen compressing, we need to turn the input data structure into a string. \n\n```typescript\nimport { brotliCompressSync } from 'zlib';\n\n// let's assume this is an object or \n// string you want to store\n// such as a JSON object\nconst data = [];\n\nconst compressed = brotliCompressSync(\n  JSON.stringify(data)\n).toString('base64');\n\n// do something with \"compressed\"\n```\n\nThe above can become a small utility function:\n\n```typescript\nexport function compressWithBrotli(data: unknown) {\n  return brotliCompressSync(\n    JSON.stringify(data)\n  ).toString('base64');\n}\n```\n\n### Decompressing\n\nFor decompressing a Brotli base64 string and turning it back into its JSON representation we will need a few more steps:\n\n* first, we turn the compressed string into a `Buffer`\n* we then decompress using the built-in utility `brotliDecompressSync`\n* we check if the value is truthy, and if so, parse the string using `JSON.parse`\n\n```typescript\nimport { brotliDecompressSync } from 'zlib';\n\nexport function decompressWithBrotli(data: string) {\n  const buffer = Buffer.from(data, 'base64');\n\n  const value = \n    brotliDecompressSync(buffer).toString('utf-8');\n\n  return value ? JSON.parse(value) : undefined;\n}\n```\n\nWe can now use the utility functions `compressWithBrotli` and `decompressWithBrotli` to compress our text on-the-fly.\n\nIf you want to use the async versions of the API, use the variants `brotliCompress` and `brotliDecompress`.","tags":[],"ogImage":{"url":"/assets/images/posts/using-brotli-with-node.js.webp"}},"content":{"compiledSource":"var N=Object.defineProperty,l=Object.defineProperties;var d=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable;var r=(a,n,s)=\u003en in a?N(a,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[n]=s,e=(a,n)=\u003e{for(var s in n||(n={}))o.call(n,s)\u0026\u0026r(a,s,n[s]);if(p)for(var s of p(n))c.call(n,s)\u0026\u0026r(a,s,n[s]);return a},m=(a,n)=\u003el(a,d(n));var i=(a,n)=\u003e{var s={};for(var t in a)o.call(a,t)\u0026\u0026n.indexOf(t)\u003c0\u0026\u0026(s[t]=a[t]);if(a!=null\u0026\u0026p)for(var t of p(a))n.indexOf(t)\u003c0\u0026\u0026c.call(a,t)\u0026\u0026(s[t]=a[t]);return s};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(s){var t=s,{components:a}=t,n=i(t,[\"components\"]);return mdx(MDXLayout,m(e(e({},layoutProps),n),{components:a,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"Brotli is a compression algorithm developed by Google, able to compress data even smaller than gzip can.\"),mdx(\"p\",null,\"Compressing can be useful in many situations; the most notable being serving your website assets in a much smaller format.\"),mdx(\"p\",null,\"But there are times when we may want to use \",mdx(\"em\",{parentName:\"p\"},\"brotli\"),\" programmatically, for example using NodeJS.\"),mdx(\"p\",null,\"As a personal anectode, I recently needed to store large(ish) strings into \",mdx(\"strong\",{parentName:\"p\"},\"Redis\"),\", which is an in-memory database. Of course, space size is limited, and every byte counts.\"),mdx(\"p\",null,\"I was willing to pay a small CPU-related price for saving space and network transfer payloads (which Firebase, of course, bills me for).\"),mdx(\"p\",null,\"I therefore started researching for the most effective way of compressing the data before writing to Redis, so that:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"the string would occupy less space\"),mdx(\"li\",{parentName:\"ul\"},\"the network cost and speed would be lower\")),mdx(\"p\",null,\"Brotli, which is built-in into Node, seemed like a good choice. Let's see how to use it.\"),mdx(\"h3\",null,\"Compressing\"),mdx(\"p\",null,\"NodeJS comes with utilities for compressing/decompressing Brotli since versions v11.7.0, v10.16.0.\"),mdx(\"p\",null,\"Like many other APIs, Node comes with async and sync versions. For simplicity, we'll show the sync versions.\"),mdx(\"p\",null,\"When compressing, we need to turn the input data structure into a string. \"),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"import\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),\" brotliCompressSync \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"from\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'zlib'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"// let's assume this is an object or \"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"// string you want to store\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"// such as a JSON object\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" data \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" compressed \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"brotliCompressSync\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"token constant\"}),\"JSON\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"stringify\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"toString\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'base64'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),'// do something with \"compressed\"'),`\n`))),mdx(\"p\",null,\"The above can become a small utility function:\"),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"export\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"function\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"compressWithBrotli\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"unknown\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"brotliCompressSync\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token constant\"}),\"JSON\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"stringify\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"toString\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'base64'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"h3\",null,\"Decompressing\"),mdx(\"p\",null,\"For decompressing a Brotli base64 string and turning it back into its JSON representation we will need a few more steps:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"first, we turn the compressed string into a \",mdx(\"inlineCode\",{parentName:\"li\"},\"Buffer\")),mdx(\"li\",{parentName:\"ul\"},\"we then decompress using the built-in utility \",mdx(\"inlineCode\",{parentName:\"li\"},\"brotliDecompressSync\")),mdx(\"li\",{parentName:\"ul\"},\"we check if the value is truthy, and if so, parse the string using \",mdx(\"inlineCode\",{parentName:\"li\"},\"JSON.parse\"))),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"import\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),\" brotliDecompressSync \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"from\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'zlib'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"export\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"function\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"decompressWithBrotli\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"string\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" buffer \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" Buffer\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"from\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'base64'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" value \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),` \n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"brotliDecompressSync\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"buffer\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"toString\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'utf-8'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),\" value \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"?\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token constant\"}),\"JSON\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"parse\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"value\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"undefined\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"p\",null,\"We can now use the utility functions \",mdx(\"inlineCode\",{parentName:\"p\"},\"compressWithBrotli\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"decompressWithBrotli\"),\" to compress our text on-the-fly.\"),mdx(\"p\",null,\"If you want to use the async versions of the API, use the variants \",mdx(\"inlineCode\",{parentName:\"p\"},\"brotliCompress\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"brotliDecompress\"),\".\"))}MDXContent.isMDXComponent=!0;\n","scope":{}},"series":[],"morePosts":[],"moreArticles":[],"type":0},"__N_SSG":true},"page":"/[collection]/[slug]","query":{"collection":"node","slug":"using-brotli-with-node.js"},"buildId":"yktlj8nxVndktUSLc0MdG","isFallback":false,"gsp":true,"scriptLoader":[]}</script><script async="" defer="" src="https://www.googletagmanager.com/gtag/js"></script><script id="gtmDataLayer">
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-172483071-1');
</script></body></html>