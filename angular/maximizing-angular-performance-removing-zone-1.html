<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&amp;family=Merriweather:wght@300;400;700&amp;display=swap"/><meta name="theme-color" content="#212121"/><meta name="author" content="Giancarlo Buomprisco"/><meta property="og:site_name" content="giancarlobuomprisco.com"/><meta property="twitter:creator" content="@gc_psk"/><meta property="twitter:card" content="summary_large_image"/><title>Quantum Angular: Maximizing Performance by Removing Zone</title><meta property="og:type" content="article"/><meta property="og:title" content="Quantum Angular: Maximizing Performance by Removing Zone"/><meta property="article:published_time" content="2019-11-19T00:00:00.000Z"/><meta property="twitter:title" content="Quantum Angular: Maximizing Performance by Removing Zone"/><meta property="twitter:description" content="Experiment: Removing Zone from Angular with minimal effort, to boost runtime performance"/><meta property="twitter:image" content="https://giancarlobuomprisco.comhttps://cdn-images-1.medium.com/max/5746/0*EfvtinXlbA0f1Uf6"/><meta property="og:description" content="Experiment: Removing Zone from Angular with minimal effort, to boost runtime performance"/><meta name="description" content="Experiment: Removing Zone from Angular with minimal effort, to boost runtime performance"/><link rel="canonical" href="https://blog.bitsrc.io/quantum-angular-maximizing-performance-by-removing-zone-e0eefe85b8d8"/><meta property="og:image" content="https://giancarlobuomprisco.comhttps://cdn-images-1.medium.com/max/5746/0*EfvtinXlbA0f1Uf6"/><script type="application/ld+json">{&quot;@context&quot;:&quot;https://schema.org/&quot;,&quot;@type&quot;:&quot;Article&quot;,&quot;mainEntityOfPage&quot;:{&quot;@type&quot;:&quot;WebPage&quot;,&quot;@id&quot;:&quot;https://google.com/article&quot;},&quot;image&quot;:[&quot;https://giancarlobuomprisco.comhttps://cdn-images-1.medium.com/max/5746/0*EfvtinXlbA0f1Uf6&quot;],&quot;headline&quot;:&quot;Quantum Angular: Maximizing Performance by Removing Zone&quot;,&quot;description&quot;:&quot;Experiment: Removing Zone from Angular with minimal effort, to boost runtime performance&quot;,&quot;author&quot;:{&quot;@type&quot;:&quot;Person&quot;,&quot;name&quot;:&quot;Giancarlo Buomprisco&quot;,&quot;url&quot;:&quot;https://twitter.com/@gc_psk&quot;},&quot;datePublished&quot;:&quot;2019-11-19T00:00:00.000Z&quot;}</script><meta name="next-head-count" content="28"/><link rel="preload" href="/_next/static/css/b55c904aed8bb1b5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b55c904aed8bb1b5.css" data-n-g=""/><link rel="preload" href="/_next/static/css/0872225b3e11ef97.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0872225b3e11ef97.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-27593bf8d60abcde.js" defer=""></script><script src="/_next/static/chunks/framework-93dc06fa7fcdddfb.js" defer=""></script><script src="/_next/static/chunks/main-e47b4831833660b7.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8ff1c8d9702d8e84.js" defer=""></script><script src="/_next/static/chunks/501-5650b991910e93a7.js" defer=""></script><script src="/_next/static/chunks/479-00feae25a7c124b2.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bcollection%5D/%5Bslug%5D-b5c38c99e6627133.js" defer=""></script><script src="/_next/static/_Q7TEENxVO8jGXME1JGUY/_buildManifest.js" defer=""></script><script src="/_next/static/_Q7TEENxVO8jGXME1JGUY/_ssgManifest.js" defer=""></script><script src="/_next/static/_Q7TEENxVO8jGXME1JGUY/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div><main><div style="--accent:#e23236;--accent-light:#e23236;--accent-contrast:#ffffff"><div style="--from:#dd00316e;--to:#e23236" class="collection-branding-bar_gradient__1Ie5x"></div><div class="container mx-auto px-5"><div class="flex-row flex justify-between items-center py-2 mt-6 mb-8"><a class="hover:underline" href="/"><b>GIANCARLO</b><span>BUOMPRISCO</span></a><div class="justify-end lg:hidden flex"><button aria-label="Open Menu" class="navbar-burger" type="button"><span class="block relative w-7 rounded-sm bg-black h-1"></span><span class="block relative w-7 rounded-sm bg-black h-1 mt-1"></span><span class="block relative w-7 rounded-sm bg-black h-1 mt-1"></span></button></div><ul class="lg:space-x-10 text-gray-800 px-4 hidden flex-col space-y-4 lg:space-y-0 lg:flex lg:flex-row nav"><li class="flex flex-row justify-between mb-6 lg:hidden"><div><a class="hover:underline" href="/"><b>GIANCARLO</b><span>BUOMPRISCO</span></a></div><div class="flex justify-end"><span class="bg-gray-100 font-bold text-sm rounded-full shadow-xl flex items-center justify-center w-16 h-16">Close</span></div></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/blog">Blog</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/articles">Articles</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/consulting">Consulting</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/about">About</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/contact">Contact me</a></li></ul></div><article class="mb-16"><h1 class="text-5xl md:text-7xl lg:text-8xl font-bold tracking-tighter md:leading-none mb-8 text-center">Quantum Angular: Maximizing Performance by Removing Zone</h1><div class="mb-6 flex space-x-3 items-center justify-center"><div style="--backgroundColor:#e23236;--color:#ffffff" class="text-center flex flex-row space-x-1 items-center cursor-pointer justify-center px-2 py-1 rounded hover:shadow-md transition-shadow font-bold tag_Tag__tPe2P"><a class="flex flex-row space-x-1 items-center justify-center" href="/angular"><img class="object-contain" loading="lazy" style="width:22px;height:22px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></a></div><div style="--backgroundColor:#eee" class="text-center flex flex-row space-x-1 items-center cursor-pointer justify-center px-2 py-1 rounded hover:shadow-md transition-shadow font-bold tag_Tag__tPe2P"><a href="/tags/performance">performance</a></div></div><div class="max-w-2xl mx-auto mb-6"><div class="flex flex-row space-x-2 items-center justify-center"><div class="flex flex-row space-x-3 items-center"><a target="_blank" rel="noreferrer noopened" href="https://twitter.com/@gc_psk"><img width="45px" height="45px" src="/assets/giancarlo-2.png"/></a><a class="text-sm text-gray-600" target="_blank" rel="noreferrer noopened" href="https://twitter.com/@gc_psk">@gc_psk</a></div><span class="text-gray-600">·</span><div class="text-sm text-center text-gray-600"><time dateTime="2019-11-19T00:00:00.000Z">Nov 19, 2019</time></div><span class="text-gray-600">·</span><span class="text-gray-600 text-sm">11 min read</span></div></div><div class="mb-8 md:mb-16 sm:mx-0"><div class="mx-auto w-12/12 lg:w-10/12 xl:w-8/12 justify-center"><div class="sm:mx-0"><img style="width:100%;height:auto" class="block shadow-xl rounded-md" src="https://cdn-images-1.medium.com/max/5746/0*EfvtinXlbA0f1Uf6" alt="Cover Image for Quantum Angular: Maximizing Performance by Removing Zone" loading="lazy"/></div></div></div><div class="mb-12 max-w-2xl mx-auto"></div><div class="max-w-2xl mx-auto leading-loose markdown-styles_markdown__1x9gM"><p>As Angular developers, we owe Zone a great deal: it’s also thanks to this library that we can use Angular almost magically; in fact, most times we simply need to change a property and <strong>it just works</strong>, Angular re-renders our components, and the view is always up to date. Pretty cool.</p><p>In this article, I want to explore some ways in which the new Angular Ivy compiler (being released in version 9) will be able to make apps <strong>work without Zone</strong> much simpler than it was in the past.</p><p>As a result, I was able to increase the performance of an application under heavy load by a huge amount by adding as little overhead as possible using Typescript’s decorators.</p><p><strong>Notice</strong>: the approaches explained in this article are only possible thanks to <strong>Angular Ivy and AOT enabled by default</strong>. This article is educational only and doesn’t aim to advertise the code described.</p><h2>The case for using Angular without Zone</h2><p>Wait a moment, though: is it worth disabling <em>Zone</em> as it allows us to effortlessly re-render our templates? Yes, it is incredibly useful, but as always, <strong>magic comes at a cost</strong>.</p><p>If your application needs a special performance target, disabling <em>Zone</em> can help deliver better performance for your application: an example of a case-scenario where performance can actually be game-changing is high-frequency updates, which is an issue I had while working on a real-time trading application, where a WebSocket was continuously sending messages to the client.</p><h2>Removing Zone from Angular</h2><p>Running Angular without Zone is pretty simple. The first step is to comment out or remove the import statement in the file polyfills.ts:</p><p><img src="https://cdn-images-1.medium.com/max/2070/1*aO5CRXz99wZiAUDTN7XDCw.png" loading="lazy"/></p><p>The second step is to Bootstrap the root module with the following options:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token function">platformBrowserDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">bootstrapModule</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    ngZone<span class="token operator">:</span> <span class="token string">&#x27;noop&#x27;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2>Angular Ivy: Manually Detecting Changes with ɵdetectChanges and ɵmarkDirty</h2><p>Before we can start building our Typescript decorator, we need to see how Ivy allows us to bypass Zone and DI and trigger a change detection on a component by marking it dirty.</p><p>We can now use two more functions exported from @angular/core: <strong>ɵdetectChanges</strong> and <strong>ɵmarkDirty</strong>. These two functions are still to be used privately and are not stable, hence they are prefixed with the character ɵ.</p><p>Let’s see an example of how they can be used.</p><h3>ɵmarkDirty</h3><p>This function will mark a component dirty (e.g. need re-rendering) and will schedule a change detection at some point in the future unless it is already marked dirty.</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ɵmarkDirty <span class="token keyword">as</span> markDirty <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@angular/core&#x27;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token punctuation">{</span>
    <span class="token function">setTitle</span><span class="token punctuation">(</span>title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
        <span class="token function">markDirty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3>ɵdetectChanges</h3><p>For efficiency reasons, the internal documentation discourages the use of <strong>ɵdetectChanges</strong> and recommends using <strong>ɵmarkDirty</strong> instead. This function will synchronously trigger a change detection on the components and subcomponents.</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ɵdetectChanges <span class="token keyword">as</span> detectChanges <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@angular/core&#x27;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token punctuation">{</span>
    <span class="token function">setTitle</span><span class="token punctuation">(</span>title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
        <span class="token function">detectChanges</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2>Automatically detecting changes with a Typescript Decorator</h2><p>While the functions provided by Angular increase the Developer Experience by allowing us to bypass the DI, we may still be unhappy about the fact we need to import and manually call these functions in order to trigger a change detection.</p><p>In order to make automatic change detection easier, we can write a Typescript decorator that can do it for us. Of course, we have some limitations, as we will see, but in my case, it did the job.</p><h3>Introducing the @observed decorator</h3><p>In order to detect changes with minimal effort, we will build a decorator that can be applied in three ways:</p><ul><li><p>to synchronous methods</p></li><li><p>to an Observable</p></li><li><p>to an Object</p></li></ul><p>Let’s see two quick examples. In the image below, we apply the <strong>@observed</strong> decorator to the <strong>state</strong> object and to the <strong>changeName</strong> method.</p><p><img src="https://cdn-images-1.medium.com/max/2872/1*HSndRaDsuxnCcAksBuL8VA.jpeg" loading="lazy"/></p><ul><li><p>to check changes on the <strong>state</strong> object we use a Proxy underneath to intercept changes to the object and trigger a change detection</p></li><li><p>we override the <strong>changeTitle</strong> method it with a function that first calls the method, and then it triggers a change detection</p></li></ul><p>Below, we have an example with a <strong>BehaviorSubject</strong>:</p><p><img src="https://cdn-images-1.medium.com/max/2872/1*XQ9kGVTnR0KHm4l43c3fDQ.jpeg" loading="lazy"/></p><p>For Observables, it gets a little bit more complicated: we need to subscribe to the observable and mark the component dirty in the subscription, but we also need to clean it up. To do that, we override <strong>ngOnInit</strong> and <strong>ngOnDestroy</strong> to subscribe and then clean the subscriptions.</p><h3>Let’s build it!</h3><p>Below is the signature of the <strong>observed</strong> decorator:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>
    target<span class="token operator">:</span> object<span class="token punctuation">,</span>
    propertyKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    descriptor<span class="token operator">?</span><span class="token operator">:</span> PropertyDescriptor
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As you can see above, <strong>descriptor</strong> is optional as we want the decorator to be applied to both methods and properties. If the parameter is defined, then it means the decorator is being applied to a method:</p><ul><li><p>we store the original method’s value</p></li><li><p>we override the method: we call the original function, and then we call <strong>markDirty(<em>this</em>)</strong> in order to trigger a change detection</p></li><li></li></ul><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">if</span> <span class="token punctuation">(</span>descriptor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> original <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// store original</span>
  descriptor<span class="token punctuation">.</span><span class="token function-variable function">value</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// call original</span>
    <span class="token function">markDirty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// check property</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Moving on, we now need to check what type of property we’re dealing with: an Observable or an object. We now introduce another private API provided by Angular, which I am surely not supposed to be using (sorry!):</p><ul><li>the property <strong>ɵcmp</strong> gives us access to the post-definition properties processed by Angular, which we can use to override the methods <strong>onInit</strong> and <strong>onDestroy of the component</strong></li></ul><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">getCmp</span> <span class="token operator">=</span> type <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">.</span>ɵcmp<span class="token punctuation">;</span>
<span class="token keyword">const</span> cmp <span class="token operator">=</span> <span class="token function">getCmp</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> onInit <span class="token operator">=</span> cmp<span class="token punctuation">.</span>onInit <span class="token operator">||</span> noop<span class="token punctuation">;</span>
<span class="token keyword">const</span> onDestroy <span class="token operator">=</span> cmp<span class="token punctuation">.</span>onDestroy <span class="token operator">||</span> noop<span class="token punctuation">;</span>
</code></pre></div><p>In order to mark the property as “to be observed”, we use <strong>ReflectMetadata</strong> and set its value to true so that we know we need to observe the property when the component is initialized:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript">Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> propertyKey<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It’s time to override the <strong>onInit</strong> hook and check the properties when it is instantiated:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript">cmp<span class="token punctuation">.</span><span class="token function-variable function">onInit</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">checkComponentProperties</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">onInit</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Let’s define the function <strong>checkComponentProperties</strong> which will go through the component’s properties, filter them by checking the value we set previously with <strong>Reflect.set</strong>:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">checkComponentProperties</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  props<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">checkProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> propertyKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>The function <strong>checkProperty </strong>will be responsible for decorating the individual properties. First, we want to check if the property is an Observable or an object. If it is an Observable, then we subscribe to it, and we add the subscription to a list of subscriptions that we store privately on the component.</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">checkProperty</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Observable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> subscriptions <span class="token operator">=</span> <span class="token function">getSubscriptions</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    subscriptions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ctx<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">markDirty</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// check object</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>If instead, the property is an object, we convert it to a Proxy, and we call markDirty in its handler function.</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token function">ɵmarkDirty</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ctx<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Finally, we want to clean up the subscriptions when the component is destroyed:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript">cmp<span class="token punctuation">.</span><span class="token function-variable function">onDestroy</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">[</span>subscriptionsSymbol<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">[</span>subscriptionsSymbol<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">onDestroy</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>This decorator is not exhaustive and <strong>will not cover all cases</strong> needed by large applications (ex. template function calls that return Observables, but I’m working on that…).</p><p>Though, it was enough to convert my small application. The full source code can be found at the end of this article.</p><h2>Performance Results and Considerations</h2><p>Now that we learned a little bit about the internals of Ivy and how to build a decorator that makes use of its API, it’s time to test it on a real application.</p><p>I used my guinea-pig project <a href="https://github.com/gbuomprisco/cryptofolio" target="_blank" rel="noopener noreferrer">Cryptofolio</a> in order to test the performance changes brought by adding and removing Zone.</p><p>I applied the decorator to all the template references needed, and I removed Zone. For example, see the below component:</p><ul><li>the two variables used in the template are the price (number) and trend (up, stale, down), and I decorated both of them with @observed</li></ul><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AssetPricerComponent</span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">observed</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> price$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">observed</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> trend$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>Trend<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3>Bundle Size</h3><p>First of all, let’s check by how much the size of the bundle will be reduced by removing Zone.js. In the image below, we can see the build result with Zone:</p><p><img src="https://cdn-images-1.medium.com/max/2986/1*ZrYc8YBXvr5nuZKYL5ZRvQ.png" alt="Build With Zone" loading="lazy"/></p><p>Anf the below was taken without Zone:</p><p><img src="https://cdn-images-1.medium.com/max/2896/1*iGNl5sL_H1A6sC-bxoP5zA.png" alt="Build Without Zone" loading="lazy"/></p><p>Taking into account the ES2015 bundle, it’s clear that Zone takes almost 35kB of space, while the bundle without Zone is only 130 bytes.</p><h3>Initial Load</h3><p>I took some audits with Lighthouse, with no throttling: I wouldn’t take the below results <em>too</em> seriously: in fact, the results varied quite a bit while I was trying to average the results.</p><p>It’s possible though that the difference in bundle size is why the version without Zone has a slightly better score. The audit below was taken with Zone:</p><p><img src="https://cdn-images-1.medium.com/max/3166/1*6eg8z2O3e6j4eSDohjQhIw.png" alt="Audit with Zone" loading="lazy"/></p><p>The below, instead, was taken without Zone:</p><p><img src="https://cdn-images-1.medium.com/max/3238/1*gHPNceylTa37lX95g74fiA.png" alt="Audit without Zone" loading="lazy"/></p><h3>Runtime Performance 🚀</h3><p>And now we get to the fun part: runtime performance under load. We want to check how the CPU behaves when rendering hundreds of prices updated multiple times per second.</p><p>In order to put the application under load, I created about 100 pricers emitting mock data, with each price <strong>changing every 250ms</strong>. Every price will show up green if it increased, or red if it decreased. This can put my MacBook Pro under a fair amount of load.</p><blockquote><p> Working in the financial sector on a number of high-frequency streaming applications, this is a scenario I came across multiple times.</p></blockquote><p>I used the Chrome Dev Tools to analyzed the CPU usage of each version. Let’s start with Angular with Zone:</p><p><img src="https://cdn-images-1.medium.com/max/6684/1*OHPJ7-Xjfb2Z2k_aO92leQ.gif" loading="lazy"/></p><p>The below is taken without Zone:</p><p><img src="https://cdn-images-1.medium.com/max/6684/1*wnaSQ_ishYAJfxoXF5pCVA.gif" alt="Runtime Performance WIthout Zone" loading="lazy"/></p><p>Let’s analyze the above, and take a look ar the CPU usage graph (the yellow one):</p><ul><li><p>As you can see, in the zone version the CPU usage is constantly between 70% and 100%! Keep a tab under this load for enough time, and it will surely crash</p></li><li><p>In the second one, instead, the usage is stable at between 30% and 40%. Sweet!</p></li></ul><p><strong>Notice:</strong> The results above are taken with the DevTools open, which decreases performance</p><h3>Increasing the load</h3><p>I went on and tried to update 4 more prices every second for each pricer:</p><ul><li><p>The non-Zone version was still able to manage the load without a problem with 50% CPU usage</p></li><li><p>I was able to bring the CPU close to the same load as the Zone version only by <strong>updating a price every 10ms</strong> (x 100 pricers)</p></li></ul><h2>Benchmarking with Angular Benchpress</h2><p>The above is not the most scientific benchmark there is nor it aims to be, so I’d suggest you to <a href="https://krausest.github.io/js-framework-benchmark/current.html" target="_blank" rel="noopener noreferrer">check out this benchmark</a> and uncheck all the frameworks but Angular and Zoneless Angular.</p><p>I took some inspiration from it, and <a href="https://github.com/Gbuomprisco/zoneless-angular" target="_blank" rel="noopener noreferrer">I created a project</a> that executes some heavy operations which I benchmarked it with <a href="https://github.com/angular/angular/tree/master/packages/benchpress" target="_blank" rel="noopener noreferrer">Angular Benchpress</a>.</p><p>Let’s see the component tested:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">observed</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">run</span><span class="token punctuation">(</span>length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildData</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">observed</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">append</span><span class="token punctuation">(</span>length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildData</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">observed</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">observed</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">remove</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">===</span> item<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">trackById</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> item<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">buildData</span><span class="token punctuation">(</span>length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">const</span> end <span class="token operator">=</span> start <span class="token operator">+</span> length<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> n <span class="token operator">=</span> start<span class="token punctuation">;</span> n <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        id<span class="token operator">:</span> n<span class="token punctuation">,</span>
        label<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>I then run a small benchmarking suite with Protractor and Benchpress: it executes the operations for a specified number of times.</p><p><img src="https://cdn-images-1.medium.com/max/4780/1*MSpwgSWb4kMmF_DQ1fSqXw.gif" alt="Benchpress in Action" loading="lazy"/></p><h3>Results</h3><p>Here’s a sample of the output returned by this tool:</p><p><img src="https://cdn-images-1.medium.com/max/3646/1*iTx3gtXSHdtQMtTpvPOAaA.png" alt="Benchpress Output" loading="lazy"/></p><p>And here’s an explanation of the metrics returned by the output:</p><div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">- gcAmount: gc amount in kbytes
- gcTime: gc time in ms
- majorGcTime: time of major gcs in ms
- pureScriptTime: script execution time in ms, without gc nor render
- renderTime: render time in ms
- scriptTime: script execution time in ms, including gc and render</code></pre></div><p><strong>Notice</strong>: The graphs below will only show the rendering time. The complete outputs can be found at <a href="https://github.com/Gbuomprisco/zoneless-angular" target="_blank" rel="noopener noreferrer">the following link</a>.</p><h3>Test: Create 1000 Rows</h3><p>The first test creates 1000 rows:</p><p><img src="https://cdn-images-1.medium.com/max/2400/1*M_Xf_UFY44GlSPYQVrYFqQ.png" loading="lazy"/></p><h3>Test: Create 10000 Rows</h3><p>As the load gets heavier, we can see a bigger difference:</p><p><img src="https://cdn-images-1.medium.com/max/2400/1*4MNMFldeEsqoLpVXxdZ9dA.png" loading="lazy"/></p><h3>Test: Append 1000 Rows</h3><p>This test appends 1000 rows to a list of 10000:</p><p><img src="https://cdn-images-1.medium.com/max/2400/1*nf9Y3LciXdGC5doeTdxaJg.png" loading="lazy"/></p><h3>Test: Remove 10000 Rows</h3><p>This test creates 10000 rows and removes them:</p><p><img src="https://cdn-images-1.medium.com/max/2400/1*00zTob3NtHKEZuT-Upnh2g.png" loading="lazy"/></p><h2>Final Words</h2><p>While I do hope you enjoyed the article, I also hope I didn’t just convince you to run to the office and remove Zone from your project: this strategy <strong>should be the very last thing</strong> you may want to do if you plan on increasing the performance of an Angular application.</p><p>Techniques such as OnPush change detection, <em>trackBy</em>, detaching components, running outside of Zone, and blacklisting Zone events (among many others) should always be preferred. The tradeoffs are significant and it’s a tax you may not want pay.</p><p>In fact, developing without Zone may still be quite daunting, unless you have complete control over the project (e.g. you own the dependencies and have the freedom and time to manage the overhead).</p><p>If all else fails, and you think Zone may actually be a bottleneck, then it may be a good idea to try and give Angular a further boost by manually detecting changes.</p><p>I hope this article gave you a good idea of what may be coming to Angular, what Ivy makes possible to do, and how you can work around Zone to achieve maximum speed for your applications.</p><h3><a href="https://gist.github.com/Gbuomprisco/e6b3f762b0be6f3ce296af49253cc4e3" target="_blank" rel="noopener noreferrer">Source Code</a></h3><p>The source code for the Typescript decorator can be found at its <a href="https://github.com/Gbuomprisco/ngx-toolkit/blob/master/projects/observed-property/src/lib/index.ts" target="_blank" rel="noopener noreferrer">Github Project</a> page:
{% gist <a href="https://gist.github.com/Gbuomprisco/e6b3f762b0be6f3ce296af49253cc4e3.js" target="_blank" rel="noopener noreferrer">https://gist.github.com/Gbuomprisco/e6b3f762b0be6f3ce296af49253cc4e3.js</a> %}</p><h3>Resources</h3><ul><li><p><a href="https://krausest.github.io/js-framework-benchmark/current.html" target="_blank" rel="noopener noreferrer">Frontend Frameworks Benchmark</a></p></li><li><p><a href="https://github.com/Gbuomprisco/zoneless-angular" target="_blank" rel="noopener noreferrer">Zoneless Benchmark Project</a> (zone branch contains the code with Zone)</p></li><li><p><a href="https://github.com/ngrx/platform/issues/2052" target="_blank" rel="noopener noreferrer">RFC: Component: Proposal for a new package <code>component</code></a></p></li><li><p><a href="https://www.youtube.com/watch?v=rz-rcaGXhGk" target="_blank" rel="noopener noreferrer">Building with Ivy: rethinking reactive Angular</a></p></li></ul><p>If you need any clarifications, or if you think something is unclear or wrong, do please leave a comment!</p></div></article><div class="max-w-2xl mx-auto"></div><div class="w-full md:w-8/12 mx-auto my-4"><script async="" data-uid="3e3126f064" src="https://thoughtful-inventor-7842.ck.page/3e3126f064/index.js"></script></div><div><hr class="border-accent-2 mt-16 mb-14"/><h3 class="text-2xl md:text-3xl text-center font-semibold my-4 md:my-12 flex flex-row space-x-4 items-center justify-center"><span>Learn more about</span> <div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:28px;height:28px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></h3><section><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 md:gap-x-12 lg:gap-x-14 gap-y-20 md:gap-y-24 mb-32"><div class="shadow-lg rounded-md hover:shadow-xl transition-shadow duration-500"><div class="mb-3"><div class="sm:mx-0"><a aria-label="Benchmarking Angular 12 with Webpack 5" href="/angular/webpack-5-angular12"><img class="block transition-shadow duration-500 h-full w-full lg:h-48 xl:h-48 rounded-t-md" src="/assets/images/posts/benchmarking-webpack-5.webp" alt="Cover Image for Benchmarking Angular 12 with Webpack 5" loading="lazy"/></a></div></div><div class="px-4 py-2"><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/webpack-5-angular12">Benchmarking Angular 12 with Webpack 5</a></h3></div><div class="text-xs mb-4 flex flex-row space-x-2 items-center px-4"><div class="text-gray-600"><time dateTime="2021-05-14T00:00:00.322Z">May 14, 2021</time></div><span class="text-gray-600">·</span><span class="text-gray-600">2 min read</span><span class="text-gray-600">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:16px;height:16px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 px-4 text-sm">Angular 12 has been released and with it the much awaited Webpack 5 upgrade. In this post I benchmarked the bundle-size and compilation speed against the previous version</p></div><div class="shadow-lg rounded-md hover:shadow-xl transition-shadow duration-500"><div class="mb-3"><div class="sm:mx-0"><a aria-label="Principles for creating libraries with Nx and Angular" href="/angular/how-to-organize-nx-modules-with-angular"><img class="block transition-shadow duration-500 h-full w-full lg:h-48 xl:h-48 rounded-t-md" src="/assets/images/posts/organize-nx-modules-ngrx.webp" alt="Cover Image for Principles for creating libraries with Nx and Angular" loading="lazy"/></a></div></div><div class="px-4 py-2"><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/how-to-organize-nx-modules-with-angular">Principles for creating libraries with Nx and Angular</a></h3></div><div class="text-xs mb-4 flex flex-row space-x-2 items-center px-4"><div class="text-gray-600"><time dateTime="2021-02-07T00:00:00.322Z">Feb 7, 2021</time></div><span class="text-gray-600">·</span><span class="text-gray-600">5 min read</span><span class="text-gray-600">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:16px;height:16px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 px-4 text-sm">Working with Nx may be confusing. This article explains how I create Nx libraries and the principles behind my motivations</p></div><div class="shadow-lg rounded-md hover:shadow-xl transition-shadow duration-500"><div class="mb-3"><div class="sm:mx-0"><a aria-label="Where to put your Angular models?" href="/angular/angular-where-to-put-models"><img class="block transition-shadow duration-500 h-full w-full lg:h-48 xl:h-48 rounded-t-md" src="/assets/images/posts/where-put-angular-models.webp" alt="Cover Image for Where to put your Angular models?" loading="lazy"/></a></div></div><div class="px-4 py-2"><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/angular-where-to-put-models">Where to put your Angular models?</a></h3></div><div class="text-xs mb-4 flex flex-row space-x-2 items-center px-4"><div class="text-gray-600"><time dateTime="2020-08-03T00:00:00.322Z">Aug 3, 2020</time></div><span class="text-gray-600">·</span><span class="text-gray-600">3 min read</span><span class="text-gray-600">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:16px;height:16px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 px-4 text-sm">Organizing entities and models in your Angular app may be hard. This article explains where to put your entities and what mistakes to watch out for</p></div><div class="shadow-lg rounded-md hover:shadow-xl transition-shadow duration-500"><div class="mb-3"><div class="sm:mx-0"><a aria-label="Using the Intersection Observer API with Angular" href="/angular/intersection-observer-with-angular"><img class="block transition-shadow duration-500 h-full w-full lg:h-48 xl:h-48 rounded-t-md" src="/assets/images/posts/intersection-observer.webp" alt="Cover Image for Using the Intersection Observer API with Angular" loading="lazy"/></a></div></div><div class="px-4 py-2"><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/intersection-observer-with-angular">Using the Intersection Observer API with Angular</a></h3></div><div class="text-xs mb-4 flex flex-row space-x-2 items-center px-4"><div class="text-gray-600"><time dateTime="2020-08-01T00:00:00.322Z">Aug 1, 2020</time></div><span class="text-gray-600">·</span><span class="text-gray-600">5 min read</span><span class="text-gray-600">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:16px;height:16px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 px-4 text-sm">This article shows how to build a directive with Angular that uses the Intersection Observer API to check when an element becomes visible on the page</p></div><div class="shadow-lg rounded-md hover:shadow-xl transition-shadow duration-500"><div class="mb-3"><div class="sm:mx-0"><a aria-label="Setters vs ngOnChanges: which one is better?" href="/angular/setters-vs-ng-on-changes"><img class="block transition-shadow duration-500 h-full w-full lg:h-48 xl:h-48 rounded-t-md" src="/assets/images/posts/setters-vs-on-changes.webp" alt="Cover Image for Setters vs ngOnChanges: which one is better?" loading="lazy"/></a></div></div><div class="px-4 py-2"><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/setters-vs-ng-on-changes">Setters vs ngOnChanges: which one is better?</a></h3></div><div class="text-xs mb-4 flex flex-row space-x-2 items-center px-4"><div class="text-gray-600"><time dateTime="2020-07-30T00:00:00.322Z">Jul 30, 2020</time></div><span class="text-gray-600">·</span><span class="text-gray-600">3 min read</span><span class="text-gray-600">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:16px;height:16px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 px-4 text-sm">Listening to Input changes can be done in different ways. But which one should you use?</p></div><div class="shadow-lg rounded-md hover:shadow-xl transition-shadow duration-500"><div class="mb-3"><div class="sm:mx-0"><a aria-label="Async Rendering with a single Rx Operator" href="/angular/async-rendering-with-a-single-rx-operator"><img class="block transition-shadow duration-500 h-full w-full lg:h-48 xl:h-48 rounded-t-md" src="/assets/images/posts/async-rendering.webp" alt="Cover Image for Async Rendering with a single Rx Operator" loading="lazy"/></a></div></div><div class="px-4 py-2"><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/async-rendering-with-a-single-rx-operator">Async Rendering with a single Rx Operator</a></h3></div><div class="text-xs mb-4 flex flex-row space-x-2 items-center px-4"><div class="text-gray-600"><time dateTime="2020-07-11T00:00:00.322Z">Jul 11, 2020</time></div><span class="text-gray-600">·</span><span class="text-gray-600">3 min read</span><span class="text-gray-600">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:16px;height:16px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 px-4 text-sm">Increase your app rendering performance with this simple Rx operator</p></div></div></section></div></div></div></main></div><footer><div class="container mx-auto px-5"><hr class="border-accent-2 mt-16 mb-14"/><div class="flex-row flex justify-between items-center py-2 mt-6 mb-8"><a class="hover:underline" href="/"><b>GIANCARLO</b><span>BUOMPRISCO</span></a><div class="justify-end lg:hidden flex"><button aria-label="Open Menu" class="navbar-burger" type="button"><span class="block relative w-7 rounded-sm bg-black h-1"></span><span class="block relative w-7 rounded-sm bg-black h-1 mt-1"></span><span class="block relative w-7 rounded-sm bg-black h-1 mt-1"></span></button></div><ul class="lg:space-x-10 text-gray-800 px-4 hidden flex-col space-y-4 lg:space-y-0 lg:flex lg:flex-row nav"><li class="flex flex-row justify-between mb-6 lg:hidden"><div><a class="hover:underline" href="/"><b>GIANCARLO</b><span>BUOMPRISCO</span></a></div><div class="flex justify-end"><span class="bg-gray-100 font-bold text-sm rounded-full shadow-xl flex items-center justify-center w-16 h-16">Close</span></div></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/blog">Blog</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/articles">Articles</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/consulting">Consulting</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/about">About</a></li><li class="text-lg lg:text-base border-b-4 pb-1 border-b-transparent transition:border hover:text-gray-900 font-medium border-b-transparent hover:border-b-yellow-200"><a class="block" href="/contact">Contact me</a></li></ul></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"live":true,"readingTime":"11 min read","title":"Quantum Angular: Maximizing Performance by Removing Zone","date":"2019-11-19T00:00:00.000Z","slug":"maximizing-angular-performance-removing-zone-1","coverImage":"https://cdn-images-1.medium.com/max/5746/0*EfvtinXlbA0f1Uf6","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"Experiment: Removing Zone from Angular with minimal effort, to boost runtime performance","content":"\nAs Angular developers, we owe Zone a great deal: it’s also thanks to this library that we can use Angular almost magically; in fact, most times we simply need to change a property and **it just works**, Angular re-renders our components, and the view is always up to date. Pretty cool.\n\nIn this article, I want to explore some ways in which the new Angular Ivy compiler (being released in version 9) will be able to make apps **work without Zone** much simpler than it was in the past.\n\nAs a result, I was able to increase the performance of an application under heavy load by a huge amount by adding as little overhead as possible using Typescript’s decorators.\n\n**Notice**: the approaches explained in this article are only possible thanks to **Angular Ivy and AOT enabled by default**. This article is educational only and doesn’t aim to advertise the code described.\n\n## The case for using Angular without Zone\n\nWait a moment, though: is it worth disabling *Zone* as it allows us to effortlessly re-render our templates? Yes, it is incredibly useful, but as always, **magic comes at a cost**.\n\nIf your application needs a special performance target, disabling *Zone* can help deliver better performance for your application: an example of a case-scenario where performance can actually be game-changing is high-frequency updates, which is an issue I had while working on a real-time trading application, where a WebSocket was continuously sending messages to the client.\n\n## Removing Zone from Angular\n\nRunning Angular without Zone is pretty simple. The first step is to comment out or remove the import statement in the file polyfills.ts:\n\n![](https://cdn-images-1.medium.com/max/2070/1*aO5CRXz99wZiAUDTN7XDCw.png)\n\nThe second step is to Bootstrap the root module with the following options:\n\n```typescript\nplatformBrowserDynamic()\n    .bootstrapModule(AppModule, {\n    ngZone: 'noop'\n    })\n    .catch(err =\u003e console.error(err));\n```\n\n## Angular Ivy: Manually Detecting Changes with ɵdetectChanges and ɵmarkDirty\n\nBefore we can start building our Typescript decorator, we need to see how Ivy allows us to bypass Zone and DI and trigger a change detection on a component by marking it dirty.\n\nWe can now use two more functions exported from @angular/core: **ɵdetectChanges** and **ɵmarkDirty**. These two functions are still to be used privately and are not stable, hence they are prefixed with the character ɵ.\n\nLet’s see an example of how they can be used.\n\n### ɵmarkDirty\n\nThis function will mark a component dirty (e.g. need re-rendering) and will schedule a change detection at some point in the future unless it is already marked dirty.\n\n```typescript\nimport { ɵmarkDirty as markDirty } from '@angular/core';\n\n@Component({...})\nclass MyComponent {\n    setTitle(title: string) {\n        this.title = title;\n        markDirty(this);\n    }\n}\n```\n\n### ɵdetectChanges\n\nFor efficiency reasons, the internal documentation discourages the use of **ɵdetectChanges** and recommends using **ɵmarkDirty** instead. This function will synchronously trigger a change detection on the components and subcomponents.\n\n```typescript\nimport { ɵdetectChanges as detectChanges } from '@angular/core';\n\n@Component({...})\nclass MyComponent {\n    setTitle(title: string) {\n        this.title = title;\n        detectChanges(this);\n    }\n}\n```\n\n## Automatically detecting changes with a Typescript Decorator\n\nWhile the functions provided by Angular increase the Developer Experience by allowing us to bypass the DI, we may still be unhappy about the fact we need to import and manually call these functions in order to trigger a change detection.\n\nIn order to make automatic change detection easier, we can write a Typescript decorator that can do it for us. Of course, we have some limitations, as we will see, but in my case, it did the job.\n\n### Introducing the @observed decorator\n\nIn order to detect changes with minimal effort, we will build a decorator that can be applied in three ways:\n\n* to synchronous methods\n\n* to an Observable\n\n* to an Object\n\nLet’s see two quick examples. In the image below, we apply the **@observed** decorator to the **state** object and to the **changeName** method.\n\n![](https://cdn-images-1.medium.com/max/2872/1*HSndRaDsuxnCcAksBuL8VA.jpeg)\n\n* to check changes on the **state** object we use a Proxy underneath to intercept changes to the object and trigger a change detection\n\n* we override the **changeTitle** method it with a function that first calls the method, and then it triggers a change detection\n\nBelow, we have an example with a **BehaviorSubject**:\n\n![](https://cdn-images-1.medium.com/max/2872/1*XQ9kGVTnR0KHm4l43c3fDQ.jpeg)\n\nFor Observables, it gets a little bit more complicated: we need to subscribe to the observable and mark the component dirty in the subscription, but we also need to clean it up. To do that, we override **ngOnInit** and **ngOnDestroy** to subscribe and then clean the subscriptions.\n\n### Let’s build it!\n\nBelow is the signature of the **observed** decorator:\n```typescript\nexport function observed() {\n  return function(\n    target: object,\n    propertyKey: string,\n    descriptor?: PropertyDescriptor\n  ) {}\n}\n```\n\nAs you can see above, **descriptor** is optional as we want the decorator to be applied to both methods and properties. If the parameter is defined, then it means the decorator is being applied to a method:\n\n* we store the original method’s value\n\n* we override the method: we call the original function, and then we call **markDirty(*this*)** in order to trigger a change detection\n* \n```typescript\nif (descriptor) {\n  const original = descriptor.value; // store original\n  descriptor.value = function(...args: any[]) {\n    original.apply(this, args); // call original\n    markDirty(this);\n  };\n} else {\n  // check property\n}\n```\n\nMoving on, we now need to check what type of property we’re dealing with: an Observable or an object. We now introduce another private API provided by Angular, which I am surely not supposed to be using (sorry!):\n\n* the property **ɵcmp** gives us access to the post-definition properties processed by Angular, which we can use to override the methods **onInit** and **onDestroy of the component**\n\n```typescript\nconst getCmp = type =\u003e (type).ɵcmp;\nconst cmp = getCmp(target.constructor);\nconst onInit = cmp.onInit || noop;\nconst onDestroy = cmp.onDestroy || noop;\n```\n\nIn order to mark the property as “to be observed”, we use **ReflectMetadata** and set its value to true so that we know we need to observe the property when the component is initialized:\n\n```typescript\nReflect.set(target, propertyKey, true);\n```\n\nIt’s time to override the **onInit** hook and check the properties when it is instantiated:\n\n```typescript\ncmp.onInit = function() {\n  checkComponentProperties(this);\n  onInit.call(this);\n};\n```\n\nLet’s define the function **checkComponentProperties** which will go through the component’s properties, filter them by checking the value we set previously with **Reflect.set**:\n```typescript\nconst checkComponentProperties = (ctx) =\u003e {\n  const props = Object.getOwnPropertyNames(ctx);\n\n  props.map((prop) =\u003e {\n    return Reflect.get(target, prop);\n  }).filter(Boolean).forEach(() =\u003e {\n    checkProperty.call(ctx, propertyKey);\n  });\n};\n```\n\nThe function **checkProperty **will be responsible for decorating the individual properties. First, we want to check if the property is an Observable or an object. If it is an Observable, then we subscribe to it, and we add the subscription to a list of subscriptions that we store privately on the component.\n\n```typescript\nconst checkProperty = function(name: string) {\n  const ctx = this;\n\n  if (ctx[name] instanceof Observable) {\n    const subscriptions = getSubscriptions(ctx);\n    subscriptions.add(ctx[name].subscribe(() =\u003e {\n      markDirty(ctx);\n    }));\n  } else {\n    // check object\n  }\n};\n```\n\nIf instead, the property is an object, we convert it to a Proxy, and we call markDirty in its handler function.\n\n```typescript\nconst handler = {\n  set(obj, prop, value) {\n    obj[prop] = value;\n    ɵmarkDirty(ctx);\n    return true;\n  }\n};\n\nctx[name] = new Proxy(ctx, handler);\n```\n\nFinally, we want to clean up the subscriptions when the component is destroyed:\n\n```typescript\ncmp.onDestroy = function() {\n  const ctx = this;\n  if (ctx[subscriptionsSymbol]) {\n    ctx[subscriptionsSymbol].unsubscribe();\n  }\n  onDestroy.call(ctx);\n};\n```\n\nThis decorator is not exhaustive and **will not cover all cases** needed by large applications (ex. template function calls that return Observables, but I’m working on that…).\n\nThough, it was enough to convert my small application. The full source code can be found at the end of this article.\n\n## Performance Results and Considerations\n\nNow that we learned a little bit about the internals of Ivy and how to build a decorator that makes use of its API, it’s time to test it on a real application.\n\nI used my guinea-pig project [Cryptofolio](https://github.com/gbuomprisco/cryptofolio) in order to test the performance changes brought by adding and removing Zone.\n\nI applied the decorator to all the template references needed, and I removed Zone. For example, see the below component:\n\n* the two variables used in the template are the price (number) and trend (up, stale, down), and I decorated both of them with @observed\n\n```typescript\n@Component({...})\nexport class AssetPricerComponent {\n  @observed() price$: Observable\u003cstring\u003e;\n  @observed() trend$: Observable\u003cTrend\u003e;\n  \n  // ...\n}\n```\n\n### Bundle Size\n\nFirst of all, let’s check by how much the size of the bundle will be reduced by removing Zone.js. In the image below, we can see the build result with Zone:\n\n![Build With Zone](https://cdn-images-1.medium.com/max/2986/1*ZrYc8YBXvr5nuZKYL5ZRvQ.png)\n\nAnf the below was taken without Zone:\n\n![Build Without Zone](https://cdn-images-1.medium.com/max/2896/1*iGNl5sL_H1A6sC-bxoP5zA.png)\n\nTaking into account the ES2015 bundle, it’s clear that Zone takes almost 35kB of space, while the bundle without Zone is only 130 bytes.\n\n### Initial Load\n\nI took some audits with Lighthouse, with no throttling: I wouldn’t take the below results *too* seriously: in fact, the results varied quite a bit while I was trying to average the results.\n\nIt’s possible though that the difference in bundle size is why the version without Zone has a slightly better score. The audit below was taken with Zone:\n\n![Audit with Zone](https://cdn-images-1.medium.com/max/3166/1*6eg8z2O3e6j4eSDohjQhIw.png)\n\nThe below, instead, was taken without Zone:\n\n![Audit without Zone](https://cdn-images-1.medium.com/max/3238/1*gHPNceylTa37lX95g74fiA.png)\n\n### Runtime Performance 🚀\n\nAnd now we get to the fun part: runtime performance under load. We want to check how the CPU behaves when rendering hundreds of prices updated multiple times per second.\n\nIn order to put the application under load, I created about 100 pricers emitting mock data, with each price **changing every 250ms**. Every price will show up green if it increased, or red if it decreased. This can put my MacBook Pro under a fair amount of load.\n\u003e  Working in the financial sector on a number of high-frequency streaming applications, this is a scenario I came across multiple times.\n\nI used the Chrome Dev Tools to analyzed the CPU usage of each version. Let’s start with Angular with Zone:\n\n![](https://cdn-images-1.medium.com/max/6684/1*OHPJ7-Xjfb2Z2k_aO92leQ.gif)\n\nThe below is taken without Zone:\n\n![Runtime Performance WIthout Zone](https://cdn-images-1.medium.com/max/6684/1*wnaSQ_ishYAJfxoXF5pCVA.gif)\n\nLet’s analyze the above, and take a look ar the CPU usage graph (the yellow one):\n\n* As you can see, in the zone version the CPU usage is constantly between 70% and 100%! Keep a tab under this load for enough time, and it will surely crash\n\n* In the second one, instead, the usage is stable at between 30% and 40%. Sweet!\n\n**Notice:** The results above are taken with the DevTools open, which decreases performance\n\n### Increasing the load\n\nI went on and tried to update 4 more prices every second for each pricer:\n\n* The non-Zone version was still able to manage the load without a problem with 50% CPU usage\n\n* I was able to bring the CPU close to the same load as the Zone version only by **updating a price every 10ms** (x 100 pricers)\n\n## Benchmarking with Angular Benchpress\n\nThe above is not the most scientific benchmark there is nor it aims to be, so I’d suggest you to [check out this benchmark](https://krausest.github.io/js-framework-benchmark/current.html) and uncheck all the frameworks but Angular and Zoneless Angular.\n\nI took some inspiration from it, and [I created a project](https://github.com/Gbuomprisco/zoneless-angular) that executes some heavy operations which I benchmarked it with [Angular Benchpress](https://github.com/angular/angular/tree/master/packages/benchpress).\n\nLet’s see the component tested:\n\n```typescript\n@Component({...})\nexport class AppComponent {\n  public data = [];\n\n  @observed()\n  run(length: number) {\n    this.clear();\n    this.buildData(length);\n  }\n\n  @observed()\n  append(length: number) {\n    this.buildData(length);\n  }\n\n  @observed()\n  removeAll() {\n    this.clear();\n  }\n\n  @observed()\n  remove(item) {\n    for (let i = 0, l = this.data.length; i \u003c l; i++) {\n      if (this.data[i].id === item.id) {\n        this.data.splice(i, 1);\n        break;\n      }\n    }\n  }\n\n  trackById(item) {\n    return item.id;\n  }\n\n  private clear() {\n    this.data = [];\n  }\n\n  private buildData(length: number) {\n    const start = this.data.length;\n    const end = start + length;\n\n    for (let n = start; n \u003c= end; n++) {\n      this.data.push({\n        id: n,\n        label: Math.random()\n      });\n    }\n  }\n}\n```\n\nI then run a small benchmarking suite with Protractor and Benchpress: it executes the operations for a specified number of times.\n\n![Benchpress in Action](https://cdn-images-1.medium.com/max/4780/1*MSpwgSWb4kMmF_DQ1fSqXw.gif)\n\n### Results\n\nHere’s a sample of the output returned by this tool:\n\n![Benchpress Output](https://cdn-images-1.medium.com/max/3646/1*iTx3gtXSHdtQMtTpvPOAaA.png)\n\nAnd here’s an explanation of the metrics returned by the output:\n\n```\n- gcAmount: gc amount in kbytes\n- gcTime: gc time in ms\n- majorGcTime: time of major gcs in ms\n- pureScriptTime: script execution time in ms, without gc nor render\n- renderTime: render time in ms\n- scriptTime: script execution time in ms, including gc and render\n```\n\n**Notice**: The graphs below will only show the rendering time. The complete outputs can be found at [the following link](https://github.com/Gbuomprisco/zoneless-angular).\n\n### Test: Create 1000 Rows\n\nThe first test creates 1000 rows:\n\n![](https://cdn-images-1.medium.com/max/2400/1*M_Xf_UFY44GlSPYQVrYFqQ.png)\n\n### Test: Create 10000 Rows\n\nAs the load gets heavier, we can see a bigger difference:\n\n![](https://cdn-images-1.medium.com/max/2400/1*4MNMFldeEsqoLpVXxdZ9dA.png)\n\n### Test: Append 1000 Rows\n\nThis test appends 1000 rows to a list of 10000:\n\n![](https://cdn-images-1.medium.com/max/2400/1*nf9Y3LciXdGC5doeTdxaJg.png)\n\n### Test: Remove 10000 Rows\n\nThis test creates 10000 rows and removes them:\n\n![](https://cdn-images-1.medium.com/max/2400/1*00zTob3NtHKEZuT-Upnh2g.png)\n\n## Final Words\n\nWhile I do hope you enjoyed the article, I also hope I didn’t just convince you to run to the office and remove Zone from your project: this strategy **should be the very last thing** you may want to do if you plan on increasing the performance of an Angular application.\n\nTechniques such as OnPush change detection, *trackBy*, detaching components, running outside of Zone, and blacklisting Zone events (among many others) should always be preferred. The tradeoffs are significant and it’s a tax you may not want pay.\n\nIn fact, developing without Zone may still be quite daunting, unless you have complete control over the project (e.g. you own the dependencies and have the freedom and time to manage the overhead).\n\nIf all else fails, and you think Zone may actually be a bottleneck, then it may be a good idea to try and give Angular a further boost by manually detecting changes.\n\nI hope this article gave you a good idea of what may be coming to Angular, what Ivy makes possible to do, and how you can work around Zone to achieve maximum speed for your applications.\n\n### [Source Code](https://gist.github.com/Gbuomprisco/e6b3f762b0be6f3ce296af49253cc4e3)\n\nThe source code for the Typescript decorator can be found at its [Github Project](https://github.com/Gbuomprisco/ngx-toolkit/blob/master/projects/observed-property/src/lib/index.ts) page:\n{% gist https://gist.github.com/Gbuomprisco/e6b3f762b0be6f3ce296af49253cc4e3.js %}\n### Resources\n\n* [Frontend Frameworks Benchmark](https://krausest.github.io/js-framework-benchmark/current.html)\n\n* [Zoneless Benchmark Project](https://github.com/Gbuomprisco/zoneless-angular) (zone branch contains the code with Zone)\n\n* [RFC: Component: Proposal for a new package `component`](https://github.com/ngrx/platform/issues/2052)\n\n* [Building with Ivy: rethinking reactive Angular](https://www.youtube.com/watch?v=rz-rcaGXhGk)\n\nIf you need any clarifications, or if you think something is unclear or wrong, do please leave a comment!","canonical":"https://blog.bitsrc.io/quantum-angular-maximizing-performance-by-removing-zone-e0eefe85b8d8","tags":["angular","performance"]},"content":{"compiledSource":"var N=Object.defineProperty,l=Object.defineProperties;var u=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable;var r=(e,n,t)=\u003en in e?N(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,a=(e,n)=\u003e{for(var t in n||(n={}))o.call(n,t)\u0026\u0026r(e,t,n[t]);if(p)for(var t of p(n))c.call(n,t)\u0026\u0026r(e,t,n[t]);return e},m=(e,n)=\u003el(e,u(n));var i=(e,n)=\u003e{var t={};for(var s in e)o.call(e,s)\u0026\u0026n.indexOf(s)\u003c0\u0026\u0026(t[s]=e[s]);if(e!=null\u0026\u0026p)for(var s of p(e))n.indexOf(s)\u003c0\u0026\u0026c.call(e,s)\u0026\u0026(t[s]=e[s]);return t};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(t){var s=t,{components:e}=s,n=i(s,[\"components\"]);return mdx(MDXLayout,m(a(a({},layoutProps),n),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"As Angular developers, we owe Zone a great deal: it\\u2019s also thanks to this library that we can use Angular almost magically; in fact, most times we simply need to change a property and \",mdx(\"strong\",{parentName:\"p\"},\"it just works\"),\", Angular re-renders our components, and the view is always up to date. Pretty cool.\"),mdx(\"p\",null,\"In this article, I want to explore some ways in which the new Angular Ivy compiler (being released in version 9) will be able to make apps \",mdx(\"strong\",{parentName:\"p\"},\"work without Zone\"),\" much simpler than it was in the past.\"),mdx(\"p\",null,\"As a result, I was able to increase the performance of an application under heavy load by a huge amount by adding as little overhead as possible using Typescript\\u2019s decorators.\"),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Notice\"),\": the approaches explained in this article are only possible thanks to \",mdx(\"strong\",{parentName:\"p\"},\"Angular Ivy and AOT enabled by default\"),\". This article is educational only and doesn\\u2019t aim to advertise the code described.\"),mdx(\"h2\",null,\"The case for using Angular without Zone\"),mdx(\"p\",null,\"Wait a moment, though: is it worth disabling \",mdx(\"em\",{parentName:\"p\"},\"Zone\"),\" as it allows us to effortlessly re-render our templates? Yes, it is incredibly useful, but as always, \",mdx(\"strong\",{parentName:\"p\"},\"magic comes at a cost\"),\".\"),mdx(\"p\",null,\"If your application needs a special performance target, disabling \",mdx(\"em\",{parentName:\"p\"},\"Zone\"),\" can help deliver better performance for your application: an example of a case-scenario where performance can actually be game-changing is high-frequency updates, which is an issue I had while working on a real-time trading application, where a WebSocket was continuously sending messages to the client.\"),mdx(\"h2\",null,\"Removing Zone from Angular\"),mdx(\"p\",null,\"Running Angular without Zone is pretty simple. The first step is to comment out or remove the import statement in the file polyfills.ts:\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/2070/1*aO5CRXz99wZiAUDTN7XDCw.png\",alt:null}))),mdx(\"p\",null,\"The second step is to Bootstrap the root module with the following options:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"platformBrowserDynamic\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"bootstrapModule\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"AppModule\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    ngZone`,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"'noop'\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"catch\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"err \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"console\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"error\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"err\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`))),mdx(\"h2\",null,\"Angular Ivy: Manually Detecting Changes with \\u0275detectChanges and \\u0275markDirty\"),mdx(\"p\",null,\"Before we can start building our Typescript decorator, we need to see how Ivy allows us to bypass Zone and DI and trigger a change detection on a component by marking it dirty.\"),mdx(\"p\",null,\"We can now use two more functions exported from @angular/core: \",mdx(\"strong\",{parentName:\"p\"},\"\\u0275detectChanges\"),\" and \",mdx(\"strong\",{parentName:\"p\"},\"\\u0275markDirty\"),\". These two functions are still to be used privately and are not stable, hence they are prefixed with the character \\u0275.\"),mdx(\"p\",null,\"Let\\u2019s see an example of how they can be used.\"),mdx(\"h3\",null,\"\\u0275markDirty\"),mdx(\"p\",null,\"This function will mark a component dirty (e.g. need re-rendering) and will schedule a change detection at some point in the future unless it is already marked dirty.\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"import\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),\" \\u0275markDirty \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"as\"),\" markDirty \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"from\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"'@angular/core'\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"Component\")),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"...\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token class-name\"}),\"MyComponent\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"setTitle\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"title\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"string\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"title \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" title\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"markDirty\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"h3\",null,\"\\u0275detectChanges\"),mdx(\"p\",null,\"For efficiency reasons, the internal documentation discourages the use of \",mdx(\"strong\",{parentName:\"p\"},\"\\u0275detectChanges\"),\" and recommends using \",mdx(\"strong\",{parentName:\"p\"},\"\\u0275markDirty\"),\" instead. This function will synchronously trigger a change detection on the components and subcomponents.\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"import\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),\" \\u0275detectChanges \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"as\"),\" detectChanges \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"from\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"'@angular/core'\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"Component\")),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"...\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token class-name\"}),\"MyComponent\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"setTitle\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"title\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"string\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"title \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" title\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"detectChanges\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"h2\",null,\"Automatically detecting changes with a Typescript Decorator\"),mdx(\"p\",null,\"While the functions provided by Angular increase the Developer Experience by allowing us to bypass the DI, we may still be unhappy about the fact we need to import and manually call these functions in order to trigger a change detection.\"),mdx(\"p\",null,\"In order to make automatic change detection easier, we can write a Typescript decorator that can do it for us. Of course, we have some limitations, as we will see, but in my case, it did the job.\"),mdx(\"h3\",null,\"Introducing the @observed decorator\"),mdx(\"p\",null,\"In order to detect changes with minimal effort, we will build a decorator that can be applied in three ways:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"to synchronous methods\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"to an Observable\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"to an Object\"))),mdx(\"p\",null,\"Let\\u2019s see two quick examples. In the image below, we apply the \",mdx(\"strong\",{parentName:\"p\"},\"@observed\"),\" decorator to the \",mdx(\"strong\",{parentName:\"p\"},\"state\"),\" object and to the \",mdx(\"strong\",{parentName:\"p\"},\"changeName\"),\" method.\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/2872/1*HSndRaDsuxnCcAksBuL8VA.jpeg\",alt:null}))),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"to check changes on the \",mdx(\"strong\",{parentName:\"p\"},\"state\"),\" object we use a Proxy underneath to intercept changes to the object and trigger a change detection\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"we override the \",mdx(\"strong\",{parentName:\"p\"},\"changeTitle\"),\" method it with a function that first calls the method, and then it triggers a change detection\"))),mdx(\"p\",null,\"Below, we have an example with a \",mdx(\"strong\",{parentName:\"p\"},\"BehaviorSubject\"),\":\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/2872/1*XQ9kGVTnR0KHm4l43c3fDQ.jpeg\",alt:null}))),mdx(\"p\",null,\"For Observables, it gets a little bit more complicated: we need to subscribe to the observable and mark the component dirty in the subscription, but we also need to clean it up. To do that, we override \",mdx(\"strong\",{parentName:\"p\"},\"ngOnInit\"),\" and \",mdx(\"strong\",{parentName:\"p\"},\"ngOnDestroy\"),\" to subscribe and then clean the subscriptions.\"),mdx(\"h3\",null,\"Let\\u2019s build it!\"),mdx(\"p\",null,\"Below is the signature of the \",mdx(\"strong\",{parentName:\"p\"},\"observed\"),\" decorator:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"export\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"function\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"observed\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"function\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n    target`,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" object\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n    propertyKey`,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"string\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n    descriptor`,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"?\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),` PropertyDescriptor\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"p\",null,\"As you can see above, \",mdx(\"strong\",{parentName:\"p\"},\"descriptor\"),\" is optional as we want the decorator to be applied to both methods and properties. If the parameter is defined, then it means the decorator is being applied to a method:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"we store the original method\\u2019s value\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"we override the method: we call the original function, and then we call \",mdx(\"strong\",{parentName:\"p\"},\"markDirty(\",mdx(\"em\",{parentName:\"strong\"},\"this\"),\")\"),\" in order to trigger a change detection\")),mdx(\"li\",{parentName:\"ul\"})),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"descriptor\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" original \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" descriptor\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"value\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"// store original\"),`\n  descriptor`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function-variable function\"}),\"value\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"function\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"...\"),\"args\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"any\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"original\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"apply\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" args\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"// call original\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"markDirty\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"else\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"// check property\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"p\",null,\"Moving on, we now need to check what type of property we\\u2019re dealing with: an Observable or an object. We now introduce another private API provided by Angular, which I am surely not supposed to be using (sorry!):\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"the property \",mdx(\"strong\",{parentName:\"li\"},\"\\u0275cmp\"),\" gives us access to the post-definition properties processed by Angular, which we can use to override the methods \",mdx(\"strong\",{parentName:\"li\"},\"onInit\"),\" and \",mdx(\"strong\",{parentName:\"li\"},\"onDestroy of the component\"))),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function-variable function\"}),\"getCmp\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" type \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"type\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"\\u0275cmp\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" cmp \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"getCmp\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"target\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"constructor\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" onInit \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" cmp\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"onInit \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"||\"),\" noop\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" onDestroy \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" cmp\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"onDestroy \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"||\"),\" noop\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`))),mdx(\"p\",null,\"In order to mark the property as \\u201Cto be observed\\u201D, we use \",mdx(\"strong\",{parentName:\"p\"},\"ReflectMetadata\"),\" and set its value to true so that we know we need to observe the property when the component is initialized:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),\"Reflect\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"set\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"target\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" propertyKey\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`))),mdx(\"p\",null,\"It\\u2019s time to override the \",mdx(\"strong\",{parentName:\"p\"},\"onInit\"),\" hook and check the properties when it is instantiated:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),\"cmp\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function-variable function\"}),\"onInit\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"function\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"checkComponentProperties\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"onInit\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"call\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`))),mdx(\"p\",null,\"Let\\u2019s define the function \",mdx(\"strong\",{parentName:\"p\"},\"checkComponentProperties\"),\" which will go through the component\\u2019s properties, filter them by checking the value we set previously with \",mdx(\"strong\",{parentName:\"p\"},\"Reflect.set\"),\":\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function-variable function\"}),\"checkComponentProperties\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ctx\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" props \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" Object\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"getOwnPropertyNames\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ctx\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n  props`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"map\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"prop\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),\" Reflect\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"get\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"target\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" prop\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"filter\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"Boolean\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"forEach\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"checkProperty\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"call\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ctx\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" propertyKey\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`))),mdx(\"p\",null,\"The function \",mdx(\"strong\",{parentName:\"p\"},\"checkProperty \"),\"will be responsible for decorating the individual properties. First, we want to check if the property is an Observable or an object. If it is an Observable, then we subscribe to it, and we add the subscription to a list of subscriptions that we store privately on the component.\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function-variable function\"}),\"checkProperty\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"function\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"name\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"string\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" ctx \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ctx\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\"name\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"instanceof\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token class-name\"}),\"Observable\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" subscriptions \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"getSubscriptions\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ctx\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    subscriptions`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"add\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ctx\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\"name\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"subscribe\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n      `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"markDirty\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ctx\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"else\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"// check object\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`))),mdx(\"p\",null,\"If instead, the property is an object, we convert it to a Proxy, and we call markDirty in its handler function.\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" handler \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"set\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"obj\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" prop\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" value\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    obj`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\"prop\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" value\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"\\u0275markDirty\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ctx\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\nctx`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\"name\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"new\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token class-name\"}),\"Proxy\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ctx\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" handler\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`))),mdx(\"p\",null,\"Finally, we want to clean up the subscriptions when the component is destroyed:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),\"cmp\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function-variable function\"}),\"onDestroy\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"function\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" ctx \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ctx\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\"subscriptionsSymbol\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    ctx`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\"subscriptionsSymbol\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"unsubscribe\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"onDestroy\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"call\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ctx\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`))),mdx(\"p\",null,\"This decorator is not exhaustive and \",mdx(\"strong\",{parentName:\"p\"},\"will not cover all cases\"),\" needed by large applications (ex. template function calls that return Observables, but I\\u2019m working on that\\u2026).\"),mdx(\"p\",null,\"Though, it was enough to convert my small application. The full source code can be found at the end of this article.\"),mdx(\"h2\",null,\"Performance Results and Considerations\"),mdx(\"p\",null,\"Now that we learned a little bit about the internals of Ivy and how to build a decorator that makes use of its API, it\\u2019s time to test it on a real application.\"),mdx(\"p\",null,\"I used my guinea-pig project \",mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/gbuomprisco/cryptofolio\"}),\"Cryptofolio\"),\" in order to test the performance changes brought by adding and removing Zone.\"),mdx(\"p\",null,\"I applied the decorator to all the template references needed, and I removed Zone. For example, see the below component:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"the two variables used in the template are the price (number) and trend (up, stale, down), and I decorated both of them with @observed\")),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"Component\")),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"...\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"export\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token class-name\"}),\"AssetPricerComponent\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"observed\")),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" price$\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" Observable\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"string\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"\u003e\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"observed\")),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" trend$\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" Observable\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\"),\"Trend\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"\u003e\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  \n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"// ...\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"h3\",null,\"Bundle Size\"),mdx(\"p\",null,\"First of all, let\\u2019s check by how much the size of the bundle will be reduced by removing Zone.js. In the image below, we can see the build result with Zone:\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/2986/1*ZrYc8YBXvr5nuZKYL5ZRvQ.png\",alt:\"Build With Zone\"}))),mdx(\"p\",null,\"Anf the below was taken without Zone:\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/2896/1*iGNl5sL_H1A6sC-bxoP5zA.png\",alt:\"Build Without Zone\"}))),mdx(\"p\",null,\"Taking into account the ES2015 bundle, it\\u2019s clear that Zone takes almost 35kB of space, while the bundle without Zone is only 130 bytes.\"),mdx(\"h3\",null,\"Initial Load\"),mdx(\"p\",null,\"I took some audits with Lighthouse, with no throttling: I wouldn\\u2019t take the below results \",mdx(\"em\",{parentName:\"p\"},\"too\"),\" seriously: in fact, the results varied quite a bit while I was trying to average the results.\"),mdx(\"p\",null,\"It\\u2019s possible though that the difference in bundle size is why the version without Zone has a slightly better score. The audit below was taken with Zone:\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/3166/1*6eg8z2O3e6j4eSDohjQhIw.png\",alt:\"Audit with Zone\"}))),mdx(\"p\",null,\"The below, instead, was taken without Zone:\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/3238/1*gHPNceylTa37lX95g74fiA.png\",alt:\"Audit without Zone\"}))),mdx(\"h3\",null,\"Runtime Performance \\u{1F680}\"),mdx(\"p\",null,\"And now we get to the fun part: runtime performance under load. We want to check how the CPU behaves when rendering hundreds of prices updated multiple times per second.\"),mdx(\"p\",null,\"In order to put the application under load, I created about 100 pricers emitting mock data, with each price \",mdx(\"strong\",{parentName:\"p\"},\"changing every 250ms\"),\". Every price will show up green if it increased, or red if it decreased. This can put my MacBook Pro under a fair amount of load.\"),mdx(\"blockquote\",null,mdx(\"p\",{parentName:\"blockquote\"},\" Working in the financial sector on a number of high-frequency streaming applications, this is a scenario I came across multiple times.\")),mdx(\"p\",null,\"I used the Chrome Dev Tools to analyzed the CPU usage of each version. Let\\u2019s start with Angular with Zone:\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/6684/1*OHPJ7-Xjfb2Z2k_aO92leQ.gif\",alt:null}))),mdx(\"p\",null,\"The below is taken without Zone:\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/6684/1*wnaSQ_ishYAJfxoXF5pCVA.gif\",alt:\"Runtime Performance WIthout Zone\"}))),mdx(\"p\",null,\"Let\\u2019s analyze the above, and take a look ar the CPU usage graph (the yellow one):\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"As you can see, in the zone version the CPU usage is constantly between 70% and 100%! Keep a tab under this load for enough time, and it will surely crash\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"In the second one, instead, the usage is stable at between 30% and 40%. Sweet!\"))),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Notice:\"),\" The results above are taken with the DevTools open, which decreases performance\"),mdx(\"h3\",null,\"Increasing the load\"),mdx(\"p\",null,\"I went on and tried to update 4 more prices every second for each pricer:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"The non-Zone version was still able to manage the load without a problem with 50% CPU usage\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"I was able to bring the CPU close to the same load as the Zone version only by \",mdx(\"strong\",{parentName:\"p\"},\"updating a price every 10ms\"),\" (x 100 pricers)\"))),mdx(\"h2\",null,\"Benchmarking with Angular Benchpress\"),mdx(\"p\",null,\"The above is not the most scientific benchmark there is nor it aims to be, so I\\u2019d suggest you to \",mdx(\"a\",a({parentName:\"p\"},{href:\"https://krausest.github.io/js-framework-benchmark/current.html\"}),\"check out this benchmark\"),\" and uncheck all the frameworks but Angular and Zoneless Angular.\"),mdx(\"p\",null,\"I took some inspiration from it, and \",mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/Gbuomprisco/zoneless-angular\"}),\"I created a project\"),\" that executes some heavy operations which I benchmarked it with \",mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/angular/angular/tree/master/packages/benchpress\"}),\"Angular Benchpress\"),\".\"),mdx(\"p\",null,\"Let\\u2019s see the component tested:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"Component\")),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"...\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"export\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token class-name\"}),\"AppComponent\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"public\"),\" data \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"observed\")),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"run\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"length\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"number\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"clear\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"buildData\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"length\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"observed\")),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"append\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"length\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"number\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"buildData\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"length\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"observed\")),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"removeAll\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"clear\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"observed\")),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"remove\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"item\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"for\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"let\"),\" i \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"0\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" l \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"data\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"length\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" i \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\"),\" l\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" i\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"++\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n      `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"data\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\"i\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"id \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"===\"),\" item\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"id\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"data\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"splice\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"i\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"1\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"break\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n      `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"trackById\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"item\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),\" item\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"id\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"clear\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"data \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"buildData\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"length\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"number\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" start \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"data\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"length\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" end \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" start \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"+\"),\" length\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"for\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"let\"),\" n \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" start\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" n \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"\u003c=\"),\" end\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" n\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"++\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n      `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"data\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"push\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        id`,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" n\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n        label`,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" Math\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"random\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n      `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"p\",null,\"I then run a small benchmarking suite with Protractor and Benchpress: it executes the operations for a specified number of times.\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/4780/1*MSpwgSWb4kMmF_DQ1fSqXw.gif\",alt:\"Benchpress in Action\"}))),mdx(\"h3\",null,\"Results\"),mdx(\"p\",null,\"Here\\u2019s a sample of the output returned by this tool:\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/3646/1*iTx3gtXSHdtQMtTpvPOAaA.png\",alt:\"Benchpress Output\"}))),mdx(\"p\",null,\"And here\\u2019s an explanation of the metrics returned by the output:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-unknown\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-unknown\"}),`- gcAmount: gc amount in kbytes\n- gcTime: gc time in ms\n- majorGcTime: time of major gcs in ms\n- pureScriptTime: script execution time in ms, without gc nor render\n- renderTime: render time in ms\n- scriptTime: script execution time in ms, including gc and render`))),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Notice\"),\": The graphs below will only show the rendering time. The complete outputs can be found at \",mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/Gbuomprisco/zoneless-angular\"}),\"the following link\"),\".\"),mdx(\"h3\",null,\"Test: Create 1000 Rows\"),mdx(\"p\",null,\"The first test creates 1000 rows:\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/2400/1*M_Xf_UFY44GlSPYQVrYFqQ.png\",alt:null}))),mdx(\"h3\",null,\"Test: Create 10000 Rows\"),mdx(\"p\",null,\"As the load gets heavier, we can see a bigger difference:\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/2400/1*4MNMFldeEsqoLpVXxdZ9dA.png\",alt:null}))),mdx(\"h3\",null,\"Test: Append 1000 Rows\"),mdx(\"p\",null,\"This test appends 1000 rows to a list of 10000:\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/2400/1*nf9Y3LciXdGC5doeTdxaJg.png\",alt:null}))),mdx(\"h3\",null,\"Test: Remove 10000 Rows\"),mdx(\"p\",null,\"This test creates 10000 rows and removes them:\"),mdx(\"p\",null,mdx(\"img\",a({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/2400/1*00zTob3NtHKEZuT-Upnh2g.png\",alt:null}))),mdx(\"h2\",null,\"Final Words\"),mdx(\"p\",null,\"While I do hope you enjoyed the article, I also hope I didn\\u2019t just convince you to run to the office and remove Zone from your project: this strategy \",mdx(\"strong\",{parentName:\"p\"},\"should be the very last thing\"),\" you may want to do if you plan on increasing the performance of an Angular application.\"),mdx(\"p\",null,\"Techniques such as OnPush change detection, \",mdx(\"em\",{parentName:\"p\"},\"trackBy\"),\", detaching components, running outside of Zone, and blacklisting Zone events (among many others) should always be preferred. The tradeoffs are significant and it\\u2019s a tax you may not want pay.\"),mdx(\"p\",null,\"In fact, developing without Zone may still be quite daunting, unless you have complete control over the project (e.g. you own the dependencies and have the freedom and time to manage the overhead).\"),mdx(\"p\",null,\"If all else fails, and you think Zone may actually be a bottleneck, then it may be a good idea to try and give Angular a further boost by manually detecting changes.\"),mdx(\"p\",null,\"I hope this article gave you a good idea of what may be coming to Angular, what Ivy makes possible to do, and how you can work around Zone to achieve maximum speed for your applications.\"),mdx(\"h3\",null,mdx(\"a\",a({parentName:\"h3\"},{href:\"https://gist.github.com/Gbuomprisco/e6b3f762b0be6f3ce296af49253cc4e3\"}),\"Source Code\")),mdx(\"p\",null,\"The source code for the Typescript decorator can be found at its \",mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/Gbuomprisco/ngx-toolkit/blob/master/projects/observed-property/src/lib/index.ts\"}),\"Github Project\"),` page:\n{% gist `,mdx(\"a\",a({parentName:\"p\"},{href:\"https://gist.github.com/Gbuomprisco/e6b3f762b0be6f3ce296af49253cc4e3.js\"}),\"https://gist.github.com/Gbuomprisco/e6b3f762b0be6f3ce296af49253cc4e3.js\"),\" %}\"),mdx(\"h3\",null,\"Resources\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",a({parentName:\"p\"},{href:\"https://krausest.github.io/js-framework-benchmark/current.html\"}),\"Frontend Frameworks Benchmark\"))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/Gbuomprisco/zoneless-angular\"}),\"Zoneless Benchmark Project\"),\" (zone branch contains the code with Zone)\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",a({parentName:\"p\"},{href:\"https://github.com/ngrx/platform/issues/2052\"}),\"RFC: Component: Proposal for a new package \",mdx(\"inlineCode\",{parentName:\"a\"},\"component\")))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",a({parentName:\"p\"},{href:\"https://www.youtube.com/watch?v=rz-rcaGXhGk\"}),\"Building with Ivy: rethinking reactive Angular\")))),mdx(\"p\",null,\"If you need any clarifications, or if you think something is unclear or wrong, do please leave a comment!\"))}MDXContent.isMDXComponent=!0;\n","scope":{}},"series":[],"morePosts":[],"moreArticles":[{"live":true,"readingTime":"2 min read","title":"Benchmarking Angular 12 with Webpack 5","date":"2021-05-14T00:00:00.322Z","slug":"webpack-5-angular12","coverImage":"/assets/images/posts/benchmarking-webpack-5.webp","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"Angular 12 has been released and with it the much awaited Webpack 5 upgrade. In this post I benchmarked the bundle-size and compilation speed against the previous version","tags":["angular"]},{"live":true,"readingTime":"5 min read","title":"Principles for creating libraries with Nx and Angular","date":"2021-02-07T00:00:00.322Z","slug":"how-to-organize-nx-modules-with-angular","coverImage":"/assets/images/posts/organize-nx-modules-ngrx.webp","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"Working with Nx may be confusing. This article explains how I create Nx libraries and the principles behind my motivations","tags":["nx","angular"]},{"live":true,"readingTime":"3 min read","title":"Where to put your Angular models?","date":"2020-08-03T00:00:00.322Z","slug":"angular-where-to-put-models","ogImage":{"url":"/assets/images/posts/where-put-angular-models.png"},"coverImage":"/assets/images/posts/where-put-angular-models.webp","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"Organizing entities and models in your Angular app may be hard. This article explains where to put your entities and what mistakes to watch out for","tags":["angular","architecture"]},{"live":true,"readingTime":"5 min read","title":"Using the Intersection Observer API with Angular","date":"2020-08-01T00:00:00.322Z","slug":"intersection-observer-with-angular","coverImage":"/assets/images/posts/intersection-observer.webp","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"This article shows how to build a directive with Angular that uses the Intersection Observer API to check when an element becomes visible on the page","tags":["angular","performance"]},{"live":true,"readingTime":"3 min read","title":"Setters vs ngOnChanges: which one is better?","date":"2020-07-30T00:00:00.322Z","slug":"setters-vs-ng-on-changes","coverImage":"/assets/images/posts/setters-vs-on-changes.webp","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"Listening to Input changes can be done in different ways. But which one should you use?","tags":["angular"]},{"live":true,"readingTime":"3 min read","title":"Async Rendering with a single Rx Operator","date":"2020-07-11T00:00:00.322Z","slug":"async-rendering-with-a-single-rx-operator","coverImage":"/assets/images/posts/async-rendering.webp","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"Increase your app rendering performance with this simple Rx operator","tags":["angular","rxjs"]}],"type":1},"__N_SSG":true},"page":"/[collection]/[slug]","query":{"collection":"angular","slug":"maximizing-angular-performance-removing-zone-1"},"buildId":"_Q7TEENxVO8jGXME1JGUY","isFallback":false,"gsp":true,"scriptLoader":[]}</script><script async="" defer="" src="https://www.googletagmanager.com/gtag/js"></script><script id="gtmDataLayer">
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-172483071-1');
</script></body></html>