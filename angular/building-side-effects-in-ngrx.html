<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/favicon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/favicon.png" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Giancarlo Buomprisco&#x27;s Website"/><meta property="og:image" content="https://og-image.vercel.app/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><title>Building Side Effects in NGRXs</title><meta property="og:image" content="https://cdn-images-1.medium.com/max/1600/1*R3-0VFvXB2rq-rAtWyNwxA.gif"/><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/49eb1b3ebd6b716ab8e0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/49eb1b3ebd6b716ab8e0.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c9c2308d7a8cb3179750.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c9c2308d7a8cb3179750.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-fb76148cfcfb42ca18eb.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-8d15616dad332ac01c02.js" defer=""></script><script src="/_next/static/chunks/pages/_app-07b925f548b1372e4199.js" defer=""></script><script src="/_next/static/chunks/947-02bc943179468be89d96.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bcollection%5D/%5Bslug%5D-5f7ae3420636246f9546.js" defer=""></script><script src="/_next/static/HcR7uyGAuEx8S7Y8lnph4/_buildManifest.js" defer=""></script><script src="/_next/static/HcR7uyGAuEx8S7Y8lnph4/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><main><div style="--from:#dd0031b0;--to:#dd0031" class="collection-branding-bar_gradient__1Ie5x"></div><div class="container mx-auto px-5"><div class="flex-row flex justify-between my-8 md:my-12"><h2 class="font-normal tracking-tight md:tracking-tighter leading-tight"><a class="hover:underline" href="/"><b>GIANCARLO</b>BUOMPRISCO</a></h2><div><ul class="flex space-x-8 px-4"><li class="text-gray-700 hover:text-gray-900"><a href="/about">About Me</a></li></ul></div></div><article class="mb-32"><h1 class="text-6xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-8 text-center">Building Side Effects in NGRXs</h1><div class="mb-4 flex justify-center"><div class="text-center flex flex-row space-x-2 items-center cursor-pointer collection--angular"><img style="width:24px;height:24px" src="/assets/images/collections/angular.png" alt="angular"/><span class="hover:underline">Angular</span></div></div><div class="max-w-2xl mx-auto mb-6"><div class="flex flex-row space-x-2 items-center justify-center"><div class="text-sm text-center text-gray-600"><time dateTime="2019-06-05T00:00:00.322Z">June	5, 2019</time></div><span class="text-gray-500">·</span><span class="text-gray-500 text-sm">6 min read</span></div></div><div class="mb-8 md:mb-16 sm:mx-0"><div class="w-12/12 md:w-8/12 mx-auto flex justify-center"><div class="sm:mx-0"><img src="https://cdn-images-1.medium.com/max/1600/1*R3-0VFvXB2rq-rAtWyNwxA.gif" alt="Cover Image for Building Side Effects in NGRXs" loading="lazy" class="shadow-small object-contain w-full h-auto"/></div></div></div><div class="max-w-2xl text-xl mx-auto leading-loose"><div class="markdown-styles_markdown__1x9gM"><hr>
<h3>Building Side Effects in NGRX</h3>
<p>This is the third article of a series that aims to explain in detail a step-by-step approach to building an Angular application with NGRX.</p>
<ul>
<li>In <a href="https://medium.com/r/?url=https%3A%2F%2Fitnext.io%2Fstate-management-with-ngrx-introduction-1aae0803e988">the first article of this series</a>, I wrote a small overview of all the concepts surrounding the NGRX platform.</li>
<li>In <a href="https://medium.com/r/?url=https%3A%2F%2Fitnext.io%2Farchitecting-the-store-in-ngrx-e4955641d746">the second article of this series</a>, I started writing the store of the application and the state’s entities.</li>
</ul>
<p>If you have never worked with NGRX, or have never done something in-depth with, I’d really recommend you read it.</p>
<h3>Summary</h3>
<p>Just to summarise what I introduced in the previous articles, we have an application that aims to display a dashboard with cryptocurrencies prices.</p>
<p>The application’s logic is built using three service modules, each module manages a different feature of our store.</p>
<p>These are:</p>
<ul>
<li><strong>dashboard</strong>, that manages the logic of the dashboard and its tiles</li>
<li><strong>assets,</strong> a list of assets fetched from <a href="https://medium.com/r/?url=https%3A%2F%2Fcoincap.io">Coincap’s</a> API</li>
<li><strong>prices,</strong> a stream of prices from Coincap’s WebSocket API </li>
</ul>
<h3>In this article we will be learning:</h3>
<ul>
<li>how to build effects in NGRX 8</li>
<li>how to build an effect that fetches the assets list from the API</li>
<li>how to build an effect that connects to a WebSocket and listens for messages that will be stored in our application’s state</li>
</ul>
<h3>Coincap’s API Service</h3>
<p>In order to fetch data from Coincap, we create a service that we’re going to use in our Effects classes:</p>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CoincapService</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> http<span class="token operator">:</span> HttpClient<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">getAssets</span><span class="token punctuation">(</span>
        search<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        ids<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        limit <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&#x3C;</span>GetAssetsResponseDto<span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&#x3C;</span>GetAssetsResponseDto<span class="token operator">></span></span></span><span class="token punctuation">(</span>EndPoints<span class="token punctuation">.</span>Assets<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            params<span class="token operator">:</span> <span class="token punctuation">{</span> search<span class="token punctuation">,</span> ids<span class="token punctuation">,</span> limit<span class="token operator">:</span> limit<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>At the moment, we have one single method:</p>
<ul>
<li><strong>getAssets</strong>, that by default will be fetching the first top 5 assets</li>
</ul>
<p>This method will be returning <code>GetAssetsResponseDto</code> which is simply:</p>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">GetAssetsResponseDto</span> <span class="token punctuation">{</span>
    data<span class="token operator">:</span> Asset<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    timestamp<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2>Assets Effects</h2>
<p>Let’s now create the effects for the <em>Assets</em> store. As we have seen in the previous article, we have created three actions:</p>
<ul>
<li>getAssetsRequestStarted</li>
<li>getAssetsRequestSuccess</li>
<li>addAssets</li>
</ul>
<h3>Private API</h3>
<p>Let’s summarize what our actions will be doing:</p>
<ul>
<li>we want to react to a <em>getAssetsRequestStarted</em> action and dispatch a <em>getAssetsRequestSuccess</em> action</li>
<li>once <em>getAssetsRequestSuccess</em> action is received, we will dispatch <em>addAssets</em> that gets picked up by the reducer function and add the assets to the store</li>
</ul>
<p>Let’s first create the effect that will be responsible for fetching the assets:</p>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">private</span> <span class="token function">getAllAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
            <span class="token function">ofType</span><span class="token punctuation">(</span>getAssetsRequestStarted<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> payload<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>coincap<span class="token punctuation">.</span><span class="token function">getAssets</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
                    <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token operator">:</span> GetAssetsResponseDto<span class="token punctuation">)</span> <span class="token operator">=></span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>payload<span class="token operator">:</span> Asset<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">getAssetsRequestSuccess</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p><strong>Let’s break this effect down</strong></p>
<ul>
<li>instead of using the decorator <code>@Effect</code> , we simply import the function <code>createEffect</code> from <code>@ngrx/effects</code> </li>
<li>we receive an action <code>getAssetsRequestStarted</code> </li>
<li>we call the <code>getAssets</code> method we defined earlier in the Coincap service, and we map the stream to the result of this request</li>
<li>if there’s an error, we simply return <code>undefined</code> which will be filtered in the stream thanks to <code>filter(Boolean)</code></li>
<li>we then map the stream to the action <code>getAssetsRequestSuccess</code> </li>
</ul>
<p>The second effect will be responsible for intercepting <code>getAssetsRequestSuccess</code> and simply map it to <code>addAssets</code> </p>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">private</span> <span class="token function">addAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
            <span class="token function">ofType</span><span class="token punctuation">(</span>getAssetsRequestSuccess<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> payload<span class="token operator">:</span> Asset<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span>
                <span class="token function">addAssets</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3>Public API</h3>
<p>Finally, we expose the public API:</p>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">public</span> getAllAssets$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAllAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> addAssets$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>And this is the complete snippet:</p>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AssetsEffects</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> actions<span class="token operator">:</span> Actions<span class="token punctuation">,</span> <span class="token keyword">private</span> coincap<span class="token operator">:</span> CoincapService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> getAllAssets$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAllAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> addAssets$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token function">addAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
                <span class="token function">ofType</span><span class="token punctuation">(</span>getAssetsRequestSuccess<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> payload<span class="token operator">:</span> Asset<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span>
                    <span class="token function">addAssets</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token function">getAllAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
                <span class="token function">ofType</span><span class="token punctuation">(</span>getAssetsRequestStarted<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> payload<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>coincap<span class="token punctuation">.</span><span class="token function">getAssets</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
                        <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token operator">:</span> GetAssetsResponseDto<span class="token punctuation">)</span> <span class="token operator">=></span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>payload<span class="token operator">:</span> Asset<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token function">getAssetsRequestSuccess</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2>Prices Effects</h2>
<p>In order to fetch the prices from the Coincap’s WebSocket API, we extend the Coincap service we created earlier and add a new method responsible for connecting to the price streams and returning an Observable that emits price ticks.</p>
<h3>WebSocket Connection </h3>
<p>In order to do this, we:</p>
<ul>
<li>create a connection by calling <code>WebSocket(url)</code></li>
<li>we create a new Observable, and inside this, we emit an event every time the WebSocket connection receives a message using the <code>onmessage</code> hook</li>
<li>we define the <code>unsubscribe</code> method, which will simply close the WebSocket connection</li>
</ul>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CoincapService</span> <span class="token punctuation">{</span>
    <span class="token comment">// .. other methods</span>

    webSocket<span class="token operator">:</span> WebSocket<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">connectToPriceStream</span><span class="token punctuation">(</span>assets<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&#x3C;</span>PriceState<span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>assets<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span>observer <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> webSocket <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>webSocket<span class="token punctuation">;</span>

            webSocket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span>msg<span class="token operator">:</span> MessageEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
                    webSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>assets<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webSocket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>webSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>webSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span>
            EndPoints<span class="token punctuation">.</span>WebSocket <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">?assets=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>assets<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3>API</h3>
<p>We have created three actions:</p>
<ul>
<li>createPriceSubscription</li>
<li>closePriceSubscription</li>
<li>addPrice</li>
</ul>
<p>And this is what the effects look like:</p>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PricesEffects</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>
        <span class="token keyword">private</span> actions<span class="token operator">:</span> Actions<span class="token punctuation">,</span>
        <span class="token keyword">private</span> coincap<span class="token operator">:</span> CoincapService<span class="token punctuation">,</span>
        <span class="token keyword">private</span> pricesFacade<span class="token operator">:</span> PricesFacadeService
    <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    createPriceSubscription$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createPriceSubscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prices$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPrices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token function">createPriceSubscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
                <span class="token function">ofType</span><span class="token punctuation">(</span>createPriceSubscription<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> payload<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">withLatestFrom</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pricesFacade<span class="token punctuation">.</span><span class="token function">getSubscribedAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>payload<span class="token punctuation">,</span> assets<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">connectPriceStream</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>assets<span class="token punctuation">,</span> payload<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>price<span class="token operator">:</span> PriceState<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">priceReceived</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload<span class="token operator">:</span> price <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token function">getPrices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
                <span class="token function">ofType</span><span class="token punctuation">(</span>priceReceived<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">addPrice</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token function">connectPriceStream</span><span class="token punctuation">(</span>assets<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>coincap
            <span class="token punctuation">.</span><span class="token function">connectToPriceStream</span><span class="token punctuation">(</span>assets<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
                <span class="token function">takeUntil</span><span class="token punctuation">(</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">ofType</span><span class="token punctuation">(</span>closePriceSubscription<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Let’s break down the <code>createPriceSubscription$</code> effect:</p>
<ul>
<li>we receive an action <code>createPriceSubscription</code> </li>
<li>we connect to the stream via the Coincap service, which will return an <em>Observable</em> that will emit prices</li>
<li>every price will create an action <code>priceReceived</code> </li>
<li>we add a <code>takeUntil</code> operator to the price stream observable, so that every time an action <code>closePriceSubscription</code> is received, the observable will automatically be unsubscribed</li>
</ul>
<p>The <code>prices$</code> effect is fairly simple:</p>
<ul>
<li>we receive an action <code>priceReceived</code> and we map it to an action <code>addPrice</code> that will be handled by the reducer and will add the price to the store</li>
</ul>
<h3>Updating the Store Modules</h3>
<p>Lastly, we need to update both the store service modules by adding the effects using the method <code>EffectsModule.forFeature([EffectsClass])</code> . </p>
<p>The prices store module looks something like this:</p>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">NgModule</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    imports<span class="token operator">:</span> <span class="token punctuation">[</span>
        StoreModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span><span class="token string">'prices'</span><span class="token punctuation">,</span> pricesReducer<span class="token punctuation">)</span><span class="token punctuation">,</span>
        EffectsModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span><span class="token punctuation">[</span>PricesEffects<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    providers<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// still empty!</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PricesStoreModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div>
<h2>Final Words</h2>
<p>In this walkthrough, we create a few very simple effects that do some very common tasks, such as talking to an API endpoint, creating streams of Observables from real-time messaging systems, and updating the reducer as a result of dispatching actions.</p>
<p>In the next article, we will finally build some components and connect the store to the UI using a Facade Service.</p>
<p>Hope you enjoyed the article and leave a message if you agree, disagree, or if you would do anything differently!</p>
<hr>
<p><em>If you enjoyed this article, follow me on</em> <a href="https://medium.com/@.gc"><em>Medium</em></a> <em>or</em> <a href="https://medium.com/r/?url=https%3A%2F%2Ftwitter.com%2Fhome"><em>Twitter</em></a> <em>for more articles about Angular, RxJS, Typescript and more!</em></p>
</div></div></article><div class="w-full md:w-8/12 mx-auto"><script async="" data-uid="3e3126f064" src="https://thoughtful-inventor-7842.ck.page/3e3126f064/index.js"></script></div><div><hr class="border-accent-2 mt-16 mb-14"/><h3 class="text-2xl md:text-3xl text-center font-semibold my-4 md:my-12 flex flex-row space-x-4 items-center justify-center"><span>More Posts for</span> <div class="text-center flex flex-row space-x-2 items-center cursor-pointer collection--angular"><img style="width:28px;height:28px" src="/assets/images/collections/angular.png" alt="angular"/><span class="hover:underline">Angular</span></div></h3><section><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 md:gap-x-12 lg:gap-x-16 gap-y-20 md:gap-y-24 mb-32"><div><div class="mb-3"><div class="sm:mx-0"><a aria-label="Benchmarking Angular 12 with Webpack 5" href="/angular/webpack-5-angular12"><img src="/assets/images/posts/benchmarking-webpack-5.png" alt="Cover Image for Benchmarking Angular 12 with Webpack 5" loading="lazy" class="shadow-small object-contain w-full h-auto hover:shadow-medium transition-shadow duration-200"/></a></div></div><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/webpack-5-angular12">Benchmarking Angular 12 with Webpack 5</a></h3><div class="text-xs mb-2 flex flex-row space-x-2 items-center"><div class="text-gray-500"><time dateTime="2021-05-14T00:00:00.322Z">May	14, 2021</time></div><span class="text-gray-500">·</span><span class="text-gray-500">3 min read</span><span class="text-gray-500">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-2 items-center cursor-pointer collection--angular"><img style="width:16px;height:16px" src="/assets/images/collections/angular.png" alt="angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 text-sm">Angular 12 has been released and with it the much awaited Webpack 5 upgrade. In this post I benchmarked the bundle-size and compilation speed against the previous version</p></div><div><div class="mb-3"><div class="sm:mx-0"><a aria-label="Principles for creating libraries with Nx and Angular" href="/angular/how-to-organize-nx-modules-with-angular"><img src="/assets/images/posts/organize-nx-modules-ngrx.png" alt="Cover Image for Principles for creating libraries with Nx and Angular" loading="lazy" class="shadow-small object-contain w-full h-auto hover:shadow-medium transition-shadow duration-200"/></a></div></div><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/how-to-organize-nx-modules-with-angular">Principles for creating libraries with Nx and Angular</a></h3><div class="text-xs mb-2 flex flex-row space-x-2 items-center"><div class="text-gray-500"><time dateTime="2021-02-07T00:00:00.322Z">February	7, 2021</time></div><span class="text-gray-500">·</span><span class="text-gray-500">5 min read</span><span class="text-gray-500">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-2 items-center cursor-pointer collection--angular"><img style="width:16px;height:16px" src="/assets/images/collections/angular.png" alt="angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 text-sm">Working with Nx may be confusing. This article explains how I create Nx libraries and the principles behind my motivations</p></div><div><div class="mb-3"><div class="sm:mx-0"><a aria-label="Where to put your Angular models?" href="/angular/angular-where-to-put-models"><img src="/assets/images/posts/where-put-angular-models.png" alt="Cover Image for Where to put your Angular models?" loading="lazy" class="shadow-small object-contain w-full h-auto hover:shadow-medium transition-shadow duration-200"/></a></div></div><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/angular-where-to-put-models">Where to put your Angular models?</a></h3><div class="text-xs mb-2 flex flex-row space-x-2 items-center"><div class="text-gray-500"><time dateTime="2020-08-03T00:00:00.322Z">August	3, 2020</time></div><span class="text-gray-500">·</span><span class="text-gray-500">3 min read</span><span class="text-gray-500">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-2 items-center cursor-pointer collection--angular"><img style="width:16px;height:16px" src="/assets/images/collections/angular.png" alt="angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 text-sm">Organizing entities and models in your Angular app may be hard. This article explains where to put your entities and what mistakes to watch out for</p></div><div><div class="mb-3"><div class="sm:mx-0"><a aria-label="Using the Intersection Observer API with Angular" href="/angular/intersection-observer-with-angular"><img src="/assets/images/posts/intersection-observer.png" alt="Cover Image for Using the Intersection Observer API with Angular" loading="lazy" class="shadow-small object-contain w-full h-auto hover:shadow-medium transition-shadow duration-200"/></a></div></div><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/intersection-observer-with-angular">Using the Intersection Observer API with Angular</a></h3><div class="text-xs mb-2 flex flex-row space-x-2 items-center"><div class="text-gray-500"><time dateTime="2020-08-01T00:00:00.322Z">August	1, 2020</time></div><span class="text-gray-500">·</span><span class="text-gray-500">5 min read</span><span class="text-gray-500">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-2 items-center cursor-pointer collection--angular"><img style="width:16px;height:16px" src="/assets/images/collections/angular.png" alt="angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 text-sm">This article shows how to build a directive with Angular that uses the Intersection Observer API to check when an element becomes visible on the page</p></div><div><div class="mb-3"><div class="sm:mx-0"><a aria-label="Setters vs ngOnChanges: which one is better?" href="/angular/setters-vs-ng-on-changes"><img src="/assets/images/posts/setters-vs-on-changes.png" alt="Cover Image for Setters vs ngOnChanges: which one is better?" loading="lazy" class="shadow-small object-contain w-full h-auto hover:shadow-medium transition-shadow duration-200"/></a></div></div><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/setters-vs-ng-on-changes">Setters vs ngOnChanges: which one is better?</a></h3><div class="text-xs mb-2 flex flex-row space-x-2 items-center"><div class="text-gray-500"><time dateTime="2020-07-30T00:00:00.322Z">July	30, 2020</time></div><span class="text-gray-500">·</span><span class="text-gray-500">3 min read</span><span class="text-gray-500">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-2 items-center cursor-pointer collection--angular"><img style="width:16px;height:16px" src="/assets/images/collections/angular.png" alt="angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 text-sm">Listening to Input changes can be done in different ways. But which one should you use?</p></div><div><div class="mb-3"><div class="sm:mx-0"><a aria-label="Async Rendering with a single Rx Operator" href="/angular/async-rendering-with-a-single-rx-operator"><img src="/assets/images/posts/async-rendering.png" alt="Cover Image for Async Rendering with a single Rx Operator" loading="lazy" class="shadow-small object-contain w-full h-auto hover:shadow-medium transition-shadow duration-200"/></a></div></div><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/async-rendering-with-a-single-rx-operator">Async Rendering with a single Rx Operator</a></h3><div class="text-xs mb-2 flex flex-row space-x-2 items-center"><div class="text-gray-500"><time dateTime="2020-07-11T00:00:00.322Z">July	11, 2020</time></div><span class="text-gray-500">·</span><span class="text-gray-500">3 min read</span><span class="text-gray-500">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-2 items-center cursor-pointer collection--angular"><img style="width:16px;height:16px" src="/assets/images/collections/angular.png" alt="angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 text-sm">Increase your app rendering performance with this simple Rx operator</p></div></div></section></div></div></main></div><footer><div class="container mx-auto px-5"><hr class="border-accent-2 mt-16 mb-14"/><div class="flex-row flex justify-between my-8 md:my-12"><h2 class="font-normal tracking-tight md:tracking-tighter leading-tight"><a class="hover:underline" href="/"><b>GIANCARLO</b>BUOMPRISCO</a></h2><div><ul class="flex space-x-8 px-4"><li class="text-gray-700 hover:text-gray-900"><a href="/about">About Me</a></li></ul></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"readingTime":"6 min read","title":"Building Side Effects in NGRXs","date":"2019-06-05T00:00:00.322Z","slug":"building-side-effects-in-ngrx","content":"\u003chr\u003e\n\u003ch3\u003eBuilding Side Effects in NGRX\u003c/h3\u003e\n\u003cp\u003eThis is the third article of a series that aims to explain in detail a step-by-step approach to building an Angular application with NGRX.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIn \u003ca href=\"https://medium.com/r/?url=https%3A%2F%2Fitnext.io%2Fstate-management-with-ngrx-introduction-1aae0803e988\"\u003ethe first article of this series\u003c/a\u003e, I wrote a small overview of all the concepts surrounding the NGRX platform.\u003c/li\u003e\n\u003cli\u003eIn \u003ca href=\"https://medium.com/r/?url=https%3A%2F%2Fitnext.io%2Farchitecting-the-store-in-ngrx-e4955641d746\"\u003ethe second article of this series\u003c/a\u003e, I started writing the store of the application and the state’s entities.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIf you have never worked with NGRX, or have never done something in-depth with, I’d really recommend you read it.\u003c/p\u003e\n\u003ch3\u003eSummary\u003c/h3\u003e\n\u003cp\u003eJust to summarise what I introduced in the previous articles, we have an application that aims to display a dashboard with cryptocurrencies prices.\u003c/p\u003e\n\u003cp\u003eThe application’s logic is built using three service modules, each module manages a different feature of our store.\u003c/p\u003e\n\u003cp\u003eThese are:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003edashboard\u003c/strong\u003e, that manages the logic of the dashboard and its tiles\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eassets,\u003c/strong\u003e a list of assets fetched from \u003ca href=\"https://medium.com/r/?url=https%3A%2F%2Fcoincap.io\"\u003eCoincap’s\u003c/a\u003e API\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eprices,\u003c/strong\u003e a stream of prices from Coincap’s WebSocket API \u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eIn this article we will be learning:\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003ehow to build effects in NGRX 8\u003c/li\u003e\n\u003cli\u003ehow to build an effect that fetches the assets list from the API\u003c/li\u003e\n\u003cli\u003ehow to build an effect that connects to a WebSocket and listens for messages that will be stored in our application’s state\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eCoincap’s API Service\u003c/h3\u003e\n\u003cp\u003eIn order to fetch data from Coincap, we create a service that we’re going to use in our Effects classes:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token decorator\"\u003e\u003cspan class=\"token at operator\"\u003e@\u003c/span\u003e\u003cspan class=\"token function\"\u003eInjectable\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCoincapService\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e http\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e HttpClient\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token function\"\u003egetAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n        search\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        ids\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        limit \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e Observable\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eGetAssetsResponseDto\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehttp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token generic-function\"\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eGetAssetsResponseDto\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eEndPoints\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eAssets\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            params\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e search\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ids\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e limit\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e limit\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003etoString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAt the moment, we have one single method:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003egetAssets\u003c/strong\u003e, that by default will be fetching the first top 5 assets\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis method will be returning \u003ccode\u003eGetAssetsResponseDto\u003c/code\u003e which is simply:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword\"\u003einterface\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eGetAssetsResponseDto\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    data\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e Asset\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    timestamp\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eAssets Effects\u003c/h2\u003e\n\u003cp\u003eLet’s now create the effects for the \u003cem\u003eAssets\u003c/em\u003e store. As we have seen in the previous article, we have created three actions:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003egetAssetsRequestStarted\u003c/li\u003e\n\u003cli\u003egetAssetsRequestSuccess\u003c/li\u003e\n\u003cli\u003eaddAssets\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003ePrivate API\u003c/h3\u003e\n\u003cp\u003eLet’s summarize what our actions will be doing:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ewe want to react to a \u003cem\u003egetAssetsRequestStarted\u003c/em\u003e action and dispatch a \u003cem\u003egetAssetsRequestSuccess\u003c/em\u003e action\u003c/li\u003e\n\u003cli\u003eonce \u003cem\u003egetAssetsRequestSuccess\u003c/em\u003e action is received, we will dispatch \u003cem\u003eaddAssets\u003c/em\u003e that gets picked up by the reducer function and add the assets to the store\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLet’s first create the effect that will be responsible for fetching the assets:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003egetAllAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateEffect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eactions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epipe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003eofType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egetAssetsRequestStarted\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etype\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003emergeMap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecoincap\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epayload\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epipe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresponse\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e GetAssetsResponseDto\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e response\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"token function\"\u003ecatchError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003efilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eBoolean\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epayload\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e Asset\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003egetAssetsRequestSuccess\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003eLet’s break this effect down\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003einstead of using the decorator \u003ccode\u003e@Effect\u003c/code\u003e , we simply import the function \u003ccode\u003ecreateEffect\u003c/code\u003e from \u003ccode\u003e@ngrx/effects\u003c/code\u003e \u003c/li\u003e\n\u003cli\u003ewe receive an action \u003ccode\u003egetAssetsRequestStarted\u003c/code\u003e \u003c/li\u003e\n\u003cli\u003ewe call the \u003ccode\u003egetAssets\u003c/code\u003e method we defined earlier in the Coincap service, and we map the stream to the result of this request\u003c/li\u003e\n\u003cli\u003eif there’s an error, we simply return \u003ccode\u003eundefined\u003c/code\u003e which will be filtered in the stream thanks to \u003ccode\u003efilter(Boolean)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ewe then map the stream to the action \u003ccode\u003egetAssetsRequestSuccess\u003c/code\u003e \u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe second effect will be responsible for intercepting \u003ccode\u003egetAssetsRequestSuccess\u003c/code\u003e and simply map it to \u003ccode\u003eaddAssets\u003c/code\u003e \u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003eaddAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateEffect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eactions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epipe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003eofType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egetAssetsRequestSuccess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etype\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e Asset\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003eaddAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003ePublic API\u003c/h3\u003e\n\u003cp\u003eFinally, we expose the public API:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e getAllAssets$ \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetAllAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e addAssets$ \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd this is the complete snippet:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token decorator\"\u003e\u003cspan class=\"token at operator\"\u003e@\u003c/span\u003e\u003cspan class=\"token function\"\u003eInjectable\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eAssetsEffects\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e actions\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e Actions\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e coincap\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e CoincapService\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e getAllAssets$ \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetAllAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e addAssets$ \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003eaddAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateEffect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eactions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epipe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003eofType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egetAssetsRequestSuccess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etype\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e Asset\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n                    \u003cspan class=\"token function\"\u003eaddAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003egetAllAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateEffect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eactions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epipe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003eofType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egetAssetsRequestStarted\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etype\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emergeMap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n                    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecoincap\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epayload\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epipe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n                        \u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresponse\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e GetAssetsResponseDto\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e response\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"token function\"\u003ecatchError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eundefined\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003efilter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eBoolean\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epayload\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e Asset\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003egetAssetsRequestSuccess\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003ePrices Effects\u003c/h2\u003e\n\u003cp\u003eIn order to fetch the prices from the Coincap’s WebSocket API, we extend the Coincap service we created earlier and add a new method responsible for connecting to the price streams and returning an Observable that emits price ticks.\u003c/p\u003e\n\u003ch3\u003eWebSocket Connection \u003c/h3\u003e\n\u003cp\u003eIn order to do this, we:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecreate a connection by calling \u003ccode\u003eWebSocket(url)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ewe create a new Observable, and inside this, we emit an event every time the WebSocket connection receives a message using the \u003ccode\u003eonmessage\u003c/code\u003e hook\u003c/li\u003e\n\u003cli\u003ewe define the \u003ccode\u003eunsubscribe\u003c/code\u003e method, which will simply close the WebSocket connection\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCoincapService\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// .. other methods\u003c/span\u003e\n\n    webSocket\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e WebSocket\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token function\"\u003econnectToPriceStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eassets\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e Observable\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003ePriceState\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecreateConnection\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eassets\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eObservable\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eobserver \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e webSocket \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewebSocket\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n            webSocket\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function-variable function\"\u003eonmessage\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emsg\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e MessageEvent\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                observer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003enext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token constant\"\u003eJSON\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eparse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emsg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003eunsubscribe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                    webSocket\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eclose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateConnection\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eassets\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewebSocket\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewebSocket\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eclose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewebSocket \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWebSocket\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n            EndPoints\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eWebSocket \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003e?assets=\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003eassets\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003eAPI\u003c/h3\u003e\n\u003cp\u003eWe have created three actions:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecreatePriceSubscription\u003c/li\u003e\n\u003cli\u003eclosePriceSubscription\u003c/li\u003e\n\u003cli\u003eaddPrice\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAnd this is what the effects look like:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token decorator\"\u003e\u003cspan class=\"token at operator\"\u003e@\u003c/span\u003e\u003cspan class=\"token function\"\u003eInjectable\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ePricesEffects\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e actions\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e Actions\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e coincap\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e CoincapService\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e pricesFacade\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e PricesFacadeService\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    createPriceSubscription$ \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecreatePriceSubscription\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    prices$ \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetPrices\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreatePriceSubscription\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateEffect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eactions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epipe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003eofType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecreatePriceSubscription\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etype\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e payload\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003ewithLatestFrom\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epricesFacade\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetSubscribedAssets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emergeMap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003epayload\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e assets\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003econnectPriceStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token operator\"\u003e...\u003c/span\u003eassets\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e payload\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eprice\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e PriceState\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003epriceReceived\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e price \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003egetPrices\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateEffect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eactions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epipe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003eofType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epriceReceived\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etype\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eaddPrice\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e payload \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token function\"\u003econnectPriceStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eassets\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecoincap\n            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003econnectToPriceStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eassets\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epipe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003etakeUntil\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eactions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epipe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eofType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eclosePriceSubscription\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etype\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eLet’s break down the \u003ccode\u003ecreatePriceSubscription$\u003c/code\u003e effect:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ewe receive an action \u003ccode\u003ecreatePriceSubscription\u003c/code\u003e \u003c/li\u003e\n\u003cli\u003ewe connect to the stream via the Coincap service, which will return an \u003cem\u003eObservable\u003c/em\u003e that will emit prices\u003c/li\u003e\n\u003cli\u003eevery price will create an action \u003ccode\u003epriceReceived\u003c/code\u003e \u003c/li\u003e\n\u003cli\u003ewe add a \u003ccode\u003etakeUntil\u003c/code\u003e operator to the price stream observable, so that every time an action \u003ccode\u003eclosePriceSubscription\u003c/code\u003e is received, the observable will automatically be unsubscribed\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe \u003ccode\u003eprices$\u003c/code\u003e effect is fairly simple:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ewe receive an action \u003ccode\u003epriceReceived\u003c/code\u003e and we map it to an action \u003ccode\u003eaddPrice\u003c/code\u003e that will be handled by the reducer and will add the price to the store\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eUpdating the Store Modules\u003c/h3\u003e\n\u003cp\u003eLastly, we need to update both the store service modules by adding the effects using the method \u003ccode\u003eEffectsModule.forFeature([EffectsClass])\u003c/code\u003e . \u003c/p\u003e\n\u003cp\u003eThe prices store module looks something like this:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"token decorator\"\u003e\u003cspan class=\"token at operator\"\u003e@\u003c/span\u003e\u003cspan class=\"token function\"\u003eNgModule\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    imports\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n        StoreModule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eforFeature\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'prices'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e pricesReducer\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        EffectsModule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eforFeature\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ePricesEffects\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    providers\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// still empty!\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ePricesStoreModule\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eFinal Words\u003c/h2\u003e\n\u003cp\u003eIn this walkthrough, we create a few very simple effects that do some very common tasks, such as talking to an API endpoint, creating streams of Observables from real-time messaging systems, and updating the reducer as a result of dispatching actions.\u003c/p\u003e\n\u003cp\u003eIn the next article, we will finally build some components and connect the store to the UI using a Facade Service.\u003c/p\u003e\n\u003cp\u003eHope you enjoyed the article and leave a message if you agree, disagree, or if you would do anything differently!\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003eIf you enjoyed this article, follow me on\u003c/em\u003e \u003ca href=\"https://medium.com/@.gc\"\u003e\u003cem\u003eMedium\u003c/em\u003e\u003c/a\u003e \u003cem\u003eor\u003c/em\u003e \u003ca href=\"https://medium.com/r/?url=https%3A%2F%2Ftwitter.com%2Fhome\"\u003e\u003cem\u003eTwitter\u003c/em\u003e\u003c/a\u003e \u003cem\u003efor more articles about Angular, RxJS, Typescript and more!\u003c/em\u003e\u003c/p\u003e\n","ogImage":{"url":"https://cdn-images-1.medium.com/max/1600/1*R3-0VFvXB2rq-rAtWyNwxA.gif"},"coverImage":"https://cdn-images-1.medium.com/max/1600/1*R3-0VFvXB2rq-rAtWyNwxA.gif","collection":"angular"},"morePosts":[{"readingTime":"3 min read","title":"Benchmarking Angular 12 with Webpack 5","date":"2021-05-14T00:00:00.322Z","slug":"webpack-5-angular12","coverImage":"/assets/images/posts/benchmarking-webpack-5.png","collection":"angular","excerpt":"Angular 12 has been released and with it the much awaited Webpack 5 upgrade. In this post I benchmarked the bundle-size and compilation speed against the previous version"},{"readingTime":"5 min read","title":"Principles for creating libraries with Nx and Angular","date":"2021-02-07T00:00:00.322Z","slug":"how-to-organize-nx-modules-with-angular","coverImage":"/assets/images/posts/organize-nx-modules-ngrx.png","collection":"angular","excerpt":"Working with Nx may be confusing. This article explains how I create Nx libraries and the principles behind my motivations"},{"readingTime":"3 min read","title":"Where to put your Angular models?","date":"2020-08-03T00:00:00.322Z","slug":"angular-where-to-put-models","ogImage":{"url":"/assets/images/posts/where-put-angular-models.png"},"coverImage":"/assets/images/posts/where-put-angular-models.png","collection":"angular","excerpt":"Organizing entities and models in your Angular app may be hard. This article explains where to put your entities and what mistakes to watch out for"},{"readingTime":"5 min read","title":"Using the Intersection Observer API with Angular","date":"2020-08-01T00:00:00.322Z","slug":"intersection-observer-with-angular","coverImage":"/assets/images/posts/intersection-observer.png","collection":"angular","excerpt":"This article shows how to build a directive with Angular that uses the Intersection Observer API to check when an element becomes visible on the page"},{"readingTime":"3 min read","title":"Setters vs ngOnChanges: which one is better?","date":"2020-07-30T00:00:00.322Z","slug":"setters-vs-ng-on-changes","coverImage":"/assets/images/posts/setters-vs-on-changes.png","collection":"angular","excerpt":"Listening to Input changes can be done in different ways. But which one should you use?"},{"readingTime":"3 min read","title":"Async Rendering with a single Rx Operator","date":"2020-07-11T00:00:00.322Z","slug":"async-rendering-with-a-single-rx-operator","coverImage":"/assets/images/posts/async-rendering.png","collection":"angular","excerpt":"Increase your app rendering performance with this simple Rx operator"}]},"__N_SSG":true},"page":"/[collection]/[slug]","query":{"collection":"angular","slug":"building-side-effects-in-ngrx"},"buildId":"HcR7uyGAuEx8S7Y8lnph4","isFallback":false,"gsp":true,"scriptLoader":[]}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-172483071-1"></script><script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-172483071-1');
</script></body></html>