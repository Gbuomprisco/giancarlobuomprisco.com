<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&amp;family=Merriweather:wght@300;400;700&amp;display=swap"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="theme-color" content="#212121"/><meta name="author" content="Giancarlo Buomprisco"/><meta property="og:title" content="Giancarlo Buomprisco"/><meta name="description" content="Giancarlo Buomprisco&#x27;s Website"/><meta property="og:description" content="Giancarlo Buomprisco&#x27;s Website"/><meta property="og:site_name" content="giancarlobuomprisco.com"/><meta property="twitter:title" content="giancarlobuomprisco.com"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:creator" content="@gc_psk"/><title>Debugging Memory Leaks in Angular</title><meta property="twitter:title" content="Debugging Memory Leaks in Angular"/><meta property="article:published_time" content="2019-10-29T00:00:00.000Z"/><meta property="og:description" content="The situations where memory leaks are most likely to happen, and how you can deal with them using Chrome DevTools"/><link rel="canonical" href="https://blog.bitsrc.io/debugging-memory-leaks-in-angular-4bc7b3eab569"/><meta property="og:image" content="https://cdn-images-1.medium.com/max/10624/0*Vu4ib4QAqreImyMW"/><meta name="next-head-count" content="27"/><link rel="preload" href="/_next/static/css/28e82fdf69eb9d94.css" as="style"/><link rel="stylesheet" href="/_next/static/css/28e82fdf69eb9d94.css" data-n-g=""/><link rel="preload" href="/_next/static/css/259e1d542b53ad97.css" as="style"/><link rel="stylesheet" href="/_next/static/css/259e1d542b53ad97.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-27593bf8d60abcde.js" defer=""></script><script src="/_next/static/chunks/framework-93dc06fa7fcdddfb.js" defer=""></script><script src="/_next/static/chunks/main-e47b4831833660b7.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8ff1c8d9702d8e84.js" defer=""></script><script src="/_next/static/chunks/501-5650b991910e93a7.js" defer=""></script><script src="/_next/static/chunks/289-a5a6d4f4813f3e92.js" defer=""></script><script src="/_next/static/chunks/412-4faa570e2e4df764.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bcollection%5D/%5Bslug%5D-d19d9ab5e6444f09.js" defer=""></script><script src="/_next/static/SZu6xQbictN_BfVk1b1K_/_buildManifest.js" defer=""></script><script src="/_next/static/SZu6xQbictN_BfVk1b1K_/_ssgManifest.js" defer=""></script><script src="/_next/static/SZu6xQbictN_BfVk1b1K_/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div><main><div style="--from:#dd00316e;--to:#e23236" class="collection-branding-bar_gradient__1Ie5x"></div><div class="container mx-auto px-5"><div class="flex-row flex justify-between items-center my-6 md:my-8"><a class="hover:underline" href="/"><svg width="100" height="60" viewBox="0 0 735 313" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M104.913 105.5C100.913 108.7 96.1133 112.2 90.5133 116C85.1133 119.8 79.4133 123.6 73.4133 127.4C67.6133 131.2 62.0133 134.8 56.6133 138.2C51.2133 141.6 46.6133 144.4 42.8133 146.6C46.6133 148.8 51.2133 151.6 56.6133 155C62.0133 158.4 67.6133 162 73.4133 165.8C79.4133 169.6 85.1133 173.5 90.5133 177.5C96.1133 181.3 100.913 184.7 104.913 187.7C108.313 190.5 111.313 193.2 113.913 195.8C116.713 198.2 118.113 201.1 118.113 204.5C118.113 207.5 117.013 210.3 114.813 212.9C113.413 214.3 112.013 215.4 110.613 216.2C109.213 217 107.613 217.4 105.813 217.4C104.013 217.4 101.813 216.9 99.2133 215.9C96.6133 214.7 93.3133 212.8 89.3133 210.2C76.7133 202.4 65.5133 195.6 55.7133 189.8C45.9133 183.8 37.6133 178.4 30.8133 173.6C24.2133 168.8 19.1133 164.3 15.5133 160.1C12.1133 155.7 10.4133 151.2 10.4133 146.6C10.4133 142 12.1133 137.6 15.5133 133.4C18.9133 129.2 23.9133 124.7 30.5133 119.9C37.3133 114.9 45.6133 109.5 55.4133 103.7C65.2133 97.7 76.5133 90.8 89.3133 83C93.3133 80.4 96.6133 78.6 99.2133 77.6C101.813 76.4 104.013 75.8 105.813 75.8C107.613 75.8 109.213 76.2 110.613 77C112.013 77.8 113.413 78.9 114.813 80.3C117.013 82.9 118.113 85.7 118.113 88.7C118.113 92.1 116.713 95.1 113.913 97.7C111.313 100.1 108.313 102.7 104.913 105.5ZM229.734 44.6C236.334 44.6 243.134 45.2 250.134 46.4C257.134 47.6 263.534 49.4 269.334 51.8C275.134 54 279.934 56.8 283.734 60.2C287.534 63.6 289.434 67.5 289.434 71.9C289.434 76.5 288.234 80 285.834 82.4C283.434 84.8 280.434 86 276.834 86C273.434 86 270.234 85.4 267.234 84.2C264.434 83 261.234 81.7 257.634 80.3C254.034 78.9 249.734 77.6 244.734 76.4C239.734 75.2 233.434 74.6 225.834 74.6C217.434 74.6 209.534 76.6 202.134 80.6C194.934 84.4 188.534 89.8 182.934 96.8C177.334 103.6 172.934 111.7 169.734 121.1C166.534 130.5 164.934 140.7 164.934 151.7C164.934 165.1 166.634 176.7 170.034 186.5C173.434 196.3 177.834 204.4 183.234 210.8C188.834 217.2 195.034 222 201.834 225.2C208.834 228.2 215.834 229.7 222.834 229.7C234.234 229.7 243.234 228.1 249.834 224.9C256.634 221.5 262.034 217.2 266.034 212C266.234 207.8 266.334 202.8 266.334 197C266.334 191.2 266.334 184.9 266.334 178.1C266.334 175.5 266.134 173.5 265.734 172.1C265.334 170.5 264.334 169.3 262.734 168.5C261.134 167.7 258.734 167.2 255.534 167C252.534 166.8 248.434 166.7 243.234 166.7C236.834 166.7 231.634 165.9 227.634 164.3C223.634 162.5 221.634 158.8 221.634 153.2C221.634 149.2 222.634 146 224.634 143.6C226.834 141 231.234 139.5 237.834 139.1C239.034 139.1 240.934 139.1 243.534 139.1C246.334 138.9 249.234 138.8 252.234 138.8C255.434 138.8 258.534 138.8 261.534 138.8C264.534 138.8 266.934 138.8 268.734 138.8C274.734 138.8 279.534 139.4 283.134 140.6C286.734 141.6 289.934 144 292.734 147.8C294.134 149.8 294.934 153.3 295.134 158.3C295.534 163.3 295.734 169.1 295.734 175.7V253.1C295.734 258.5 294.234 262.5 291.234 265.1C288.434 267.7 285.134 269 281.334 269C276.734 269 272.934 267.8 269.934 265.4C267.134 263.2 265.734 259.6 265.734 254.6V242.9C260.534 248.9 254.334 253.2 247.134 255.8C240.134 258.4 231.234 259.7 220.434 259.7C209.434 259.7 198.634 257.5 188.034 253.1C177.434 248.7 168.034 242.2 159.834 233.6C151.634 224.8 144.934 213.9 139.734 200.9C134.734 187.7 132.234 172.4 132.234 155C132.234 137.6 134.734 122.1 139.734 108.5C144.934 94.9 151.934 83.4 160.734 74C169.534 64.4 179.834 57.1 191.634 52.1C203.434 47.1 216.134 44.6 229.734 44.6ZM361.964 60.8C361.964 72.8 361.564 85.4 360.764 98.6C360.164 111.6 359.364 124.3 358.364 136.7C360.964 131.3 364.364 126.7 368.564 122.9C372.764 118.9 377.364 115.7 382.364 113.3C387.564 110.9 392.964 109.1 398.564 107.9C404.164 106.7 409.564 106.1 414.764 106.1C423.764 106.1 432.164 107.8 439.964 111.2C447.964 114.4 454.864 119.2 460.664 125.6C466.664 131.8 471.264 139.6 474.464 149C477.864 158.2 479.564 168.8 479.564 180.8C479.564 192.4 477.864 203 474.464 212.6C471.064 222.2 465.964 230.5 459.164 237.5C452.564 244.3 444.264 249.6 434.264 253.4C424.464 257.2 413.164 259.1 400.364 259.1C382.964 259.1 369.264 255.6 359.264 248.6C349.464 241.6 342.164 232.3 337.364 220.7C332.564 208.9 329.564 195.4 328.364 180.2C327.364 165 326.864 149.1 326.864 132.5C326.864 115.7 327.164 100.5 327.764 86.9C328.364 73.3 329.264 62.3 330.464 53.9C331.664 46.3 333.664 40.9 336.464 37.7C339.264 34.5 342.964 32.9 347.564 32.9C350.964 32.9 353.664 33.7 355.664 35.3C357.664 36.7 359.064 38.7 359.864 41.3C360.864 43.9 361.464 46.9 361.664 50.3C361.864 53.5 361.964 57 361.964 60.8ZM406.364 135.8C400.564 135.8 394.964 136.8 389.564 138.8C384.364 140.6 379.664 143.5 375.464 147.5C371.464 151.5 368.264 156.6 365.864 162.8C363.464 168.8 362.264 176.1 362.264 184.7C362.264 199.9 365.964 211.5 373.364 219.5C380.964 227.3 391.064 231.2 403.664 231.2C408.864 231.2 414.164 230.5 419.564 229.1C424.964 227.5 429.864 224.9 434.264 221.3C438.664 217.5 442.264 212.5 445.064 206.3C447.864 200.1 449.264 192.4 449.264 183.2C449.264 175 448.064 167.9 445.664 161.9C443.464 155.9 440.364 151 436.364 147.2C432.364 143.2 427.764 140.3 422.564 138.5C417.364 136.7 411.964 135.8 406.364 135.8ZM508.61 238.7C511.01 230.7 513.81 221.4 517.01 210.8C520.21 200 523.71 188.4 527.51 176C531.51 163.4 535.71 150.2 540.11 136.4C544.71 122.6 549.31 108.5 553.91 94.1C557.91 81.9 561.41 71.3 564.41 62.3C567.61 53.1 570.51 45.6 573.11 39.8C575.91 34 578.51 29.7 580.91 26.9C583.51 23.9 586.31 22.4 589.31 22.4C592.31 22.4 595.01 23.4 597.41 25.4C600.01 27.4 601.31 30.5 601.31 34.7C601.31 36.1 601.21 37.6 601.01 39.2C600.81 40.8 600.41 42.7 599.81 44.9C590.41 78.1 580.21 111.7 569.21 145.7C558.21 179.5 546.51 213.2 534.11 246.8C531.71 253.2 529.41 257.5 527.21 259.7C525.01 261.9 522.81 263 520.61 263C517.01 263 513.81 262 511.01 260C508.21 258 506.81 254.7 506.81 250.1C506.81 247.3 507.41 243.5 508.61 238.7ZM624.199 105.5C620.799 102.7 617.699 100.1 614.899 97.7C612.299 95.1 610.999 92.1 610.999 88.7C610.999 85.7 612.099 82.9 614.299 80.3C615.699 78.9 617.099 77.8 618.499 77C619.899 76.2 621.499 75.8 623.299 75.8C625.099 75.8 627.299 76.4 629.899 77.6C632.499 78.6 635.799 80.4 639.799 83C652.599 90.8 663.899 97.7 673.699 103.7C683.499 109.5 691.699 114.9 698.299 119.9C705.099 124.7 710.199 129.2 713.599 133.4C716.999 137.6 718.699 142 718.699 146.6C718.699 151.2 716.899 155.7 713.299 160.1C709.899 164.3 704.799 168.8 697.999 173.6C691.399 178.4 683.199 183.8 673.399 189.8C663.599 195.6 652.399 202.4 639.799 210.2C635.799 212.8 632.499 214.7 629.899 215.9C627.299 216.9 625.099 217.4 623.299 217.4C621.499 217.4 619.899 217 618.499 216.2C617.099 215.4 615.699 214.3 614.299 212.9C612.099 210.3 610.999 207.5 610.999 204.5C610.999 201.1 612.299 198.2 614.899 195.8C617.699 193.2 620.799 190.5 624.199 187.7C627.999 184.7 632.699 181.3 638.299 177.5C643.899 173.5 649.599 169.6 655.399 165.8C661.199 162 666.799 158.4 672.199 155C677.799 151.6 682.499 148.8 686.299 146.6C682.499 144.4 677.799 141.6 672.199 138.2C666.799 134.8 661.199 131.2 655.399 127.4C649.599 123.6 643.899 119.8 638.299 116C632.699 112.2 627.999 108.7 624.199 105.5Z" fill="#111827"></path></svg></a><div class="justify-end lg:hidden flex"><button aria-label="Open Menu" class="navbar-burger" type="button"><span class="block relative w-7 rounded-sm bg-black h-1"></span><span class="block relative w-7 rounded-sm bg-black h-1 mt-1"></span><span class="block relative w-7 rounded-sm bg-black h-1 mt-1"></span></button></div><ul class="lg:space-x-8 px-4 hidden flex-col space-y-4 lg:space-y-0 lg:flex lg:flex-row nav"><li class="flex flex-row justify-between pt-4 mb-6 lg:hidden"><div><a class="hover:underline" href="/"><svg width="100" height="60" viewBox="0 0 735 313" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M104.913 105.5C100.913 108.7 96.1133 112.2 90.5133 116C85.1133 119.8 79.4133 123.6 73.4133 127.4C67.6133 131.2 62.0133 134.8 56.6133 138.2C51.2133 141.6 46.6133 144.4 42.8133 146.6C46.6133 148.8 51.2133 151.6 56.6133 155C62.0133 158.4 67.6133 162 73.4133 165.8C79.4133 169.6 85.1133 173.5 90.5133 177.5C96.1133 181.3 100.913 184.7 104.913 187.7C108.313 190.5 111.313 193.2 113.913 195.8C116.713 198.2 118.113 201.1 118.113 204.5C118.113 207.5 117.013 210.3 114.813 212.9C113.413 214.3 112.013 215.4 110.613 216.2C109.213 217 107.613 217.4 105.813 217.4C104.013 217.4 101.813 216.9 99.2133 215.9C96.6133 214.7 93.3133 212.8 89.3133 210.2C76.7133 202.4 65.5133 195.6 55.7133 189.8C45.9133 183.8 37.6133 178.4 30.8133 173.6C24.2133 168.8 19.1133 164.3 15.5133 160.1C12.1133 155.7 10.4133 151.2 10.4133 146.6C10.4133 142 12.1133 137.6 15.5133 133.4C18.9133 129.2 23.9133 124.7 30.5133 119.9C37.3133 114.9 45.6133 109.5 55.4133 103.7C65.2133 97.7 76.5133 90.8 89.3133 83C93.3133 80.4 96.6133 78.6 99.2133 77.6C101.813 76.4 104.013 75.8 105.813 75.8C107.613 75.8 109.213 76.2 110.613 77C112.013 77.8 113.413 78.9 114.813 80.3C117.013 82.9 118.113 85.7 118.113 88.7C118.113 92.1 116.713 95.1 113.913 97.7C111.313 100.1 108.313 102.7 104.913 105.5ZM229.734 44.6C236.334 44.6 243.134 45.2 250.134 46.4C257.134 47.6 263.534 49.4 269.334 51.8C275.134 54 279.934 56.8 283.734 60.2C287.534 63.6 289.434 67.5 289.434 71.9C289.434 76.5 288.234 80 285.834 82.4C283.434 84.8 280.434 86 276.834 86C273.434 86 270.234 85.4 267.234 84.2C264.434 83 261.234 81.7 257.634 80.3C254.034 78.9 249.734 77.6 244.734 76.4C239.734 75.2 233.434 74.6 225.834 74.6C217.434 74.6 209.534 76.6 202.134 80.6C194.934 84.4 188.534 89.8 182.934 96.8C177.334 103.6 172.934 111.7 169.734 121.1C166.534 130.5 164.934 140.7 164.934 151.7C164.934 165.1 166.634 176.7 170.034 186.5C173.434 196.3 177.834 204.4 183.234 210.8C188.834 217.2 195.034 222 201.834 225.2C208.834 228.2 215.834 229.7 222.834 229.7C234.234 229.7 243.234 228.1 249.834 224.9C256.634 221.5 262.034 217.2 266.034 212C266.234 207.8 266.334 202.8 266.334 197C266.334 191.2 266.334 184.9 266.334 178.1C266.334 175.5 266.134 173.5 265.734 172.1C265.334 170.5 264.334 169.3 262.734 168.5C261.134 167.7 258.734 167.2 255.534 167C252.534 166.8 248.434 166.7 243.234 166.7C236.834 166.7 231.634 165.9 227.634 164.3C223.634 162.5 221.634 158.8 221.634 153.2C221.634 149.2 222.634 146 224.634 143.6C226.834 141 231.234 139.5 237.834 139.1C239.034 139.1 240.934 139.1 243.534 139.1C246.334 138.9 249.234 138.8 252.234 138.8C255.434 138.8 258.534 138.8 261.534 138.8C264.534 138.8 266.934 138.8 268.734 138.8C274.734 138.8 279.534 139.4 283.134 140.6C286.734 141.6 289.934 144 292.734 147.8C294.134 149.8 294.934 153.3 295.134 158.3C295.534 163.3 295.734 169.1 295.734 175.7V253.1C295.734 258.5 294.234 262.5 291.234 265.1C288.434 267.7 285.134 269 281.334 269C276.734 269 272.934 267.8 269.934 265.4C267.134 263.2 265.734 259.6 265.734 254.6V242.9C260.534 248.9 254.334 253.2 247.134 255.8C240.134 258.4 231.234 259.7 220.434 259.7C209.434 259.7 198.634 257.5 188.034 253.1C177.434 248.7 168.034 242.2 159.834 233.6C151.634 224.8 144.934 213.9 139.734 200.9C134.734 187.7 132.234 172.4 132.234 155C132.234 137.6 134.734 122.1 139.734 108.5C144.934 94.9 151.934 83.4 160.734 74C169.534 64.4 179.834 57.1 191.634 52.1C203.434 47.1 216.134 44.6 229.734 44.6ZM361.964 60.8C361.964 72.8 361.564 85.4 360.764 98.6C360.164 111.6 359.364 124.3 358.364 136.7C360.964 131.3 364.364 126.7 368.564 122.9C372.764 118.9 377.364 115.7 382.364 113.3C387.564 110.9 392.964 109.1 398.564 107.9C404.164 106.7 409.564 106.1 414.764 106.1C423.764 106.1 432.164 107.8 439.964 111.2C447.964 114.4 454.864 119.2 460.664 125.6C466.664 131.8 471.264 139.6 474.464 149C477.864 158.2 479.564 168.8 479.564 180.8C479.564 192.4 477.864 203 474.464 212.6C471.064 222.2 465.964 230.5 459.164 237.5C452.564 244.3 444.264 249.6 434.264 253.4C424.464 257.2 413.164 259.1 400.364 259.1C382.964 259.1 369.264 255.6 359.264 248.6C349.464 241.6 342.164 232.3 337.364 220.7C332.564 208.9 329.564 195.4 328.364 180.2C327.364 165 326.864 149.1 326.864 132.5C326.864 115.7 327.164 100.5 327.764 86.9C328.364 73.3 329.264 62.3 330.464 53.9C331.664 46.3 333.664 40.9 336.464 37.7C339.264 34.5 342.964 32.9 347.564 32.9C350.964 32.9 353.664 33.7 355.664 35.3C357.664 36.7 359.064 38.7 359.864 41.3C360.864 43.9 361.464 46.9 361.664 50.3C361.864 53.5 361.964 57 361.964 60.8ZM406.364 135.8C400.564 135.8 394.964 136.8 389.564 138.8C384.364 140.6 379.664 143.5 375.464 147.5C371.464 151.5 368.264 156.6 365.864 162.8C363.464 168.8 362.264 176.1 362.264 184.7C362.264 199.9 365.964 211.5 373.364 219.5C380.964 227.3 391.064 231.2 403.664 231.2C408.864 231.2 414.164 230.5 419.564 229.1C424.964 227.5 429.864 224.9 434.264 221.3C438.664 217.5 442.264 212.5 445.064 206.3C447.864 200.1 449.264 192.4 449.264 183.2C449.264 175 448.064 167.9 445.664 161.9C443.464 155.9 440.364 151 436.364 147.2C432.364 143.2 427.764 140.3 422.564 138.5C417.364 136.7 411.964 135.8 406.364 135.8ZM508.61 238.7C511.01 230.7 513.81 221.4 517.01 210.8C520.21 200 523.71 188.4 527.51 176C531.51 163.4 535.71 150.2 540.11 136.4C544.71 122.6 549.31 108.5 553.91 94.1C557.91 81.9 561.41 71.3 564.41 62.3C567.61 53.1 570.51 45.6 573.11 39.8C575.91 34 578.51 29.7 580.91 26.9C583.51 23.9 586.31 22.4 589.31 22.4C592.31 22.4 595.01 23.4 597.41 25.4C600.01 27.4 601.31 30.5 601.31 34.7C601.31 36.1 601.21 37.6 601.01 39.2C600.81 40.8 600.41 42.7 599.81 44.9C590.41 78.1 580.21 111.7 569.21 145.7C558.21 179.5 546.51 213.2 534.11 246.8C531.71 253.2 529.41 257.5 527.21 259.7C525.01 261.9 522.81 263 520.61 263C517.01 263 513.81 262 511.01 260C508.21 258 506.81 254.7 506.81 250.1C506.81 247.3 507.41 243.5 508.61 238.7ZM624.199 105.5C620.799 102.7 617.699 100.1 614.899 97.7C612.299 95.1 610.999 92.1 610.999 88.7C610.999 85.7 612.099 82.9 614.299 80.3C615.699 78.9 617.099 77.8 618.499 77C619.899 76.2 621.499 75.8 623.299 75.8C625.099 75.8 627.299 76.4 629.899 77.6C632.499 78.6 635.799 80.4 639.799 83C652.599 90.8 663.899 97.7 673.699 103.7C683.499 109.5 691.699 114.9 698.299 119.9C705.099 124.7 710.199 129.2 713.599 133.4C716.999 137.6 718.699 142 718.699 146.6C718.699 151.2 716.899 155.7 713.299 160.1C709.899 164.3 704.799 168.8 697.999 173.6C691.399 178.4 683.199 183.8 673.399 189.8C663.599 195.6 652.399 202.4 639.799 210.2C635.799 212.8 632.499 214.7 629.899 215.9C627.299 216.9 625.099 217.4 623.299 217.4C621.499 217.4 619.899 217 618.499 216.2C617.099 215.4 615.699 214.3 614.299 212.9C612.099 210.3 610.999 207.5 610.999 204.5C610.999 201.1 612.299 198.2 614.899 195.8C617.699 193.2 620.799 190.5 624.199 187.7C627.999 184.7 632.699 181.3 638.299 177.5C643.899 173.5 649.599 169.6 655.399 165.8C661.199 162 666.799 158.4 672.199 155C677.799 151.6 682.499 148.8 686.299 146.6C682.499 144.4 677.799 141.6 672.199 138.2C666.799 134.8 661.199 131.2 655.399 127.4C649.599 123.6 643.899 119.8 638.299 116C632.699 112.2 627.999 108.7 624.199 105.5Z" fill="#111827"></path></svg></a></div><div class="flex justify-end"><span class="bg-gray-100 font-bold text-sm rounded-full shadow-xl flex items-center justify-center w-16 h-16">Close</span></div></li><li class="active:text-black text-lg lg:text-base text-gray-800 hover:text-gray-900 font-medium hover:underline"><a class="block" href="/blog">Blog</a></li><li class="active:text-black text-lg lg:text-base text-gray-800 hover:text-gray-900 font-medium hover:underline"><a class="block" href="/articles">Articles</a></li><li class="active:text-black text-lg lg:text-base text-gray-800 hover:text-gray-900 font-medium hover:underline"><a class="block" href="/consulting">Consulting</a></li><li class="active:text-black text-lg lg:text-base text-gray-800 hover:text-gray-900 font-medium hover:underline"><a class="block" href="/about">About</a></li><li class="active:text-black text-lg lg:text-base text-gray-800 hover:text-gray-900 font-medium hover:underline"><a class="block" href="/contact">Contact me</a></li></ul></div><article class="mb-16" style="--accent:#e23236;--accent-light:#e23236;--accent-contrast:#ffffff"><h1 class="text-5xl md:text-7xl lg:text-8xl font-bold tracking-tighter md:leading-none mb-8 text-center">Debugging Memory Leaks in Angular</h1><div class="mb-6 flex space-x-2 items-center justify-center"><div style="box-shadow:0 0 0 2px #e23236" class="text-center flex flex-row space-x-1 items-center cursor-pointer justify-center px-2 py-1 rounded-md hover:shadow-md transition-shadow font-bold"><a class="flex flex-row space-x-1 items-center justify-center" href="/angular"><img class="object-contain" loading="lazy" style="width:18px;height:18px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></a></div><div style="border:2px solid #323232" class="text-center flex flex-row space-x-1 items-center cursor-pointer justify-center px-2 py-1 rounded-md hover:shadow-md transition-shadow font-bold"><a href="/tags/performance">performance</a></div></div><div class="max-w-2xl mx-auto mb-6"><div class="flex flex-row space-x-2 items-center justify-center"><div class="flex flex-row space-x-3 items-center"><a target="_blank" rel="noreferrer noopened" href="https://twitter.com/@gc_psk"><img width="45px" height="45px" src="/assets/giancarlo-2.png"/></a><a class="text-sm text-gray-600" target="_blank" rel="noreferrer noopened" href="https://twitter.com/@gc_psk">@gc_psk</a></div><span class="text-gray-600">·</span><div class="text-sm text-center text-gray-600"><time dateTime="2019-10-29T00:00:00.000Z">Oct 29, 2019</time></div><span class="text-gray-600">·</span><span class="text-gray-600 text-sm">10 min read</span></div></div><div class="mb-8 md:mb-16 sm:mx-0"><div class="mx-auto w-12/12 lg:w-10/12 xl:w-8/12 justify-center"><div class="sm:mx-0"><img style="width:100%;height:auto" class="block shadow-lg" src="https://cdn-images-1.medium.com/max/10624/0*Vu4ib4QAqreImyMW" alt="Cover Image for Debugging Memory Leaks in Angular" loading="lazy"/></div></div></div><div class="mb-12 max-w-2xl mx-auto"></div><div class="max-w-2xl mx-auto leading-loose markdown-styles_markdown__1x9gM"><p>This post was originally published, by myself, on the <a href="https://blog.bitsrc.io" target="_blank" rel="noopener noreferrer">Bit</a> blog</p><h2>Introduction to Memory Leaks</h2><p>Building large applications entails writing lots of code, complex pages, long lists, and hundreds (if not more) of components. If you’ve worked at least once in a non-trivial web application, you may have found yourself battling a memory leak for hours and hours.</p><p>In this article, I want to introduce you to a number of situations where memory leaks are most likely to happen, and how you can deal with them thanks to the powerful <em>Chrome DevTools</em>.</p><p><strong>Preface</strong>: Angular is a framework that does a really great job at memory management: in fact, you almost never have to do something specific to avoid memory leaks!
Nonetheless, I’ve found myself in a number of scenarios that led to mistakes resulting in memory leaks and, as a consequence, a crippled user-experience for my company’s clients.</p><p>Not good.</p><h3>What’s a Memory Leak?</h3><p>In layman’s terms, a memory leak occurs when an application fails to get rid of unused resources.</p><p>If the memory of an application is using more and more memory without being populated with new resources (images, text, objects, etc.), then the application is likely affected by this sort of performance degradation.</p><p><strong>Tip: </strong>Use <a href="https://bit.dev/" target="_blank" rel="noopener noreferrer">**Bit</a>** (<a href="https://github.com/teambit/bit" target="_blank" rel="noopener noreferrer">Github</a>) to easily share and reuse Angular components across your projects, suggest updates, sync changes and build faster as a team.</p><p>Don’t waste time rewriting mediocre code — build awesome reusable Angular components, test them in isolation using <a href="https://bit.dev" target="_blank" rel="noopener noreferrer">Bit</a> and share them on <a href="https://bit.dev" target="_blank" rel="noopener noreferrer">bit.dev</a>.</p><p><img src="https://cdn-images-1.medium.com/max/2000/1*ODhvAjHjB8zPErBYhOFePQ.gif" alt="Components with Bit: Easily share across projects as a team" loading="lazy"/></p><h3>Why Memory Leaks are tricky</h3><p>The trickiest aspect of memory leaks is that they are pretty hard bugs to spot. Unlike CPU usage issues, where you can see the UI lagging, memory leaks (especially for smaller apps) are <strong>much a more subtle sort of problem</strong>.</p><p>If not also in charge of QA, the way most developers work is to focus on the context of their task, and very rarely they have to switch page dozens of times, create and re-create large lists, or in general perform long-lived actions that are naturally where memory leaks become apparent.</p><p>In fact, your applications may have dozens of memory leaks who have not yet been discovered!</p><p>Nowadays, users reload pages less and less often. As someone who works in the financial sector, I should know: traders hate reloading! The computers in offices are rarely restarted and so are browser pages.</p><p>This is why <strong>keeping performance optimal for long-lived sessions is essential</strong>: if an application is leaking memory, the user will at some point realize that it is slower, sluggish, and will likely pause very frequently.</p><p>And we don’t want our users to get frustrated. Right!?</p><h2>Debugging Process</h2><p>In this section, we will explore some real-world scenarios in Angular applications where it’s most likely to encounter potential mistakes that lead to memory leaks.</p><p>The irony about this article is that I planned on purposefully add mistakes in my code (using my guinea pig project <a href="https://github.com/Gbuomprisco/cryptofolio" target="_blank" rel="noopener noreferrer">Cryptofolio</a>) to produce a memory leak.</p><p><img src="https://cdn-images-1.medium.com/max/6712/1*dvMLBySign-rcQHfjl22nA.gif" alt="Cryptofolio shows live crypto prices" loading="lazy"/></p><p>As it turns out, it wasn’t needed! A leak was already there. All I did in order to reproduce it was to initialize the app with 101 pricers — back and forth a couple of times between pages, et voilá — the memory went nuts!</p><p><strong>Notice</strong>: the application I am using is very small, and as a result, the mistakes won’t cause the app to crash, and more importantly, the objects retained in memory won’t be immediately easy to find in the Heap Snapshots.</p><h3>Monitoring Memory with the Performance Monitor tool</h3><p>The application I built allows me to display prices in two separates views: list and dashboard; these two are two different pages, so the components contained in each of them are supposed to be destroyed and collected when you navigate to another page.</p><p>The first thing to do is to open the Chrome Dev Tools, open the panel on the right and click on <em>More Tools</em> &gt; <em>Performance Monitor. </em>The memory of our application is displayed in the blue graph.</p><p>As you can see in the image below, whenever I switch page, the memory jumps up almost 20mb!</p><p><img src="https://cdn-images-1.medium.com/max/2564/1*5AqFfFGibplrZT3H3FDTIw.gif" alt="Js heap size increasing when switching page" loading="lazy"/></p><p>I keep switching back and forth, and this is the result below:</p><p><img src="https://cdn-images-1.medium.com/max/6694/1*EqGwTm1ieNl0nik6YvzpLw.png" alt="Performance Monitor" loading="lazy"/></p><p>🔥154MB and 99% CPU? Clearly, something’s wrong🔥</p><h3>Starting the debugging process: Memory Snapshots</h3><p>The first thing I do when debugging is to record memory snapshots in two stages:</p><ul><li><p>at initial load, as soon as the app becomes stable and all the elements have been loaded</p></li><li><p>a second time once the initial data is replaced by other data. It’s quite important to make sure your app is not actually adding additional resources, unless of course if that is a bug. For example, you could be switching page or forcing some elements to show/hide</p></li></ul><p>The above will allow me to compare them with the Dev Tools’ Memory Snapshots.</p><p><strong>Tip</strong>: Make sure you also tick “Event Listeners”: it will help understand if the number of event listeners is piling up.</p><p>In order to take a Memory Snapshot, open the Dev Tools-&gt;Memory, select “Heap Snapshot” and then click on the button “Take Snapshot”. The profiles are listed on the left-hand side and you can compare them with each other to visualize which objects have been retained in memory.</p><h3>Exploring the Snapshot 🧭</h3><p>As you can see in the image below, I proceeded by taking 2 heap snapshots, listed on the left.</p><p>When the initial snapshot is taken, the tools will show you the summary of the current snapshot, but you can compare two snapshots by choosing “Comparison” from the dropdown above the objects.</p><p>The list displayed by the snapshot can look pretty alien, low-level and unfamiliar if you have been a Web Developer all your life like me, but don’t let that scare you off. The most important thing is to be patient and understand the clues that will lead you to the memory leak.</p><p>As soon as I took the snapshot, I started scrolling through the items looking for clues and familiar pieces of code, and one item immediately caught my attention: <em>MapSubscriber</em>.</p><p>That’s kind of familiar, isn’t it? As you can see in the comparison table on the right-hand side, the <em>Delta</em> suggests that there have been more items added than removed.</p><p><img src="https://cdn-images-1.medium.com/max/6694/1*bfF0fhPeC1PX8QINgTGzOw.png" alt="Heap Snapshot" loading="lazy"/></p><p>By clicking on an item in the top panel will immediately redirect the panel below to its “retainers”, or the Object Retaining Tree.</p><p>I started digging down the Map destination object until we get to project, which is the function we pass to a map <em>operator</em> and that leads to a line in one of the project’s files, asser-pricer.component.ts.</p><p>Let’s take a look at the context around that line: it is a simple selection from the store that returns me a price and maps it to a String.</p><p>Also, I used shareReplay(1) to multicast the price observable to the get trend value (e.g. if it went up or down since the previous emission).</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">this</span><span class="token punctuation">.</span>price$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pricesFacade
    <span class="token punctuation">.</span><span class="token function">getPriceForAsset</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>asset<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token generic-function"><span class="token function">filter</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">map</span><span class="token punctuation">(</span>price <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">shareReplay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3>Rx Subscriptions 🦊</h3><p>Let’s reflect for a moment about the line we just landed on: the issue is clearly an unsubscribed observable that is retaining the components in the memory.</p><p>It doesn’t matter how many times we’ve been told to clean up our Rx subscriptions: in my experience, this is by far <strong>the most common cause of memory leaks</strong> in Angular applications.</p><p>Many developers will probably be thinking: is an open subscription <strong>really</strong> going to cause havoc in a real-world application?</p><p><strong>Yes, it can</strong>.</p><p>Especially for large applications, if the leak happens within a repeated component (lists, tables, infinite scrolling components, etc.), even only one open subscription can cause your application to retain in memory the components until the subscription gets cleaned up.</p><p>You would expect the components to be cleaned up when destroyed, for example:</p><ul><li><p>when the user navigates to another page</p></li><li><p>when the user replaces/filters the elements with a different selection</p></li></ul><p>While unsubscribing is a fairly simple concept to understand, and unsubscribing itself (especially is using the async pipe) is easy, there are situations when the full knowledge of the operators we’re using is essential, as it happened in my case.</p><h3>ShareReplay, what are you? 🤔</h3><p>Let’s get back to the issue.</p><p>We found out a possible responsible candidate for our memory leak. The first thing I do is to debug shareReplay to understand why the subscription is not being unsubscribed, which lead me to its source code:</p><p><img src="https://cdn-images-1.medium.com/max/2266/1*_fdLmFspJ3wLY7j_feJIjQ.png" alt="ShareReplay’s source code" loading="lazy"/></p><p>The long condition around the unsubscription was pretty suspect — why? It turns out, despite me reading articles and documentation plenty of times about this, I missed a pretty important detail about this operator.</p><p>In fact, if we don’t specify the property refCount: true, the subscription will never be unsubscribed. To fully understand why I refer you to this <a href="https://blog.angularindepth.com/rxjs-whats-changed-with-sharereplay-65c098843e95" target="_blank" rel="noopener noreferrer">Angular In Depth article: What’s Changed with ShareReplay</a>.</p><p>In order to fix this, I made the following change:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">this</span><span class="token punctuation">.</span>price$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pricesFacade<span class="token punctuation">.</span><span class="token function">getPriceForAsset</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>asset<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token generic-function"><span class="token function">filter</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">map</span><span class="token punctuation">(</span>price <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">shareReplay</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        bufferSize<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        refCount<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And now the memory leak from my application is gone!</p><p>But let’s see some other common scenarios — some of which appear even in some extremely popular libraries for Angular.</p><h3>Event Listeners</h3><p>Another common cause of memory leaks is DOM events that are never unregistered. Some folks may think that using Angular’s Renderer may take care of it, but that is only the cause if the events are defined in the template, just as with the async pipe.</p><p>Let’s see a quick and common example of a component that registers a scroll listener on the body, without never unregistering the event:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//...})</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ScrollComponent</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> renderer<span class="token operator">:</span> Renderer2<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token string">&#x27;scroll&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updatePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">updatePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* implementation */</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This does, indeed, create a memory leak every time we instantiate ScrollComponent — so let’s fix it:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ScrollComponent</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> renderer<span class="token operator">:</span> Renderer2<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> listener <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> 
        <span class="token string">&#x27;scroll&#x27;</span><span class="token punctuation">,</span> 
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updatePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>listener <span class="token operator">=&gt;</span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">updatePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* implementation */</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Unregistering all the events prevents the component ScrollComponent to be retained in memory and will be cleaned up once destroyed, along with its children.</p><h3>Websocket Connections</h3><p>Very similarly, WebSocket connections must always be closed when unused. Imagine we have a component PricerComponent that subscribes to a WebSocket and displays incoming cryptocurrency prices.</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    selector<span class="token operator">:</span> <span class="token string">&#x27;pricer&#x27;</span><span class="token punctuation">,</span>
    template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"></span>
<span class="token string">        &lt;span&gt;{{ id | titlecase }}:&lt;/span&gt;</span>
<span class="token string">        &lt;span&gt;{{ ( price$ | async) || &#x27;loading...&#x27; }}&lt;/span&gt;</span>
<span class="token string">    </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PricerComponent</span>  <span class="token punctuation">{</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Input</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> price$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> Endpoint <span class="token operator">=</span> <span class="token string">&#x27;wss://ws.coincap.io/prices/&#x27;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> webSocket<span class="token operator">:</span> WebSocket<span class="token punctuation">;</span>
    
    <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>webSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEndpoint</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>webSocket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>price$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token function">getEndpoint</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> PricerComponent<span class="token punctuation">.</span>Endpoint <span class="token operator">+</span> <span class="token string">&#x27;?assets=&#x27;</span> <span class="token operator">+</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Let’s explain the snippet:</p><ul><li><p>we receive an ID as input and we subscribe to it via WebSocket every time the component is initialized</p></li><li><p>when is the WebSocket connection cleared? Never! Once again, we’re missing the good gold ngOnDestroy hook to take care of it when the component gets destroyed</p></li><li><p>This creates multiple issues: not only we’re creating multiple WebSocket connections, but we’re also retaining PricerComponent in memory every time it gets re-initialized</p></li></ul><p>Let’s take a snapshot and analyze it!</p><p><img src="https://cdn-images-1.medium.com/max/5030/1*NDLA9UIZD3J1KOADfME6mg.png" alt="Heap Snapshot WebSocket example" loading="lazy"/></p><p>As per the image above, I start by comparing the initial load (with 1 pricer) with another snapshot taken after a small session.</p><p>The Delta reveals me where additional memory has been allocated, so I start digging in the (closure) tree searching for clues back to my code.</p><p>After scrolling a little bit, I stumble on this closure, which takes me back exactly to the callback passed to webSocket.onmessage!</p><p><img src="https://cdn-images-1.medium.com/max/4160/1*Sh-HgR0QZBmp8wlXsxQ6YQ.png" loading="lazy"/></p><p>Debugging this case was admittedly pretty easy, but in some cases, it can be pretty daunting. There is a way we can help facilitate the debugging process by <strong>naming functions</strong> so that they will appear in the Memory Snapshot.</p><p>For example, I could have written:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">onPriceReceived</span> <span class="token operator">=</span> <span class="token punctuation">(</span>msg<span class="token operator">:</span> MessageEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>price$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>webSocket<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> onPriceReceived<span class="token punctuation">;</span>
</code></pre></div><p>This bug is easily solved by adding the following method:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>webSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can see the full example at <a href="https://stackblitz.com/edit/angular-hubedk" target="_blank" rel="noopener noreferrer">this Stackblitz link</a>.</p><h2>Takeaways ⭐</h2><ul><li><p>Memory Leaks are quite hard to find and debug — my suggestion is to keep the Performance Monitor open from time to time and see if the memory is stable</p></li><li><p>Angular does a great job at managing memory; with that said, we need to watch out for open subscriptions (Observables, Subjects, NgRx Store Selections), DOM events, WebSocket connections, etc.</p></li><li><p>Learn how to use well the Chrome Dev Tools! It is essential for debugging performance and memory leaks. Even if it is intimidating to see so much low-level terminology, try to read and learn as much as possible about it</p></li><li><p>Name closures! It helps with debuggability and, in my opinion, makes code more readable</p></li></ul><h3>Resources</h3><ul><li><p><a href="https://developers.google.com/web/tools/chrome-devtools/memory-problems" target="_blank" rel="noopener noreferrer">Memory problems</a> (Chrome Dev Tools)</p></li><li><p><a href="https://developers.google.com/web/tools/chrome-devtools/memory-problems/heap-snapshots" target="_blank" rel="noopener noreferrer">Record Heap Snapshot</a></p></li><li><p><a href="https://blog.angularindepth.com/rxjs-whats-changed-with-sharereplay-65c098843e95" target="_blank" rel="noopener noreferrer">What’s Changed with ShareReplay</a></p></li><li><p><a href="https://blog.bitsrc.io/debugging-javascript-like-a-pro-a2e0f6c53c2e" target="_blank" rel="noopener noreferrer">Debugging Javascript Like a Pro</a></p></li></ul></div></article><div class="max-w-2xl mx-auto"></div><div class="w-full md:w-8/12 mx-auto my-4"><script async="" data-uid="3e3126f064" src="https://thoughtful-inventor-7842.ck.page/3e3126f064/index.js"></script></div><div><hr class="border-accent-2 mt-16 mb-14"/><h3 class="text-2xl md:text-3xl text-center font-semibold my-4 md:my-12 flex flex-row space-x-4 items-center justify-center"><span>Learn more about</span> <div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:28px;height:28px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></h3><section><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 md:gap-x-12 lg:gap-x-14 gap-y-20 md:gap-y-24 mb-32"><div class="shadow-lg hover:shadow-xl transition-shadow duration-500"><div class="mb-3"><div class="sm:mx-0"><a aria-label="Benchmarking Angular 12 with Webpack 5" href="/angular/webpack-5-angular12"><img class="block hover:shadow-xl transition-shadow duration-500 h-full lg:h-40 xl:h-48 w-full shadow" src="/assets/images/posts/benchmarking-webpack-5.webp" alt="Cover Image for Benchmarking Angular 12 with Webpack 5" loading="lazy"/></a></div></div><div class="px-4 py-2"><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/webpack-5-angular12">Benchmarking Angular 12 with Webpack 5</a></h3></div><div class="text-xs mb-4 flex flex-row space-x-2 items-center px-4"><div class="text-gray-600"><time dateTime="2021-05-14T00:00:00.322Z">May 14, 2021</time></div><span class="text-gray-600">·</span><span class="text-gray-600">2 min read</span><span class="text-gray-600">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:16px;height:16px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 px-4 text-sm">Angular 12 has been released and with it the much awaited Webpack 5 upgrade. In this post I benchmarked the bundle-size and compilation speed against the previous version</p></div><div class="shadow-lg hover:shadow-xl transition-shadow duration-500"><div class="mb-3"><div class="sm:mx-0"><a aria-label="Principles for creating libraries with Nx and Angular" href="/angular/how-to-organize-nx-modules-with-angular"><img class="block hover:shadow-xl transition-shadow duration-500 h-full lg:h-40 xl:h-48 w-full shadow" src="/assets/images/posts/organize-nx-modules-ngrx.webp" alt="Cover Image for Principles for creating libraries with Nx and Angular" loading="lazy"/></a></div></div><div class="px-4 py-2"><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/how-to-organize-nx-modules-with-angular">Principles for creating libraries with Nx and Angular</a></h3></div><div class="text-xs mb-4 flex flex-row space-x-2 items-center px-4"><div class="text-gray-600"><time dateTime="2021-02-07T00:00:00.322Z">Feb 7, 2021</time></div><span class="text-gray-600">·</span><span class="text-gray-600">5 min read</span><span class="text-gray-600">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:16px;height:16px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 px-4 text-sm">Working with Nx may be confusing. This article explains how I create Nx libraries and the principles behind my motivations</p></div><div class="shadow-lg hover:shadow-xl transition-shadow duration-500"><div class="mb-3"><div class="sm:mx-0"><a aria-label="Where to put your Angular models?" href="/angular/angular-where-to-put-models"><img class="block hover:shadow-xl transition-shadow duration-500 h-full lg:h-40 xl:h-48 w-full shadow" src="/assets/images/posts/where-put-angular-models.webp" alt="Cover Image for Where to put your Angular models?" loading="lazy"/></a></div></div><div class="px-4 py-2"><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/angular-where-to-put-models">Where to put your Angular models?</a></h3></div><div class="text-xs mb-4 flex flex-row space-x-2 items-center px-4"><div class="text-gray-600"><time dateTime="2020-08-03T00:00:00.322Z">Aug 3, 2020</time></div><span class="text-gray-600">·</span><span class="text-gray-600">3 min read</span><span class="text-gray-600">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:16px;height:16px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 px-4 text-sm">Organizing entities and models in your Angular app may be hard. This article explains where to put your entities and what mistakes to watch out for</p></div><div class="shadow-lg hover:shadow-xl transition-shadow duration-500"><div class="mb-3"><div class="sm:mx-0"><a aria-label="Using the Intersection Observer API with Angular" href="/angular/intersection-observer-with-angular"><img class="block hover:shadow-xl transition-shadow duration-500 h-full lg:h-40 xl:h-48 w-full shadow" src="/assets/images/posts/intersection-observer.webp" alt="Cover Image for Using the Intersection Observer API with Angular" loading="lazy"/></a></div></div><div class="px-4 py-2"><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/intersection-observer-with-angular">Using the Intersection Observer API with Angular</a></h3></div><div class="text-xs mb-4 flex flex-row space-x-2 items-center px-4"><div class="text-gray-600"><time dateTime="2020-08-01T00:00:00.322Z">Aug 1, 2020</time></div><span class="text-gray-600">·</span><span class="text-gray-600">5 min read</span><span class="text-gray-600">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:16px;height:16px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 px-4 text-sm">This article shows how to build a directive with Angular that uses the Intersection Observer API to check when an element becomes visible on the page</p></div><div class="shadow-lg hover:shadow-xl transition-shadow duration-500"><div class="mb-3"><div class="sm:mx-0"><a aria-label="Setters vs ngOnChanges: which one is better?" href="/angular/setters-vs-ng-on-changes"><img class="block hover:shadow-xl transition-shadow duration-500 h-full lg:h-40 xl:h-48 w-full shadow" src="/assets/images/posts/setters-vs-on-changes.webp" alt="Cover Image for Setters vs ngOnChanges: which one is better?" loading="lazy"/></a></div></div><div class="px-4 py-2"><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/setters-vs-ng-on-changes">Setters vs ngOnChanges: which one is better?</a></h3></div><div class="text-xs mb-4 flex flex-row space-x-2 items-center px-4"><div class="text-gray-600"><time dateTime="2020-07-30T00:00:00.322Z">Jul 30, 2020</time></div><span class="text-gray-600">·</span><span class="text-gray-600">3 min read</span><span class="text-gray-600">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:16px;height:16px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 px-4 text-sm">Listening to Input changes can be done in different ways. But which one should you use?</p></div><div class="shadow-lg hover:shadow-xl transition-shadow duration-500"><div class="mb-3"><div class="sm:mx-0"><a aria-label="Async Rendering with a single Rx Operator" href="/angular/async-rendering-with-a-single-rx-operator"><img class="block hover:shadow-xl transition-shadow duration-500 h-full lg:h-40 xl:h-48 w-full shadow" src="/assets/images/posts/async-rendering.webp" alt="Cover Image for Async Rendering with a single Rx Operator" loading="lazy"/></a></div></div><div class="px-4 py-2"><h3 class="text-2xl font-bold mb-2 leading-snug"><a class="hover:underline" href="/angular/async-rendering-with-a-single-rx-operator">Async Rendering with a single Rx Operator</a></h3></div><div class="text-xs mb-4 flex flex-row space-x-2 items-center px-4"><div class="text-gray-600"><time dateTime="2020-07-11T00:00:00.322Z">Jul 11, 2020</time></div><span class="text-gray-600">·</span><span class="text-gray-600">3 min read</span><span class="text-gray-600">·</span><div class="text-xs"><div class="text-center flex flex-row space-x-1 items-center cursor-pointer collection--angular" href="/angular"><img class="object-contain" loading="lazy" style="width:16px;height:16px" src="/assets/images/collections/angular.webp" alt="Angular"/><span class="hover:underline">Angular</span></div></div></div><p class="leading-relaxed mb-4 px-4 text-sm">Increase your app rendering performance with this simple Rx operator</p></div></div></section></div></div></main></div><footer><div class="container mx-auto px-5"><hr class="border-accent-2 mt-16 mb-14"/><div class="flex-row flex justify-between items-center my-6 md:my-8"><a class="hover:underline" href="/"><svg width="100" height="60" viewBox="0 0 735 313" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M104.913 105.5C100.913 108.7 96.1133 112.2 90.5133 116C85.1133 119.8 79.4133 123.6 73.4133 127.4C67.6133 131.2 62.0133 134.8 56.6133 138.2C51.2133 141.6 46.6133 144.4 42.8133 146.6C46.6133 148.8 51.2133 151.6 56.6133 155C62.0133 158.4 67.6133 162 73.4133 165.8C79.4133 169.6 85.1133 173.5 90.5133 177.5C96.1133 181.3 100.913 184.7 104.913 187.7C108.313 190.5 111.313 193.2 113.913 195.8C116.713 198.2 118.113 201.1 118.113 204.5C118.113 207.5 117.013 210.3 114.813 212.9C113.413 214.3 112.013 215.4 110.613 216.2C109.213 217 107.613 217.4 105.813 217.4C104.013 217.4 101.813 216.9 99.2133 215.9C96.6133 214.7 93.3133 212.8 89.3133 210.2C76.7133 202.4 65.5133 195.6 55.7133 189.8C45.9133 183.8 37.6133 178.4 30.8133 173.6C24.2133 168.8 19.1133 164.3 15.5133 160.1C12.1133 155.7 10.4133 151.2 10.4133 146.6C10.4133 142 12.1133 137.6 15.5133 133.4C18.9133 129.2 23.9133 124.7 30.5133 119.9C37.3133 114.9 45.6133 109.5 55.4133 103.7C65.2133 97.7 76.5133 90.8 89.3133 83C93.3133 80.4 96.6133 78.6 99.2133 77.6C101.813 76.4 104.013 75.8 105.813 75.8C107.613 75.8 109.213 76.2 110.613 77C112.013 77.8 113.413 78.9 114.813 80.3C117.013 82.9 118.113 85.7 118.113 88.7C118.113 92.1 116.713 95.1 113.913 97.7C111.313 100.1 108.313 102.7 104.913 105.5ZM229.734 44.6C236.334 44.6 243.134 45.2 250.134 46.4C257.134 47.6 263.534 49.4 269.334 51.8C275.134 54 279.934 56.8 283.734 60.2C287.534 63.6 289.434 67.5 289.434 71.9C289.434 76.5 288.234 80 285.834 82.4C283.434 84.8 280.434 86 276.834 86C273.434 86 270.234 85.4 267.234 84.2C264.434 83 261.234 81.7 257.634 80.3C254.034 78.9 249.734 77.6 244.734 76.4C239.734 75.2 233.434 74.6 225.834 74.6C217.434 74.6 209.534 76.6 202.134 80.6C194.934 84.4 188.534 89.8 182.934 96.8C177.334 103.6 172.934 111.7 169.734 121.1C166.534 130.5 164.934 140.7 164.934 151.7C164.934 165.1 166.634 176.7 170.034 186.5C173.434 196.3 177.834 204.4 183.234 210.8C188.834 217.2 195.034 222 201.834 225.2C208.834 228.2 215.834 229.7 222.834 229.7C234.234 229.7 243.234 228.1 249.834 224.9C256.634 221.5 262.034 217.2 266.034 212C266.234 207.8 266.334 202.8 266.334 197C266.334 191.2 266.334 184.9 266.334 178.1C266.334 175.5 266.134 173.5 265.734 172.1C265.334 170.5 264.334 169.3 262.734 168.5C261.134 167.7 258.734 167.2 255.534 167C252.534 166.8 248.434 166.7 243.234 166.7C236.834 166.7 231.634 165.9 227.634 164.3C223.634 162.5 221.634 158.8 221.634 153.2C221.634 149.2 222.634 146 224.634 143.6C226.834 141 231.234 139.5 237.834 139.1C239.034 139.1 240.934 139.1 243.534 139.1C246.334 138.9 249.234 138.8 252.234 138.8C255.434 138.8 258.534 138.8 261.534 138.8C264.534 138.8 266.934 138.8 268.734 138.8C274.734 138.8 279.534 139.4 283.134 140.6C286.734 141.6 289.934 144 292.734 147.8C294.134 149.8 294.934 153.3 295.134 158.3C295.534 163.3 295.734 169.1 295.734 175.7V253.1C295.734 258.5 294.234 262.5 291.234 265.1C288.434 267.7 285.134 269 281.334 269C276.734 269 272.934 267.8 269.934 265.4C267.134 263.2 265.734 259.6 265.734 254.6V242.9C260.534 248.9 254.334 253.2 247.134 255.8C240.134 258.4 231.234 259.7 220.434 259.7C209.434 259.7 198.634 257.5 188.034 253.1C177.434 248.7 168.034 242.2 159.834 233.6C151.634 224.8 144.934 213.9 139.734 200.9C134.734 187.7 132.234 172.4 132.234 155C132.234 137.6 134.734 122.1 139.734 108.5C144.934 94.9 151.934 83.4 160.734 74C169.534 64.4 179.834 57.1 191.634 52.1C203.434 47.1 216.134 44.6 229.734 44.6ZM361.964 60.8C361.964 72.8 361.564 85.4 360.764 98.6C360.164 111.6 359.364 124.3 358.364 136.7C360.964 131.3 364.364 126.7 368.564 122.9C372.764 118.9 377.364 115.7 382.364 113.3C387.564 110.9 392.964 109.1 398.564 107.9C404.164 106.7 409.564 106.1 414.764 106.1C423.764 106.1 432.164 107.8 439.964 111.2C447.964 114.4 454.864 119.2 460.664 125.6C466.664 131.8 471.264 139.6 474.464 149C477.864 158.2 479.564 168.8 479.564 180.8C479.564 192.4 477.864 203 474.464 212.6C471.064 222.2 465.964 230.5 459.164 237.5C452.564 244.3 444.264 249.6 434.264 253.4C424.464 257.2 413.164 259.1 400.364 259.1C382.964 259.1 369.264 255.6 359.264 248.6C349.464 241.6 342.164 232.3 337.364 220.7C332.564 208.9 329.564 195.4 328.364 180.2C327.364 165 326.864 149.1 326.864 132.5C326.864 115.7 327.164 100.5 327.764 86.9C328.364 73.3 329.264 62.3 330.464 53.9C331.664 46.3 333.664 40.9 336.464 37.7C339.264 34.5 342.964 32.9 347.564 32.9C350.964 32.9 353.664 33.7 355.664 35.3C357.664 36.7 359.064 38.7 359.864 41.3C360.864 43.9 361.464 46.9 361.664 50.3C361.864 53.5 361.964 57 361.964 60.8ZM406.364 135.8C400.564 135.8 394.964 136.8 389.564 138.8C384.364 140.6 379.664 143.5 375.464 147.5C371.464 151.5 368.264 156.6 365.864 162.8C363.464 168.8 362.264 176.1 362.264 184.7C362.264 199.9 365.964 211.5 373.364 219.5C380.964 227.3 391.064 231.2 403.664 231.2C408.864 231.2 414.164 230.5 419.564 229.1C424.964 227.5 429.864 224.9 434.264 221.3C438.664 217.5 442.264 212.5 445.064 206.3C447.864 200.1 449.264 192.4 449.264 183.2C449.264 175 448.064 167.9 445.664 161.9C443.464 155.9 440.364 151 436.364 147.2C432.364 143.2 427.764 140.3 422.564 138.5C417.364 136.7 411.964 135.8 406.364 135.8ZM508.61 238.7C511.01 230.7 513.81 221.4 517.01 210.8C520.21 200 523.71 188.4 527.51 176C531.51 163.4 535.71 150.2 540.11 136.4C544.71 122.6 549.31 108.5 553.91 94.1C557.91 81.9 561.41 71.3 564.41 62.3C567.61 53.1 570.51 45.6 573.11 39.8C575.91 34 578.51 29.7 580.91 26.9C583.51 23.9 586.31 22.4 589.31 22.4C592.31 22.4 595.01 23.4 597.41 25.4C600.01 27.4 601.31 30.5 601.31 34.7C601.31 36.1 601.21 37.6 601.01 39.2C600.81 40.8 600.41 42.7 599.81 44.9C590.41 78.1 580.21 111.7 569.21 145.7C558.21 179.5 546.51 213.2 534.11 246.8C531.71 253.2 529.41 257.5 527.21 259.7C525.01 261.9 522.81 263 520.61 263C517.01 263 513.81 262 511.01 260C508.21 258 506.81 254.7 506.81 250.1C506.81 247.3 507.41 243.5 508.61 238.7ZM624.199 105.5C620.799 102.7 617.699 100.1 614.899 97.7C612.299 95.1 610.999 92.1 610.999 88.7C610.999 85.7 612.099 82.9 614.299 80.3C615.699 78.9 617.099 77.8 618.499 77C619.899 76.2 621.499 75.8 623.299 75.8C625.099 75.8 627.299 76.4 629.899 77.6C632.499 78.6 635.799 80.4 639.799 83C652.599 90.8 663.899 97.7 673.699 103.7C683.499 109.5 691.699 114.9 698.299 119.9C705.099 124.7 710.199 129.2 713.599 133.4C716.999 137.6 718.699 142 718.699 146.6C718.699 151.2 716.899 155.7 713.299 160.1C709.899 164.3 704.799 168.8 697.999 173.6C691.399 178.4 683.199 183.8 673.399 189.8C663.599 195.6 652.399 202.4 639.799 210.2C635.799 212.8 632.499 214.7 629.899 215.9C627.299 216.9 625.099 217.4 623.299 217.4C621.499 217.4 619.899 217 618.499 216.2C617.099 215.4 615.699 214.3 614.299 212.9C612.099 210.3 610.999 207.5 610.999 204.5C610.999 201.1 612.299 198.2 614.899 195.8C617.699 193.2 620.799 190.5 624.199 187.7C627.999 184.7 632.699 181.3 638.299 177.5C643.899 173.5 649.599 169.6 655.399 165.8C661.199 162 666.799 158.4 672.199 155C677.799 151.6 682.499 148.8 686.299 146.6C682.499 144.4 677.799 141.6 672.199 138.2C666.799 134.8 661.199 131.2 655.399 127.4C649.599 123.6 643.899 119.8 638.299 116C632.699 112.2 627.999 108.7 624.199 105.5Z" fill="#111827"></path></svg></a><div class="justify-end lg:hidden flex"><button aria-label="Open Menu" class="navbar-burger" type="button"><span class="block relative w-7 rounded-sm bg-black h-1"></span><span class="block relative w-7 rounded-sm bg-black h-1 mt-1"></span><span class="block relative w-7 rounded-sm bg-black h-1 mt-1"></span></button></div><ul class="lg:space-x-8 px-4 hidden flex-col space-y-4 lg:space-y-0 lg:flex lg:flex-row nav"><li class="flex flex-row justify-between pt-4 mb-6 lg:hidden"><div><a class="hover:underline" href="/"><svg width="100" height="60" viewBox="0 0 735 313" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M104.913 105.5C100.913 108.7 96.1133 112.2 90.5133 116C85.1133 119.8 79.4133 123.6 73.4133 127.4C67.6133 131.2 62.0133 134.8 56.6133 138.2C51.2133 141.6 46.6133 144.4 42.8133 146.6C46.6133 148.8 51.2133 151.6 56.6133 155C62.0133 158.4 67.6133 162 73.4133 165.8C79.4133 169.6 85.1133 173.5 90.5133 177.5C96.1133 181.3 100.913 184.7 104.913 187.7C108.313 190.5 111.313 193.2 113.913 195.8C116.713 198.2 118.113 201.1 118.113 204.5C118.113 207.5 117.013 210.3 114.813 212.9C113.413 214.3 112.013 215.4 110.613 216.2C109.213 217 107.613 217.4 105.813 217.4C104.013 217.4 101.813 216.9 99.2133 215.9C96.6133 214.7 93.3133 212.8 89.3133 210.2C76.7133 202.4 65.5133 195.6 55.7133 189.8C45.9133 183.8 37.6133 178.4 30.8133 173.6C24.2133 168.8 19.1133 164.3 15.5133 160.1C12.1133 155.7 10.4133 151.2 10.4133 146.6C10.4133 142 12.1133 137.6 15.5133 133.4C18.9133 129.2 23.9133 124.7 30.5133 119.9C37.3133 114.9 45.6133 109.5 55.4133 103.7C65.2133 97.7 76.5133 90.8 89.3133 83C93.3133 80.4 96.6133 78.6 99.2133 77.6C101.813 76.4 104.013 75.8 105.813 75.8C107.613 75.8 109.213 76.2 110.613 77C112.013 77.8 113.413 78.9 114.813 80.3C117.013 82.9 118.113 85.7 118.113 88.7C118.113 92.1 116.713 95.1 113.913 97.7C111.313 100.1 108.313 102.7 104.913 105.5ZM229.734 44.6C236.334 44.6 243.134 45.2 250.134 46.4C257.134 47.6 263.534 49.4 269.334 51.8C275.134 54 279.934 56.8 283.734 60.2C287.534 63.6 289.434 67.5 289.434 71.9C289.434 76.5 288.234 80 285.834 82.4C283.434 84.8 280.434 86 276.834 86C273.434 86 270.234 85.4 267.234 84.2C264.434 83 261.234 81.7 257.634 80.3C254.034 78.9 249.734 77.6 244.734 76.4C239.734 75.2 233.434 74.6 225.834 74.6C217.434 74.6 209.534 76.6 202.134 80.6C194.934 84.4 188.534 89.8 182.934 96.8C177.334 103.6 172.934 111.7 169.734 121.1C166.534 130.5 164.934 140.7 164.934 151.7C164.934 165.1 166.634 176.7 170.034 186.5C173.434 196.3 177.834 204.4 183.234 210.8C188.834 217.2 195.034 222 201.834 225.2C208.834 228.2 215.834 229.7 222.834 229.7C234.234 229.7 243.234 228.1 249.834 224.9C256.634 221.5 262.034 217.2 266.034 212C266.234 207.8 266.334 202.8 266.334 197C266.334 191.2 266.334 184.9 266.334 178.1C266.334 175.5 266.134 173.5 265.734 172.1C265.334 170.5 264.334 169.3 262.734 168.5C261.134 167.7 258.734 167.2 255.534 167C252.534 166.8 248.434 166.7 243.234 166.7C236.834 166.7 231.634 165.9 227.634 164.3C223.634 162.5 221.634 158.8 221.634 153.2C221.634 149.2 222.634 146 224.634 143.6C226.834 141 231.234 139.5 237.834 139.1C239.034 139.1 240.934 139.1 243.534 139.1C246.334 138.9 249.234 138.8 252.234 138.8C255.434 138.8 258.534 138.8 261.534 138.8C264.534 138.8 266.934 138.8 268.734 138.8C274.734 138.8 279.534 139.4 283.134 140.6C286.734 141.6 289.934 144 292.734 147.8C294.134 149.8 294.934 153.3 295.134 158.3C295.534 163.3 295.734 169.1 295.734 175.7V253.1C295.734 258.5 294.234 262.5 291.234 265.1C288.434 267.7 285.134 269 281.334 269C276.734 269 272.934 267.8 269.934 265.4C267.134 263.2 265.734 259.6 265.734 254.6V242.9C260.534 248.9 254.334 253.2 247.134 255.8C240.134 258.4 231.234 259.7 220.434 259.7C209.434 259.7 198.634 257.5 188.034 253.1C177.434 248.7 168.034 242.2 159.834 233.6C151.634 224.8 144.934 213.9 139.734 200.9C134.734 187.7 132.234 172.4 132.234 155C132.234 137.6 134.734 122.1 139.734 108.5C144.934 94.9 151.934 83.4 160.734 74C169.534 64.4 179.834 57.1 191.634 52.1C203.434 47.1 216.134 44.6 229.734 44.6ZM361.964 60.8C361.964 72.8 361.564 85.4 360.764 98.6C360.164 111.6 359.364 124.3 358.364 136.7C360.964 131.3 364.364 126.7 368.564 122.9C372.764 118.9 377.364 115.7 382.364 113.3C387.564 110.9 392.964 109.1 398.564 107.9C404.164 106.7 409.564 106.1 414.764 106.1C423.764 106.1 432.164 107.8 439.964 111.2C447.964 114.4 454.864 119.2 460.664 125.6C466.664 131.8 471.264 139.6 474.464 149C477.864 158.2 479.564 168.8 479.564 180.8C479.564 192.4 477.864 203 474.464 212.6C471.064 222.2 465.964 230.5 459.164 237.5C452.564 244.3 444.264 249.6 434.264 253.4C424.464 257.2 413.164 259.1 400.364 259.1C382.964 259.1 369.264 255.6 359.264 248.6C349.464 241.6 342.164 232.3 337.364 220.7C332.564 208.9 329.564 195.4 328.364 180.2C327.364 165 326.864 149.1 326.864 132.5C326.864 115.7 327.164 100.5 327.764 86.9C328.364 73.3 329.264 62.3 330.464 53.9C331.664 46.3 333.664 40.9 336.464 37.7C339.264 34.5 342.964 32.9 347.564 32.9C350.964 32.9 353.664 33.7 355.664 35.3C357.664 36.7 359.064 38.7 359.864 41.3C360.864 43.9 361.464 46.9 361.664 50.3C361.864 53.5 361.964 57 361.964 60.8ZM406.364 135.8C400.564 135.8 394.964 136.8 389.564 138.8C384.364 140.6 379.664 143.5 375.464 147.5C371.464 151.5 368.264 156.6 365.864 162.8C363.464 168.8 362.264 176.1 362.264 184.7C362.264 199.9 365.964 211.5 373.364 219.5C380.964 227.3 391.064 231.2 403.664 231.2C408.864 231.2 414.164 230.5 419.564 229.1C424.964 227.5 429.864 224.9 434.264 221.3C438.664 217.5 442.264 212.5 445.064 206.3C447.864 200.1 449.264 192.4 449.264 183.2C449.264 175 448.064 167.9 445.664 161.9C443.464 155.9 440.364 151 436.364 147.2C432.364 143.2 427.764 140.3 422.564 138.5C417.364 136.7 411.964 135.8 406.364 135.8ZM508.61 238.7C511.01 230.7 513.81 221.4 517.01 210.8C520.21 200 523.71 188.4 527.51 176C531.51 163.4 535.71 150.2 540.11 136.4C544.71 122.6 549.31 108.5 553.91 94.1C557.91 81.9 561.41 71.3 564.41 62.3C567.61 53.1 570.51 45.6 573.11 39.8C575.91 34 578.51 29.7 580.91 26.9C583.51 23.9 586.31 22.4 589.31 22.4C592.31 22.4 595.01 23.4 597.41 25.4C600.01 27.4 601.31 30.5 601.31 34.7C601.31 36.1 601.21 37.6 601.01 39.2C600.81 40.8 600.41 42.7 599.81 44.9C590.41 78.1 580.21 111.7 569.21 145.7C558.21 179.5 546.51 213.2 534.11 246.8C531.71 253.2 529.41 257.5 527.21 259.7C525.01 261.9 522.81 263 520.61 263C517.01 263 513.81 262 511.01 260C508.21 258 506.81 254.7 506.81 250.1C506.81 247.3 507.41 243.5 508.61 238.7ZM624.199 105.5C620.799 102.7 617.699 100.1 614.899 97.7C612.299 95.1 610.999 92.1 610.999 88.7C610.999 85.7 612.099 82.9 614.299 80.3C615.699 78.9 617.099 77.8 618.499 77C619.899 76.2 621.499 75.8 623.299 75.8C625.099 75.8 627.299 76.4 629.899 77.6C632.499 78.6 635.799 80.4 639.799 83C652.599 90.8 663.899 97.7 673.699 103.7C683.499 109.5 691.699 114.9 698.299 119.9C705.099 124.7 710.199 129.2 713.599 133.4C716.999 137.6 718.699 142 718.699 146.6C718.699 151.2 716.899 155.7 713.299 160.1C709.899 164.3 704.799 168.8 697.999 173.6C691.399 178.4 683.199 183.8 673.399 189.8C663.599 195.6 652.399 202.4 639.799 210.2C635.799 212.8 632.499 214.7 629.899 215.9C627.299 216.9 625.099 217.4 623.299 217.4C621.499 217.4 619.899 217 618.499 216.2C617.099 215.4 615.699 214.3 614.299 212.9C612.099 210.3 610.999 207.5 610.999 204.5C610.999 201.1 612.299 198.2 614.899 195.8C617.699 193.2 620.799 190.5 624.199 187.7C627.999 184.7 632.699 181.3 638.299 177.5C643.899 173.5 649.599 169.6 655.399 165.8C661.199 162 666.799 158.4 672.199 155C677.799 151.6 682.499 148.8 686.299 146.6C682.499 144.4 677.799 141.6 672.199 138.2C666.799 134.8 661.199 131.2 655.399 127.4C649.599 123.6 643.899 119.8 638.299 116C632.699 112.2 627.999 108.7 624.199 105.5Z" fill="#111827"></path></svg></a></div><div class="flex justify-end"><span class="bg-gray-100 font-bold text-sm rounded-full shadow-xl flex items-center justify-center w-16 h-16">Close</span></div></li><li class="active:text-black text-lg lg:text-base text-gray-800 hover:text-gray-900 font-medium hover:underline"><a class="block" href="/blog">Blog</a></li><li class="active:text-black text-lg lg:text-base text-gray-800 hover:text-gray-900 font-medium hover:underline"><a class="block" href="/articles">Articles</a></li><li class="active:text-black text-lg lg:text-base text-gray-800 hover:text-gray-900 font-medium hover:underline"><a class="block" href="/consulting">Consulting</a></li><li class="active:text-black text-lg lg:text-base text-gray-800 hover:text-gray-900 font-medium hover:underline"><a class="block" href="/about">About</a></li><li class="active:text-black text-lg lg:text-base text-gray-800 hover:text-gray-900 font-medium hover:underline"><a class="block" href="/contact">Contact me</a></li></ul></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"live":true,"readingTime":"10 min read","title":"Debugging Memory Leaks in Angular","date":"2019-10-29T00:00:00.000Z","slug":"debugging-memory-leaks-in-angular","coverImage":"https://cdn-images-1.medium.com/max/10624/0*Vu4ib4QAqreImyMW","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"The situations where memory leaks are most likely to happen, and how you can deal with them using Chrome DevTools","content":"\nThis post was originally published, by myself, on the [Bit](https://blog.bitsrc.io) blog\n\n## Introduction to Memory Leaks\n\nBuilding large applications entails writing lots of code, complex pages, long lists, and hundreds (if not more) of components. If you’ve worked at least once in a non-trivial web application, you may have found yourself battling a memory leak for hours and hours.\n\nIn this article, I want to introduce you to a number of situations where memory leaks are most likely to happen, and how you can deal with them thanks to the powerful *Chrome DevTools*.\n\n**Preface**: Angular is a framework that does a really great job at memory management: in fact, you almost never have to do something specific to avoid memory leaks! \nNonetheless, I’ve found myself in a number of scenarios that led to mistakes resulting in memory leaks and, as a consequence, a crippled user-experience for my company’s clients.\n\nNot good.\n\n### What’s a Memory Leak?\n\nIn layman’s terms, a memory leak occurs when an application fails to get rid of unused resources.\n\nIf the memory of an application is using more and more memory without being populated with new resources (images, text, objects, etc.), then the application is likely affected by this sort of performance degradation.\n\n**Tip: **Use [**Bit](https://bit.dev/)** ([Github](https://github.com/teambit/bit)) to easily share and reuse Angular components across your projects, suggest updates, sync changes and build faster as a team.\n\nDon’t waste time rewriting mediocre code — build awesome reusable Angular components, test them in isolation using [Bit](https://bit.dev) and share them on [bit.dev](https://bit.dev).\n\n![Components with Bit: Easily share across projects as a team](https://cdn-images-1.medium.com/max/2000/1*ODhvAjHjB8zPErBYhOFePQ.gif)\n\n### Why Memory Leaks are tricky\n\nThe trickiest aspect of memory leaks is that they are pretty hard bugs to spot. Unlike CPU usage issues, where you can see the UI lagging, memory leaks (especially for smaller apps) are **much a more subtle sort of problem**.\n\nIf not also in charge of QA, the way most developers work is to focus on the context of their task, and very rarely they have to switch page dozens of times, create and re-create large lists, or in general perform long-lived actions that are naturally where memory leaks become apparent.\n\nIn fact, your applications may have dozens of memory leaks who have not yet been discovered!\n\nNowadays, users reload pages less and less often. As someone who works in the financial sector, I should know: traders hate reloading! The computers in offices are rarely restarted and so are browser pages.\n\nThis is why **keeping performance optimal for long-lived sessions is essential**: if an application is leaking memory, the user will at some point realize that it is slower, sluggish, and will likely pause very frequently.\n\nAnd we don’t want our users to get frustrated. Right!?\n\n## Debugging Process\n\nIn this section, we will explore some real-world scenarios in Angular applications where it’s most likely to encounter potential mistakes that lead to memory leaks.\n\nThe irony about this article is that I planned on purposefully add mistakes in my code (using my guinea pig project [Cryptofolio](https://github.com/Gbuomprisco/cryptofolio)) to produce a memory leak.\n\n![Cryptofolio shows live crypto prices](https://cdn-images-1.medium.com/max/6712/1*dvMLBySign-rcQHfjl22nA.gif)\n\nAs it turns out, it wasn’t needed! A leak was already there. All I did in order to reproduce it was to initialize the app with 101 pricers — back and forth a couple of times between pages, et voilá — the memory went nuts!\n\n**Notice**: the application I am using is very small, and as a result, the mistakes won’t cause the app to crash, and more importantly, the objects retained in memory won’t be immediately easy to find in the Heap Snapshots.\n\n### Monitoring Memory with the Performance Monitor tool\n\nThe application I built allows me to display prices in two separates views: list and dashboard; these two are two different pages, so the components contained in each of them are supposed to be destroyed and collected when you navigate to another page.\n\nThe first thing to do is to open the Chrome Dev Tools, open the panel on the right and click on *More Tools* \u003e *Performance Monitor. *The memory of our application is displayed in the blue graph.\n\nAs you can see in the image below, whenever I switch page, the memory jumps up almost 20mb!\n\n![Js heap size increasing when switching page](https://cdn-images-1.medium.com/max/2564/1*5AqFfFGibplrZT3H3FDTIw.gif)\n\nI keep switching back and forth, and this is the result below:\n\n![Performance Monitor](https://cdn-images-1.medium.com/max/6694/1*EqGwTm1ieNl0nik6YvzpLw.png)\n\n🔥154MB and 99% CPU? Clearly, something’s wrong🔥\n\n### Starting the debugging process: Memory Snapshots\n\nThe first thing I do when debugging is to record memory snapshots in two stages:\n\n* at initial load, as soon as the app becomes stable and all the elements have been loaded\n\n* a second time once the initial data is replaced by other data. It’s quite important to make sure your app is not actually adding additional resources, unless of course if that is a bug. For example, you could be switching page or forcing some elements to show/hide\n\nThe above will allow me to compare them with the Dev Tools’ Memory Snapshots.\n\n**Tip**: Make sure you also tick “Event Listeners”: it will help understand if the number of event listeners is piling up.\n\nIn order to take a Memory Snapshot, open the Dev Tools-\u003eMemory, select “Heap Snapshot” and then click on the button “Take Snapshot”. The profiles are listed on the left-hand side and you can compare them with each other to visualize which objects have been retained in memory.\n\n### Exploring the Snapshot 🧭\n\nAs you can see in the image below, I proceeded by taking 2 heap snapshots, listed on the left.\n\nWhen the initial snapshot is taken, the tools will show you the summary of the current snapshot, but you can compare two snapshots by choosing “Comparison” from the dropdown above the objects.\n\nThe list displayed by the snapshot can look pretty alien, low-level and unfamiliar if you have been a Web Developer all your life like me, but don’t let that scare you off. The most important thing is to be patient and understand the clues that will lead you to the memory leak.\n\nAs soon as I took the snapshot, I started scrolling through the items looking for clues and familiar pieces of code, and one item immediately caught my attention: *MapSubscriber*.\n\nThat’s kind of familiar, isn’t it? As you can see in the comparison table on the right-hand side, the *Delta* suggests that there have been more items added than removed.\n\n![Heap Snapshot](https://cdn-images-1.medium.com/max/6694/1*bfF0fhPeC1PX8QINgTGzOw.png)\n\nBy clicking on an item in the top panel will immediately redirect the panel below to its “retainers”, or the Object Retaining Tree.\n\nI started digging down the Map destination object until we get to project, which is the function we pass to a map *operator* and that leads to a line in one of the project’s files, asser-pricer.component.ts.\n\nLet’s take a look at the context around that line: it is a simple selection from the store that returns me a price and maps it to a String.\n\nAlso, I used shareReplay(1) to multicast the price observable to the get trend value (e.g. if it went up or down since the previous emission).\n\n```typescript\nthis.price$ = this.pricesFacade\n    .getPriceForAsset(this.asset)\n    .pipe(\n    filter\u003cstring\u003e(Boolean),\n    map(price =\u003e {\n        return parseFloat(price).toFixed(2);\n    }),\n    shareReplay(1)\n    );\n```\n\n### Rx Subscriptions 🦊\n\nLet’s reflect for a moment about the line we just landed on: the issue is clearly an unsubscribed observable that is retaining the components in the memory.\n\nIt doesn’t matter how many times we’ve been told to clean up our Rx subscriptions: in my experience, this is by far **the most common cause of memory leaks** in Angular applications.\n\nMany developers will probably be thinking: is an open subscription **really** going to cause havoc in a real-world application?\n\n**Yes, it can**.\n\nEspecially for large applications, if the leak happens within a repeated component (lists, tables, infinite scrolling components, etc.), even only one open subscription can cause your application to retain in memory the components until the subscription gets cleaned up.\n\nYou would expect the components to be cleaned up when destroyed, for example:\n\n* when the user navigates to another page\n\n* when the user replaces/filters the elements with a different selection\n\nWhile unsubscribing is a fairly simple concept to understand, and unsubscribing itself (especially is using the async pipe) is easy, there are situations when the full knowledge of the operators we’re using is essential, as it happened in my case.\n\n### ShareReplay, what are you? 🤔\n\nLet’s get back to the issue.\n\nWe found out a possible responsible candidate for our memory leak. The first thing I do is to debug shareReplay to understand why the subscription is not being unsubscribed, which lead me to its source code:\n\n![ShareReplay’s source code](https://cdn-images-1.medium.com/max/2266/1*_fdLmFspJ3wLY7j_feJIjQ.png)\n\nThe long condition around the unsubscription was pretty suspect — why? It turns out, despite me reading articles and documentation plenty of times about this, I missed a pretty important detail about this operator.\n\nIn fact, if we don’t specify the property refCount: true, the subscription will never be unsubscribed. To fully understand why I refer you to this [Angular In Depth article: What’s Changed with ShareReplay](https://blog.angularindepth.com/rxjs-whats-changed-with-sharereplay-65c098843e95).\n\nIn order to fix this, I made the following change:\n\n```typescript\nthis.price$ = this.pricesFacade.getPriceForAsset(this.asset).pipe(\n    filter\u003cstring\u003e(Boolean),\n    map(price =\u003e {\n        return parseFloat(price).toFixed(2);\n    }),\n    shareReplay({\n        bufferSize: 1,\n        refCount: true\n    })\n);\n```\nAnd now the memory leak from my application is gone!\n\nBut let’s see some other common scenarios — some of which appear even in some extremely popular libraries for Angular.\n\n### Event Listeners\n\nAnother common cause of memory leaks is DOM events that are never unregistered. Some folks may think that using Angular’s Renderer may take care of it, but that is only the cause if the events are defined in the template, just as with the async pipe.\n\nLet’s see a quick and common example of a component that registers a scroll listener on the body, without never unregistering the event:\n\n```typescript\n@Component({//...})\nexport class ScrollComponent {\n    constructor(private renderer: Renderer2) {}\n\n    ngOnInit() {\n    this.renderer.listen(document.body, 'scroll', () =\u003e {\n        this.updatePosition();\n    });\n    }\n\n    updatePosition() { /* implementation */ }\n}\n```\n\nThis does, indeed, create a memory leak every time we instantiate ScrollComponent — so let’s fix it:\n\n```typescript\n@Component({...})\nexport class ScrollComponent {\n    private listeners = [];\n\n    constructor(private renderer: Renderer2) {}\n\n    ngOnInit() {\n        const listener = this.renderer.listen(\n        document.body, \n        'scroll', \n        () =\u003e {\n            this.updatePosition();\n        });\n\n        this.listeners.push(listener);\n    }\n\n    ngOnDestroy() {\n        this.listeners.forEach(listener =\u003e listener());\n    }\n\n    updatePosition() { /* implementation */ }\n}\n```\n\nUnregistering all the events prevents the component ScrollComponent to be retained in memory and will be cleaned up once destroyed, along with its children.\n\n### Websocket Connections\n\nVery similarly, WebSocket connections must always be closed when unused. Imagine we have a component PricerComponent that subscribes to a WebSocket and displays incoming cryptocurrency prices.\n\n```typescript\n@Component({\n    selector: 'pricer',\n    template: `\n        \u003cspan\u003e{{ id | titlecase }}:\u003c/span\u003e\n        \u003cspan\u003e{{ ( price$ | async) || 'loading...' }}\u003c/span\u003e\n    `\n})\nexport class PricerComponent  {\n    @Input() id: string;\n\n    public price$ = new Subject();\n    private static Endpoint = 'wss://ws.coincap.io/prices/';\n    private webSocket: WebSocket;\n    \n    ngOnInit() {\n        this.webSocket = new WebSocket(\n            this.getEndpoint(this.id)\n        );\n\n        this.webSocket.onmessage = (msg) =\u003e {\n            const data = JSON.parse(msg.data);\n            this.price$.next(data[this.id]);\n        };\n    }\n\n    private getEndpoint(id: string) {\n        return PricerComponent.Endpoint + '?assets=' + id;\n    }\n}\n```\n\nLet’s explain the snippet:\n\n* we receive an ID as input and we subscribe to it via WebSocket every time the component is initialized\n\n* when is the WebSocket connection cleared? Never! Once again, we’re missing the good gold ngOnDestroy hook to take care of it when the component gets destroyed\n\n* This creates multiple issues: not only we’re creating multiple WebSocket connections, but we’re also retaining PricerComponent in memory every time it gets re-initialized\n\nLet’s take a snapshot and analyze it!\n\n![Heap Snapshot WebSocket example](https://cdn-images-1.medium.com/max/5030/1*NDLA9UIZD3J1KOADfME6mg.png)\n\nAs per the image above, I start by comparing the initial load (with 1 pricer) with another snapshot taken after a small session.\n\nThe Delta reveals me where additional memory has been allocated, so I start digging in the (closure) tree searching for clues back to my code.\n\nAfter scrolling a little bit, I stumble on this closure, which takes me back exactly to the callback passed to webSocket.onmessage!\n\n![](https://cdn-images-1.medium.com/max/4160/1*Sh-HgR0QZBmp8wlXsxQ6YQ.png)\n\nDebugging this case was admittedly pretty easy, but in some cases, it can be pretty daunting. There is a way we can help facilitate the debugging process by **naming functions** so that they will appear in the Memory Snapshot.\n\nFor example, I could have written:\n\n```typescript\nconst onPriceReceived = (msg: MessageEvent) =\u003e {\n    const data = JSON.parse(msg.data);\n    this.price$.next(data[id]);\n};\n\nthis.webSocket.onmessage = onPriceReceived;\n```\n\nThis bug is easily solved by adding the following method:\n\n```typescript\nngOnDestroy() {\n    this.webSocket.close();\n}\n```\n\nYou can see the full example at [this Stackblitz link](https://stackblitz.com/edit/angular-hubedk).\n\n## Takeaways ⭐\n\n* Memory Leaks are quite hard to find and debug — my suggestion is to keep the Performance Monitor open from time to time and see if the memory is stable\n\n* Angular does a great job at managing memory; with that said, we need to watch out for open subscriptions (Observables, Subjects, NgRx Store Selections), DOM events, WebSocket connections, etc.\n\n* Learn how to use well the Chrome Dev Tools! It is essential for debugging performance and memory leaks. Even if it is intimidating to see so much low-level terminology, try to read and learn as much as possible about it\n\n* Name closures! It helps with debuggability and, in my opinion, makes code more readable\n\n### Resources\n\n* [Memory problems](https://developers.google.com/web/tools/chrome-devtools/memory-problems) (Chrome Dev Tools)\n\n* [Record Heap Snapshot](https://developers.google.com/web/tools/chrome-devtools/memory-problems/heap-snapshots)\n\n* [What’s Changed with ShareReplay](https://blog.angularindepth.com/rxjs-whats-changed-with-sharereplay-65c098843e95)\n\n* [Debugging Javascript Like a Pro](https://blog.bitsrc.io/debugging-javascript-like-a-pro-a2e0f6c53c2e)","canonical":"https://blog.bitsrc.io/debugging-memory-leaks-in-angular-4bc7b3eab569","tags":["angular","performance"]},"content":{"compiledSource":"var l=Object.defineProperty,N=Object.defineProperties;var u=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable;var r=(a,n,t)=\u003en in a?l(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,e=(a,n)=\u003e{for(var t in n||(n={}))o.call(n,t)\u0026\u0026r(a,t,n[t]);if(p)for(var t of p(n))c.call(n,t)\u0026\u0026r(a,t,n[t]);return a},m=(a,n)=\u003eN(a,u(n));var i=(a,n)=\u003e{var t={};for(var s in a)o.call(a,s)\u0026\u0026n.indexOf(s)\u003c0\u0026\u0026(t[s]=a[s]);if(a!=null\u0026\u0026p)for(var s of p(a))n.indexOf(s)\u003c0\u0026\u0026c.call(a,s)\u0026\u0026(t[s]=a[s]);return t};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(t){var s=t,{components:a}=s,n=i(s,[\"components\"]);return mdx(MDXLayout,m(e(e({},layoutProps),n),{components:a,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"This post was originally published, by myself, on the \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://blog.bitsrc.io\"}),\"Bit\"),\" blog\"),mdx(\"h2\",null,\"Introduction to Memory Leaks\"),mdx(\"p\",null,\"Building large applications entails writing lots of code, complex pages, long lists, and hundreds (if not more) of components. If you\\u2019ve worked at least once in a non-trivial web application, you may have found yourself battling a memory leak for hours and hours.\"),mdx(\"p\",null,\"In this article, I want to introduce you to a number of situations where memory leaks are most likely to happen, and how you can deal with them thanks to the powerful \",mdx(\"em\",{parentName:\"p\"},\"Chrome DevTools\"),\".\"),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Preface\"),`: Angular is a framework that does a really great job at memory management: in fact, you almost never have to do something specific to avoid memory leaks!\nNonetheless, I\\u2019ve found myself in a number of scenarios that led to mistakes resulting in memory leaks and, as a consequence, a crippled user-experience for my company\\u2019s clients.`),mdx(\"p\",null,\"Not good.\"),mdx(\"h3\",null,\"What\\u2019s a Memory Leak?\"),mdx(\"p\",null,\"In layman\\u2019s terms, a memory leak occurs when an application fails to get rid of unused resources.\"),mdx(\"p\",null,\"If the memory of an application is using more and more memory without being populated with new resources (images, text, objects, etc.), then the application is likely affected by this sort of performance degradation.\"),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Tip: \"),\"Use \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://bit.dev/\"}),\"**Bit\"),\"** (\",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/teambit/bit\"}),\"Github\"),\") to easily share and reuse Angular components across your projects, suggest updates, sync changes and build faster as a team.\"),mdx(\"p\",null,\"Don\\u2019t waste time rewriting mediocre code \\u2014 build awesome reusable Angular components, test them in isolation using \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://bit.dev\"}),\"Bit\"),\" and share them on \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://bit.dev\"}),\"bit.dev\"),\".\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/2000/1*ODhvAjHjB8zPErBYhOFePQ.gif\",alt:\"Components with Bit: Easily share across projects as a team\"}))),mdx(\"h3\",null,\"Why Memory Leaks are tricky\"),mdx(\"p\",null,\"The trickiest aspect of memory leaks is that they are pretty hard bugs to spot. Unlike CPU usage issues, where you can see the UI lagging, memory leaks (especially for smaller apps) are \",mdx(\"strong\",{parentName:\"p\"},\"much a more subtle sort of problem\"),\".\"),mdx(\"p\",null,\"If not also in charge of QA, the way most developers work is to focus on the context of their task, and very rarely they have to switch page dozens of times, create and re-create large lists, or in general perform long-lived actions that are naturally where memory leaks become apparent.\"),mdx(\"p\",null,\"In fact, your applications may have dozens of memory leaks who have not yet been discovered!\"),mdx(\"p\",null,\"Nowadays, users reload pages less and less often. As someone who works in the financial sector, I should know: traders hate reloading! The computers in offices are rarely restarted and so are browser pages.\"),mdx(\"p\",null,\"This is why \",mdx(\"strong\",{parentName:\"p\"},\"keeping performance optimal for long-lived sessions is essential\"),\": if an application is leaking memory, the user will at some point realize that it is slower, sluggish, and will likely pause very frequently.\"),mdx(\"p\",null,\"And we don\\u2019t want our users to get frustrated. Right!?\"),mdx(\"h2\",null,\"Debugging Process\"),mdx(\"p\",null,\"In this section, we will explore some real-world scenarios in Angular applications where it\\u2019s most likely to encounter potential mistakes that lead to memory leaks.\"),mdx(\"p\",null,\"The irony about this article is that I planned on purposefully add mistakes in my code (using my guinea pig project \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/Gbuomprisco/cryptofolio\"}),\"Cryptofolio\"),\") to produce a memory leak.\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/6712/1*dvMLBySign-rcQHfjl22nA.gif\",alt:\"Cryptofolio shows live crypto prices\"}))),mdx(\"p\",null,\"As it turns out, it wasn\\u2019t needed! A leak was already there. All I did in order to reproduce it was to initialize the app with 101 pricers \\u2014 back and forth a couple of times between pages, et voil\\xE1 \\u2014 the memory went nuts!\"),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Notice\"),\": the application I am using is very small, and as a result, the mistakes won\\u2019t cause the app to crash, and more importantly, the objects retained in memory won\\u2019t be immediately easy to find in the Heap Snapshots.\"),mdx(\"h3\",null,\"Monitoring Memory with the Performance Monitor tool\"),mdx(\"p\",null,\"The application I built allows me to display prices in two separates views: list and dashboard; these two are two different pages, so the components contained in each of them are supposed to be destroyed and collected when you navigate to another page.\"),mdx(\"p\",null,\"The first thing to do is to open the Chrome Dev Tools, open the panel on the right and click on \",mdx(\"em\",{parentName:\"p\"},\"More Tools\"),\" \u003e \",mdx(\"em\",{parentName:\"p\"},\"Performance Monitor. \"),\"The memory of our application is displayed in the blue graph.\"),mdx(\"p\",null,\"As you can see in the image below, whenever I switch page, the memory jumps up almost 20mb!\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/2564/1*5AqFfFGibplrZT3H3FDTIw.gif\",alt:\"Js heap size increasing when switching page\"}))),mdx(\"p\",null,\"I keep switching back and forth, and this is the result below:\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/6694/1*EqGwTm1ieNl0nik6YvzpLw.png\",alt:\"Performance Monitor\"}))),mdx(\"p\",null,\"\\u{1F525}154MB and 99% CPU? Clearly, something\\u2019s wrong\\u{1F525}\"),mdx(\"h3\",null,\"Starting the debugging process: Memory Snapshots\"),mdx(\"p\",null,\"The first thing I do when debugging is to record memory snapshots in two stages:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"at initial load, as soon as the app becomes stable and all the elements have been loaded\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"a second time once the initial data is replaced by other data. It\\u2019s quite important to make sure your app is not actually adding additional resources, unless of course if that is a bug. For example, you could be switching page or forcing some elements to show/hide\"))),mdx(\"p\",null,\"The above will allow me to compare them with the Dev Tools\\u2019 Memory Snapshots.\"),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Tip\"),\": Make sure you also tick \\u201CEvent Listeners\\u201D: it will help understand if the number of event listeners is piling up.\"),mdx(\"p\",null,\"In order to take a Memory Snapshot, open the Dev Tools-\u003eMemory, select \\u201CHeap Snapshot\\u201D and then click on the button \\u201CTake Snapshot\\u201D. The profiles are listed on the left-hand side and you can compare them with each other to visualize which objects have been retained in memory.\"),mdx(\"h3\",null,\"Exploring the Snapshot \\u{1F9ED}\"),mdx(\"p\",null,\"As you can see in the image below, I proceeded by taking 2 heap snapshots, listed on the left.\"),mdx(\"p\",null,\"When the initial snapshot is taken, the tools will show you the summary of the current snapshot, but you can compare two snapshots by choosing \\u201CComparison\\u201D from the dropdown above the objects.\"),mdx(\"p\",null,\"The list displayed by the snapshot can look pretty alien, low-level and unfamiliar if you have been a Web Developer all your life like me, but don\\u2019t let that scare you off. The most important thing is to be patient and understand the clues that will lead you to the memory leak.\"),mdx(\"p\",null,\"As\\xA0soon\\xA0as I\\xA0took\\xA0the\\xA0snapshot, I started scrolling through the items\\xA0looking\\xA0for\\xA0clues\\xA0and\\xA0familiar\\xA0pieces\\xA0of\\xA0code, and one item immediately caught my attention: \",mdx(\"em\",{parentName:\"p\"},\"MapSubscriber\"),\".\"),mdx(\"p\",null,\"That\\u2019s kind of familiar, isn\\u2019t it? As you can see in the comparison table on the right-hand side, the \",mdx(\"em\",{parentName:\"p\"},\"Delta\"),\" suggests that there have been more items added than removed.\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/6694/1*bfF0fhPeC1PX8QINgTGzOw.png\",alt:\"Heap Snapshot\"}))),mdx(\"p\",null,\"By clicking on an item in the top panel will immediately redirect the panel below to its \\u201Cretainers\\u201D, or the Object Retaining Tree.\"),mdx(\"p\",null,\"I started digging down the Map destination object until we get to project, which is the function we pass to a map \",mdx(\"em\",{parentName:\"p\"},\"operator\"),\" and that leads to a line in one of the project\\u2019s files, asser-pricer.component.ts.\"),mdx(\"p\",null,\"Let\\u2019s take a look at the context around that line: it is a simple selection from the store that returns me a price and maps it to a String.\"),mdx(\"p\",null,\"Also, I used shareReplay(1) to multicast the price observable to the get trend value (e.g. if it went up or down since the previous emission).\"),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"price$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),`pricesFacade\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"getPriceForAsset\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"asset\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"pipe\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token generic-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"filter\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token generic class-name\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"\u003c\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin\"}),\"string\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"\u003e\"))),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"Boolean\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"map\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"price \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"parseFloat\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"price\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"toFixed\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"2\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"shareReplay\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"1\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`))),mdx(\"h3\",null,\"Rx Subscriptions \\u{1F98A}\"),mdx(\"p\",null,\"Let\\u2019s reflect for a moment about the line we just landed on: the issue is clearly an unsubscribed observable that is retaining the components in the memory.\"),mdx(\"p\",null,\"It doesn\\u2019t matter how many times we\\u2019ve been told to clean up our Rx subscriptions: in my experience, this is by far \",mdx(\"strong\",{parentName:\"p\"},\"the most common cause of memory leaks\"),\" in Angular applications.\"),mdx(\"p\",null,\"Many developers will probably be thinking: is an open subscription \",mdx(\"strong\",{parentName:\"p\"},\"really\"),\" going to cause havoc in a real-world application?\"),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"Yes, it can\"),\".\"),mdx(\"p\",null,\"Especially for large applications, if the leak happens within a repeated component (lists, tables, infinite scrolling components, etc.), even only one open subscription can cause your application to retain in memory the components until the subscription gets cleaned up.\"),mdx(\"p\",null,\"You would expect the components to be cleaned up when destroyed, for example:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"when the user navigates to another page\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"when the user replaces/filters the elements with a different selection\"))),mdx(\"p\",null,\"While unsubscribing is a fairly simple concept to understand, and unsubscribing itself (especially is using the async pipe) is easy, there are situations when the full knowledge of the operators we\\u2019re using is essential, as it happened in my case.\"),mdx(\"h3\",null,\"ShareReplay, what are you? \\u{1F914}\"),mdx(\"p\",null,\"Let\\u2019s get back to the issue.\"),mdx(\"p\",null,\"We found out a possible responsible candidate for our memory leak. The first thing I do is to debug shareReplay to understand why the subscription is not being unsubscribed, which lead me to its source code:\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/2266/1*_fdLmFspJ3wLY7j_feJIjQ.png\",alt:\"ShareReplay\\u2019s source code\"}))),mdx(\"p\",null,\"The long condition around the unsubscription was pretty suspect \\u2014 why? It turns out, despite me reading articles and documentation plenty of times about this, I missed a pretty important detail about this operator.\"),mdx(\"p\",null,\"In fact, if we don\\u2019t specify the property refCount: true, the subscription will never be unsubscribed. To fully understand why I refer you to this \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://blog.angularindepth.com/rxjs-whats-changed-with-sharereplay-65c098843e95\"}),\"Angular In Depth article: What\\u2019s Changed with ShareReplay\"),\".\"),mdx(\"p\",null,\"In order to fix this, I made the following change:\"),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"price$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"pricesFacade\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"getPriceForAsset\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"asset\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"pipe\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token generic-function\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"filter\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token generic class-name\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"\u003c\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin\"}),\"string\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"\u003e\"))),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"Boolean\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"map\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"price \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"parseFloat\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"price\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"toFixed\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"2\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"shareReplay\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        bufferSize`,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"1\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n        refCount`,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`))),mdx(\"p\",null,\"And now the memory leak from my application is gone!\"),mdx(\"p\",null,\"But let\\u2019s see some other common scenarios \\u2014 some of which appear even in some extremely popular libraries for Angular.\"),mdx(\"h3\",null,\"Event Listeners\"),mdx(\"p\",null,\"Another common cause of memory leaks is DOM events that are never unregistered. Some folks may think that using Angular\\u2019s Renderer may take care of it, but that is only the cause if the events are defined in the template, just as with the async pipe.\"),mdx(\"p\",null,\"Let\\u2019s see a quick and common example of a component that registers a scroll listener on the body, without never unregistering the event:\"),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"Component\")),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"//...})\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"export\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"ScrollComponent\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"constructor\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" renderer\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" Renderer2\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"ngOnInit\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"renderer\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"listen\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"document\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"body\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'scroll'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"updatePosition\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"updatePosition\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"/* implementation */\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"p\",null,\"This does, indeed, create a memory leak every time we instantiate ScrollComponent \\u2014 so let\\u2019s fix it:\"),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"Component\")),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"...\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"export\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"ScrollComponent\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" listeners \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"constructor\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" renderer\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" Renderer2\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"ngOnInit\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" listener \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"renderer\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"listen\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n        document`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"body\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),` \n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'scroll'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),` \n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"updatePosition\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"listeners\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"push\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"listener\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"ngOnDestroy\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"listeners\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"forEach\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"listener \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"listener\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"updatePosition\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"/* implementation */\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"p\",null,\"Unregistering all the events prevents the component ScrollComponent to be retained in memory and will be cleaned up once destroyed, along with its children.\"),mdx(\"h3\",null,\"Websocket Connections\"),mdx(\"p\",null,\"Very similarly, WebSocket connections must always be closed when unused. Imagine we have a component PricerComponent that subscribes to a WebSocket and displays incoming cryptocurrency prices.\"),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"Component\")),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    selector`,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'pricer'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n    template`,mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token template-string\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token template-punctuation string\"}),\"`\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"})),`\n`,mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"        \u003cspan\u003e{{ id | titlecase }}:\u003c/span\u003e\"),`\n`,mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"        \u003cspan\u003e{{ ( price$ | async) || 'loading...' }}\u003c/span\u003e\"),`\n`,mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"    \"),mdx(\"span\",e({parentName:\"span\"},{className:\"token template-punctuation string\"}),\"`\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"export\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"PricerComponent\"),\"  \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token decorator\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token at operator\"}),\"@\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"Input\")),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" id\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"string\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"public\"),\" price$ \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"new\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"Subject\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"static\"),\" Endpoint \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'wss://ws.coincap.io/prices/'\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" webSocket\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" WebSocket\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    \n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"ngOnInit\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"webSocket \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"new\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token class-name\"}),\"WebSocket\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"getEndpoint\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"id\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"webSocket\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function-variable function\"}),\"onmessage\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"msg\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" data \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token constant\"}),\"JSON\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"parse\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"msg\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"price$\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"next\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"id\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"getEndpoint\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"id\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin\"}),\"string\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),\" PricerComponent\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"Endpoint \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"+\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'?assets='\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"+\"),\" id\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"p\",null,\"Let\\u2019s explain the snippet:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"we receive an ID as input and we subscribe to it via WebSocket every time the component is initialized\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"when is the WebSocket connection cleared? Never! Once again, we\\u2019re missing the good gold ngOnDestroy hook to take care of it when the component gets destroyed\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"This creates multiple issues: not only we\\u2019re creating multiple WebSocket connections, but we\\u2019re also retaining PricerComponent in memory every time it gets re-initialized\"))),mdx(\"p\",null,\"Let\\u2019s take a snapshot and analyze it!\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/5030/1*NDLA9UIZD3J1KOADfME6mg.png\",alt:\"Heap Snapshot WebSocket example\"}))),mdx(\"p\",null,\"As per the image above, I start by comparing the initial load (with 1 pricer) with another snapshot taken after a small session.\"),mdx(\"p\",null,\"The Delta reveals me where additional memory has been allocated, so I start digging in the (closure) tree searching for clues back to my code.\"),mdx(\"p\",null,\"After scrolling a little bit, I stumble on this closure, which takes me back exactly to the callback passed to webSocket.onmessage!\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"https://cdn-images-1.medium.com/max/4160/1*Sh-HgR0QZBmp8wlXsxQ6YQ.png\",alt:null}))),mdx(\"p\",null,\"Debugging this case was admittedly pretty easy, but in some cases, it can be pretty daunting. There is a way we can help facilitate the debugging process by \",mdx(\"strong\",{parentName:\"p\"},\"naming functions\"),\" so that they will appear in the Memory Snapshot.\"),mdx(\"p\",null,\"For example, I could have written:\"),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function-variable function\"}),\"onPriceReceived\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"msg\",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" MessageEvent\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\u003e\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"const\"),\" data \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token constant\"}),\"JSON\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"parse\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"msg\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"price$\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"next\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"data\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\"id\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"webSocket\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"onmessage \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" onPriceReceived\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`))),mdx(\"p\",null,\"This bug is easily solved by adding the following method:\"),mdx(\"div\",e({},{className:\"remark-highlight\"}),mdx(\"pre\",e({parentName:\"div\"},{className:\"language-typescript\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-typescript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"ngOnDestroy\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"this\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"webSocket\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"close\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"p\",null,\"You can see the full example at \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://stackblitz.com/edit/angular-hubedk\"}),\"this Stackblitz link\"),\".\"),mdx(\"h2\",null,\"Takeaways \\u2B50\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"Memory Leaks are quite hard to find and debug \\u2014 my suggestion is to keep the Performance Monitor open from time to time and see if the memory is stable\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"Angular does a great job at managing memory; with that said, we need to watch out for open subscriptions (Observables, Subjects, NgRx Store Selections), DOM events, WebSocket connections, etc.\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"Learn how to use well the Chrome Dev Tools! It is essential for debugging performance and memory leaks. Even if it is intimidating to see so much low-level terminology, try to read and learn as much as possible about it\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},\"Name closures! It helps with debuggability and, in my opinion, makes code more readable\"))),mdx(\"h3\",null,\"Resources\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",e({parentName:\"p\"},{href:\"https://developers.google.com/web/tools/chrome-devtools/memory-problems\"}),\"Memory problems\"),\" (Chrome Dev Tools)\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",e({parentName:\"p\"},{href:\"https://developers.google.com/web/tools/chrome-devtools/memory-problems/heap-snapshots\"}),\"Record Heap Snapshot\"))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",e({parentName:\"p\"},{href:\"https://blog.angularindepth.com/rxjs-whats-changed-with-sharereplay-65c098843e95\"}),\"What\\u2019s Changed with ShareReplay\"))),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},mdx(\"a\",e({parentName:\"p\"},{href:\"https://blog.bitsrc.io/debugging-javascript-like-a-pro-a2e0f6c53c2e\"}),\"Debugging Javascript Like a Pro\")))))}MDXContent.isMDXComponent=!0;\n","scope":{}},"series":[],"morePosts":[],"moreArticles":[{"live":true,"readingTime":"2 min read","title":"Benchmarking Angular 12 with Webpack 5","date":"2021-05-14T00:00:00.322Z","slug":"webpack-5-angular12","coverImage":"/assets/images/posts/benchmarking-webpack-5.webp","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"Angular 12 has been released and with it the much awaited Webpack 5 upgrade. In this post I benchmarked the bundle-size and compilation speed against the previous version","tags":["angular"]},{"live":true,"readingTime":"5 min read","title":"Principles for creating libraries with Nx and Angular","date":"2021-02-07T00:00:00.322Z","slug":"how-to-organize-nx-modules-with-angular","coverImage":"/assets/images/posts/organize-nx-modules-ngrx.webp","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"Working with Nx may be confusing. This article explains how I create Nx libraries and the principles behind my motivations","tags":["nx","angular"]},{"live":true,"readingTime":"3 min read","title":"Where to put your Angular models?","date":"2020-08-03T00:00:00.322Z","slug":"angular-where-to-put-models","ogImage":{"url":"/assets/images/posts/where-put-angular-models.png"},"coverImage":"/assets/images/posts/where-put-angular-models.webp","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"Organizing entities and models in your Angular app may be hard. This article explains where to put your entities and what mistakes to watch out for","tags":["angular","architecture"]},{"live":true,"readingTime":"5 min read","title":"Using the Intersection Observer API with Angular","date":"2020-08-01T00:00:00.322Z","slug":"intersection-observer-with-angular","coverImage":"/assets/images/posts/intersection-observer.webp","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"This article shows how to build a directive with Angular that uses the Intersection Observer API to check when an element becomes visible on the page","tags":["angular","performance"]},{"live":true,"readingTime":"3 min read","title":"Setters vs ngOnChanges: which one is better?","date":"2020-07-30T00:00:00.322Z","slug":"setters-vs-ng-on-changes","coverImage":"/assets/images/posts/setters-vs-on-changes.webp","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"Listening to Input changes can be done in different ways. But which one should you use?","tags":["angular"]},{"live":true,"readingTime":"3 min read","title":"Async Rendering with a single Rx Operator","date":"2020-07-11T00:00:00.322Z","slug":"async-rendering-with-a-single-rx-operator","coverImage":"/assets/images/posts/async-rendering.webp","collection":{"name":"Angular","primaryColor":"#e23236","primaryColorLight":"#dd00316e","contrastColor":"#ffffff","logo":"/assets/images/collections/angular.webp"},"excerpt":"Increase your app rendering performance with this simple Rx operator","tags":["angular","rxjs"]}],"type":1},"__N_SSG":true},"page":"/[collection]/[slug]","query":{"collection":"angular","slug":"debugging-memory-leaks-in-angular"},"buildId":"SZu6xQbictN_BfVk1b1K_","isFallback":false,"gsp":true,"scriptLoader":[]}</script><script async="" defer="" src="https://www.googletagmanager.com/gtag/js"></script><script id="gtmDataLayer">
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-172483071-1');
</script></body></html>